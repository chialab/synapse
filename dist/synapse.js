!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.Synapse=e.Synapse||{})}(this,function(e){function t(e){return be.has(e)||be.set(e,{}),be.get(e)}function n(){}function r(e,t){this.attrs=Ce(),this.attrsArr=[],this.newAttrs=Ce(),this.staticsApplied=!1,this.key=t,this.keyMap=Ce(),this.keyMapValid=!0,this.focused=!1,this.nodeName=e,this.text=null}function i(){this.created=Be.nodesCreated&&[],this.deleted=Be.nodesDeleted&&[]}function o(e){return"function"==typeof e}function a(e){return"string"==typeof e}function s(e){return"[object Object]"===Object.prototype.toString.call(e)}function u(e){return"undefined"==typeof e}function c(e){return Array.isArray(e)}function f(e){return u(e)||null===e||e===!1}function l(e){return self.Symbol?self.Symbol(e):"__"+e}function d(e){return e&&e.node}function h(e){return e&&e[Rt]}function p(e){if(e=h(e)||e,e[Ct])return e[It].call(e),!0}function v(e){if(e=h(e)||e,e[Ct])return e[Nt].call(e),!0}function y(e,t,n,r){if(e=h(e)||e,e[Ct]){var i=e.constructor.observedAttributes||[];if(i.indexOf(t)!==-1)return e[Mt].call(e,t,n,r),!0}}function g(e,t){return e=d(e)||e,t=d(t)||t,(e!==t.parentNode||e.lastElementChild!==t)&&(t.parentNode&&m(t.parentNode,t),e.appendChild(t),p(t))}function m(e,t){return e=d(e)||e,t=d(t)||t,e.removeChild(t),v(t)}function _(e,t,n){for(var r=0,i=e.length;r<i;r++)n=t(n,e[r],r,e);return n}function b(e,t,n){for(;e;)n=t(n,e),e=Object.getPrototypeOf(e);return n}function w(e,t){return b(e,function(n,r){if(r.hasOwnProperty(t)){var i=Object.getOwnPropertyDescriptor(r,t),o=void 0;i.hasOwnProperty("value")?o=i.value:i.hasOwnProperty("get")&&(o=i.get.call(e)),n.push(o)}return n},[])}function k(e,t){var n=w(e,t);return _(n,function(e,t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n]);return e},{})}function E(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(!a(t))throw new TypeError("Event name is undefined");var o=new Ft(t,{detail:n,bubbles:r,cancelable:i});return e.dispatchEvent(o)}function O(e){return new Ut(e)}function S(e,t){if(""===t&&e.accepts(Boolean))return!0;if(!e.accepts(String))try{return JSON.parse(t)}catch(e){}return t}function x(e,t,n){var r=e.getAttribute(t);r!==n&&(f(n)?null!==r&&e.removeAttribute(t):("boolean"==typeof n&&(n=""),e.setAttribute(t,n)))}function j(e,t){return Jt.call(e,t)}function A(e,t,n){if(!n)return t;for(var r=e.target;r&&r!==t;){if(j(r,n))return r;r=r.parentNode}return null}function P(e,t){var n=this;return function(r){var i=A(r,n.node,e);i&&t.call(n,r,i)}}function q(e,t){var n=e.cssRules||e.rules;if(e.insertRule){var r=function(){for(var r=new RegExp(t+"([\\s.[:]|$)"),i="",o=0,a=n.length;o<a;o++){var s=n[o],u=s.cssText;if(s.selectorText){var c=s.cssText.split("{").shift().split(",").map(function(e){return e=e.trim(),e.match(r)?e:t+" "+e}).join(", ");u=s.cssText.replace(s.selectorText,c)}else(s.cssRules||s.rules)&&(q(s,t),u=s.cssText);e.deleteRule(o),i+=n[e.insertRule(u,o)].cssText}return{v:i}}();if("object"===("undefined"==typeof r?"undefined":fe(r)))return r.v}}function T(e,t,n){var r="."+n;e.textContent=t.replace(Kt,function(e,t){return""+r+(t?t.slice(1,-1):"")}),e.textContent=q(e.sheet,r)||""}function C(e){return e.ownerDocument||Vt}function R(e){var t=C(e.node).createElement("style");return t.id="style-"+e.is,t}function L(e){e.forEach(function(e){o(e)?e():c(e)?L(e):e&&At(e)})}function D(e,t){var n=this;if(o(e)){var r=e.call(this,t);D.call(this,r)}else c(e)&&e.forEach(function(e){D.call(n,e)})}function I(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];return function(){s(t)||(t&&r.unshift(t),t={});var n=t.key;delete t.key;var i=Tt.get(t.is||e);Ot(e,n);for(var o in t){var u=t[o];f(u)||i&&!a(u)&&isNaN(u)&&u!==!0||St(o,u)}var c=xt(e),l=i&&(h(c)||new i(c));if(l&&s(l.properties)){var d=l.properties;for(var p in t)d.hasOwnProperty(p)&&(l[p]=t[p])}return l&&0===r.length?ft():L(r),jt(e),c}}function N(e,t,n){return Ye(e,D.bind(this,t,n))}function M(){if(!this.node)throw new ReferenceError("The component's `node` is undefined.")}function B(e,t,n){var r={};0===n?r.value=function(){var e;M.call(this);for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];return(e=this.node[t]).call.apply(e,[this.node].concat(r))}:n>0&&(r.get=function(){return M.call(this),this.node[t]},n>1&&(r.set=function(e){return M.call(this),this.node[t]=e})),Object.defineProperty(e,t,r)}function F(e){for(var t in rn)B(e.prototype,t,rn[t]);return e}function U(e){for(var t in Tt.components)for(var n=Tt.get(t),r=e.querySelectorAll(t+', [is="'+t+'"]'),i=0,o=r.length;i<o;i++){var a=new n(r[i]);p(a)}}function z(e,t,n){return Tt.define(e,t,n)}function H(){throw new Error("Dynamic requires are not currently supported by rollup-plugin-commonjs")}function J(e,t){return t={exports:{}},e(t,t.exports),t.exports}function W(e){return"undefined"!=typeof e&&null!==e&&e.constructor===Object}function K(e,t){for(var n=t.split("."),r=e,i=0;i<n.length;++i){if("undefined"==typeof r[n[i]])return;r=r[n[i]]}return r}function V(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return e.replace(/{(\d+)}/g,function(e,t){return"undefined"!=typeof n[t]?n[t]:e})}function X(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={};if("object"===("undefined"==typeof e?"undefined":fe(e)))for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);if("object"===("undefined"==typeof t?"undefined":fe(t)))for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);return n}function G(e,t,n,r){return e=e||{},e.timestamp=Date.now(),{state:e,title:t,url:n,type:r}}function $(e,t){t=t.replace(/\*/g,"([^/?#]+?)").replace(/\.\./,"(.*)");var n=new RegExp("^"+t+"$"),r=e.match(n);return r?r.slice(1):null}function Q(e){return e.replace(/([.+*?=^!:${}()[\]|\/\\])/g,"\\$1")}function Y(e){return e.replace(/([=!:$\/()])/g,"\\$1")}function Z(e){for(var t=[],n=0,r=0,i="",o=Kn.exec(e);null!==o;){var a=o[0],s=o[1],u=o.index;if(i+=e.slice(r,u),r=u+a.length,s)i+=s[1];else{var c=e[r],f=o[2],l=o[3],d=o[4],h=o[5],p=o[6],v=o[7];i&&(t.push(i),i="");var y=null!==f&&null!==c&&c!==f,g="+"===p||"*"===p,m="?"===p||"*"===p,_=o[2]||"/",b=d||h||(v?".*":"[^"+_+"]+?");t.push({name:l||n++,prefix:f||"",delimiter:_,optional:m,repeat:g,partial:y,asterisk:!!v,pattern:Y(b)}),o=Kn.exec(e)}}return r<e.length&&(i+=e.substr(r)),i&&t.push(i),t}function ee(e,t){return e.keys=t,e}function te(e){return e.sensitive?"":"i"}function ne(e,t){t=t||{};for(var n=t.strict,r=t.end!==!1,i="",o=e[e.length-1],a="string"==typeof o&&/\/$/.test(o),s=0;s<e.length;s++){var u=e[s];if("string"==typeof u)i+=Q(u);else{var c=Q(u.prefix),f="(?:"+u.pattern+")";u.repeat&&(f+="(?:"+c+f+")*"),f=u.optional?u.partial?c+"("+f+")?":"(?:"+c+"("+f+"))?":c+"("+f+")",i+=f}}if(!n){var l=a?i.slice(0,-2):i;i=l+"(?:\\/(?=$))?"}return i+=r?"$":n&&a?"":"(?=\\/|$)",new RegExp("^"+i,te(t))}function re(e,t,n){for(var r=Z(e),i=ne(r,n),o=0;o<r.length;o++)"string"!=typeof r[o]&&t.push(r[o]);return ee(i,t)}function ie(e,t,n){return t=t||[],Array.isArray(t)?n||(n={}):(n=t,t=[]),re(e,t,n)}function oe(e,t){var n=ie(t),r=n.exec(e);return r&&(r=r.slice(1)),r}function ae(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=void 0;return function(){clearTimeout(r),r=setTimeout(t.bind(e),n)}}function se(e){var t=this.history;if(e instanceof Event){var n=Xn.state,r=t.indexOfState(n);if(r!==-1){var i=t.length-t.index-1-r;t.go(i)}else{var o=this.getPathFromBase(),a=t.pushState(null,document.title,o);Xn.replaceState(a,document.title,this.resolve(o))}}else if(!Xn.state||Xn.state.timestamp!==t.current.state.timestamp){var s=this.resolve(e.url);"push"===e.type?Xn.pushState(e.state,e.title,s):Xn.replaceState(e.state,e.title,s)}}function ue(){var e=this.history.current,t=this.resolve(e.url);Xn.replaceState(e.state,e.title,t),this._onPopState=se.bind(this),this.history.on("popstate",this._onPopState),window.addEventListener("popstate",this._onPopState)}function ce(){this._onPopState&&(this.history.off("popstate",this._onPopState),window.removeEventListener("popstate",this._onPopState),delete this._onPopState,delete this._onHashChange)}var fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},le=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},de=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),he=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},pe=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},ve=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},ye=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t},ge=function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)},me=function(){function e(t){le(this,e),t=t||function(){function e(){le(this,e)}return e}(),this.superclass=t}return de(e,[{key:"with",value:function(){return[].slice.call(arguments,0).reduce(function(e,t){return t(e)},this.superclass)}}]),e}(),_e=function(e){return new me(e)},be=new WeakMap;t.destroy=function(e){be.has(e)&&be.delete(e)};var we=function(e){return function(e){function n(){var e;le(this,n);for(var r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];var a=ye(this,(e=n.__proto__||Object.getPrototypeOf(n)).call.apply(e,[this].concat(i)));return t(a).readyPromises=[],a.preventInitialization||a.addReadyPromise(a.initialize.apply(a,i)),a}return ve(n,e),de(n,[{key:"initialize",value:function(){return Promise.resolve()}},{key:"ready",value:function(){return Promise.all(t(this).readyPromises)}},{key:"addReadyPromise",value:function(e){return t(this).readyPromises.push(e),e}},{key:"destroy",value:function(){return t.destroy(this),Promise.resolve()}}]),n}(e)},ke=function(e){return function(e){function n(){return le(this,n),ye(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return ve(n,e),de(n,[{key:"initialize",value:function(){for(var e,r=this,i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return(e=pe(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"initialize",this)).call.apply(e,[this].concat(o)).then(function(){var e=r.constructor;for(t(r).injectPromises=[];e;)e.injectors&&r.registerInject(e.injectors),e.inject&&r.inject(e.inject),e=Object.getPrototypeOf(e);return Promise.all(t(r).injectPromises)})}},{key:"registerInject",value:function(e,n){var r=this;if(Array.isArray(e))e.forEach(function(e){return r.registerInject(e)});else if("object"===("undefined"==typeof e?"undefined":fe(e)))for(var i in e)e.hasOwnProperty(i)&&this.registerInject(i,e[i]);else{var o=this;if("function"==typeof this.getOwner&&(o=this.getOwner()),t(o).injected=t(o).injected||{},!t(o).injected.hasOwnProperty(e)){var a=t(o).injected[e]=new n(o);o.trigger("injected",e,a),o.addReadyPromise(a.ready())}}}},{key:"inject",value:function(e){var n=this;if(Array.isArray(e))e.forEach(function(e){return n.inject(e)});else if("object"===("undefined"==typeof e?"undefined":fe(e)))for(var r in e)e.hasOwnProperty(r)&&this.inject(r);else{var i=this;if("function"==typeof this.getOwner&&(i=this.getOwner()),i){t(this).injected=t(this).injected||{};var o=i.factory(e);o?t(this).injected[e]=o:t(this).injectPromises.push(new Promise(function(r){var o=i.on("injected",function(i,a){i===e&&(t(n).injected[e]=a,o(),r())})}))}}}},{key:"factory",value:function(e){return t(this).injected&&t(this).injected[e]}}],[{key:"inject",get:function(){return[]}}]),n}(e)},Ee=new WeakMap,Oe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){function e(){le(this,e)}return e}();return function(e){function t(){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ve(t,e),de(t,[{key:"on",value:function(e,t,n){if("string"==typeof e&&"function"==typeof t&&(n=t,t=e,e=this),"function"!=typeof n)throw new Error("Callback is not a function.");var r=Ee.get(e)||{},i=r[t]=r[t]||{length:0},o=i.length;return i[o]={fn:n,destroy:function(e,t,n){return function(){"undefined"!=typeof e[t][n]&&delete e[t][n]}}(r,t,o)},i.length+=1,Ee.set(e,r),r[t][o].destroy}},{key:"off",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;"string"!=typeof e&&"undefined"!=typeof e||(t=e,e=this);var n=Ee.get(e);if(n)if(t){var r=n[t];for(var i in r)"object"===fe(r[i])&&"function"==typeof r[i].destroy&&r[i].destroy.call(e)}else for(var o in n)n.hasOwnProperty(o)&&this.off(e,o)}},{key:"trigger",value:function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];"string"==typeof e&&(r.unshift(t),t=e,e=this);var o=Ee.get(e)||{},a=o[t]||{},s=[];for(var u in a)if(a.hasOwnProperty(u)){var c=a[u];"object"===("undefined"==typeof c?"undefined":fe(c))&&"function"==typeof c.fn&&s.push(c.fn.apply(e,r))}return Promise.all(s)}}]),t}(e)},Se=function(e){function t(){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ve(t,e),de(t,null,[{key:"mixin",get:function(){return Oe}}]),t}(Oe()),xe=function(e){return function(e){function n(){return le(this,n),ye(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return ve(n,e),de(n,[{key:"initialize",value:function(){var e;t(this).listeners=[];for(var r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=pe(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"initialize",this)).call.apply(e,[this].concat(i))}},{key:"listen",value:function(e,n,r){t(this).listeners.push(e.on(n,r))}},{key:"unlisten",value:function(){t(this).listeners&&(t(this).listeners.forEach(function(e){return e()}),t(this).listeners=[])}},{key:"destroy",value:function(){return this.unlisten(),this.off(),pe(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"destroy",this).call(this)}}]),n}(_e(e).with(Se.mixin))},je=function(e){function t(){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ve(t,e),t}(_e(function(){function e(){le(this,e)}return e}()).with(we,xe,ke)),Ae=function(e){return function(e){function n(){return le(this,n),ye(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return ve(n,e),de(n,[{key:"initialize",value:function(e){var t;e&&("function"==typeof e.getOwner&&(e=e.getOwner()),this.setOwner(e));for(var r=arguments.length,i=Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return(t=pe(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"initialize",this)).call.apply(t,[this,e].concat(i))}},{key:"setOwner",value:function(e){t(this).owner=e}},{key:"getOwner",value:function(){return t(this).owner}},{key:"initClass",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return new(Function.prototype.bind.apply(e,[null].concat([this.getOwner()],n)))}}]),n}(e)},Pe=function(e){function t(){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ve(t,e),t}(_e(je).with(Ae)),qe=Object.prototype.hasOwnProperty;n.prototype=Object.create(null);var Te=function(e,t){return qe.call(e,t)},Ce=function(){return new n},Re=function(e,t,n){var i=new r(t,n);return e.__incrementalDOMData=i,i},Le=function(e){return De(e),e.__incrementalDOMData},De=function e(t){if(!t.__incrementalDOMData){var n=t instanceof Element,r=n?t.localName:t.nodeName,i=n?t.getAttribute("key"):null,o=Re(t,r,i);if(i&&(Le(t.parentNode).keyMap[i]=t),n)for(var a=t.attributes,s=o.attrs,u=o.newAttrs,c=o.attrsArr,f=0;f<a.length;f+=1){var l=a[f],d=l.name,h=l.value;s[d]=h,u[d]=void 0,c.push(d),c.push(h)}for(var p=t.firstChild;p;p=p.nextSibling)e(p)}},Ie=function(e,t){return"svg"===e?"http://www.w3.org/2000/svg":"foreignObject"===Le(t).nodeName?null:t.namespaceURI},Ne=function(e,t,n,r){var i=Ie(n,t),o=void 0;return o=i?e.createElementNS(i,n):e.createElement(n),Re(o,n,r),o},Me=function(e){var t=e.createTextNode("");return Re(t,"#text",null),t},Be={nodesCreated:null,nodesDeleted:null};i.prototype.markCreated=function(e){this.created&&this.created.push(e)},i.prototype.markDeleted=function(e){this.deleted&&this.deleted.push(e)},i.prototype.notifyChanges=function(){this.created&&this.created.length>0&&Be.nodesCreated(this.created),this.deleted&&this.deleted.length>0&&Be.nodesDeleted(this.deleted)};var Fe=function(e){return e instanceof Document||e instanceof DocumentFragment},Ue=function(e,t){for(var n=[],r=e;r!==t;)n.push(r),r=r.parentNode;return n},ze=function(e){for(var t=e,n=t;t;)n=t,t=t.parentNode;return n},He=function(e){var t=ze(e);return Fe(t)?t.activeElement:null},Je=function(e,t){var n=He(e);return n&&e.contains(n)?Ue(n,t):[]},We=function(e,t,n){for(var r=t.nextSibling,i=n;i!==t;){var o=i.nextSibling;e.insertBefore(i,r),i=o}},Ke=null,Ve=null,Xe=null,Ge=null,$e=function(e,t){for(var n=0;n<e.length;n+=1)Le(e[n]).focused=t},Qe=function(e){var t=function(t,n,r){var o=Ke,a=Ge,s=Ve,u=Xe;Ke=new i,Ge=t.ownerDocument,Xe=t.parentNode;var c=Je(t,Xe);$e(c,!0);var f=e(t,n,r);return $e(c,!1),Ke.notifyChanges(),Ke=o,Ge=a,Ve=s,Xe=u,f};return t},Ye=Qe(function(e,t,n){return Ve=e,rt(),t(n),at(),e}),Ze=function(e,t,n){var r=Le(e);return t===r.nodeName&&n==r.key},et=function(e,t){if(!Ve||!Ze(Ve,e,t)){var n=Le(Xe),r=Ve&&Le(Ve),i=n.keyMap,o=void 0;if(t){var a=i[t];a&&(Ze(a,e,t)?o=a:a===Ve?Ke.markDeleted(a):tt(Xe,a,i))}o||(o="#text"===e?Me(Ge):Ne(Ge,Xe,e,t),t&&(i[t]=o),Ke.markCreated(o)),Le(o).focused?We(Xe,o,Ve):r&&r.key&&!r.focused?(Xe.replaceChild(o,Ve),n.keyMapValid=!1):Xe.insertBefore(o,Ve),Ve=o}},tt=function(e,t,n){e.removeChild(t),Ke.markDeleted(t);var r=Le(t).key;r&&delete n[r]},nt=function(){var e=Xe,t=Le(e),n=t.keyMap,r=t.keyMapValid,i=e.lastChild,o=void 0;if(i!==Ve||!r){for(;i!==Ve;)tt(e,i,n),i=e.lastChild;if(!r){for(o in n)i=n[o],i.parentNode!==e&&(Ke.markDeleted(i),delete n[o]);t.keyMapValid=!0}}},rt=function(){Xe=Ve,Ve=null},it=function(){return Ve?Ve.nextSibling:Xe.firstChild},ot=function(){Ve=it()},at=function(){nt(),Ve=Xe,Xe=Xe.parentNode},st=function(e,t){return ot(),et(e,t),rt(),Xe},ut=function(){return at(),Ve},ct=function(){return ot(),et("#text",null),Ve},ft=function(){Ve=Xe.lastChild},lt={default:"__default"},dt=function(e){return 0===e.lastIndexOf("xml:",0)?"http://www.w3.org/XML/1998/namespace":0===e.lastIndexOf("xlink:",0)?"http://www.w3.org/1999/xlink":void 0},ht=function(e,t,n){if(null==n)e.removeAttribute(t);else{var r=dt(t);r?e.setAttributeNS(r,t,n):e.setAttribute(t,n)}},pt=function(e,t,n){e[t]=n},vt=function(e,t,n){t.indexOf("-")>=0?e.setProperty(t,n):e[t]=n},yt=function(e,t,n){if("string"==typeof n)e.style.cssText=n;else{e.style.cssText="";var r=e.style,i=n;for(var o in i)Te(i,o)&&vt(r,o,i[o])}},gt=function(e,t,n){var r="undefined"==typeof n?"undefined":fe(n);"object"===r||"function"===r?pt(e,t,n):ht(e,t,n)},mt=function(e,t,n){var r=Le(e),i=r.attrs;if(i[t]!==n){var o=_t[t]||_t[lt.default];o(e,t,n),i[t]=n}},_t=Ce();_t[lt.default]=gt,_t.style=yt;var bt,wt=3,kt=[],Et=function(e,t,n,r){var i=st(e,t),o=Le(i);if(!o.staticsApplied){if(n)for(var a=0;a<n.length;a+=2){var s=n[a],u=n[a+1];mt(i,s,u)}o.staticsApplied=!0}for(var c=o.attrsArr,f=o.newAttrs,l=!c.length,d=wt,h=0;d<arguments.length;d+=2,h+=2){var p=arguments[d];if(l)c[h]=p,f[p]=void 0;else if(c[h]!==p)break;var v=arguments[d+1];(l||c[h+1]!==v)&&(c[h+1]=v,mt(i,p,v))}if(d<arguments.length||h<c.length){for(;d<arguments.length;d+=1,h+=1)c[h]=arguments[d];for(h<c.length&&(c.length=h),d=0;d<c.length;d+=2){var y=c[d],g=c[d+1];f[y]=g}for(var m in f)mt(i,m,f[m]),f[m]=void 0}return i},Ot=function(e,t,n){kt[0]=e,kt[1]=t,kt[2]=n},St=function(e,t){kt.push(e),kt.push(t)},xt=function(){var e=Et.apply(null,kt);return kt.length=0,e},jt=function(e){var t=ut();return t},At=function(e,t){var n=ct(),r=Le(n);if(r.text!==e){r.text=e;for(var i=e,o=1;o<arguments.length;o+=1){var a=arguments[o];i=a(i)}n.data=i}return n},Pt=Object.defineProperty,qt="components",Tt=(bt={},he(bt,qt,{}),he(bt,"define",function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};e=e.toLowerCase(),Pt(t.prototype,"is",{get:function(){return e}}),this[qt][e]={is:e,Ctr:t,config:n}}),he(bt,"get",function(e,t){var n=this[qt][e.toLowerCase()];if(n)return t?n:n.Ctr}),bt),Ct=l("dna"),Rt=l("component"),Lt=l("node"),Dt=l("style"),It="connectedCallback",Nt="disconnectedCallback",Mt="attributeChangedCallback",Bt=function(e){var t=function(e){function t(){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ve(t,e),de(t,[{key:"connectedCallback",value:function(){this.node[Rt]=this}},{key:"disconnectedCallback",value:function(){}},{key:"attributeChangedCallback",value:function(){}},{key:Ct,get:function(){return!0}},{key:"node",get:function(){return this[Lt]},set:function(e){e[Rt]=this,this[Lt]=e}}]),t}(e);return t},Ft=self.CustomEvent;try{new Ft("test")}catch(e){Ft=function(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,t.bubbles,t.cancelable,t.detail),n},Ft.prototype=self.CustomEvent.prototype}var Ut=function(){function e(t){var n=this;le(this,e),this._=[],t=t||[],c(t)||(t=[t]),this.ctrs=t,this.validator=function(){return!0},this._setter=function(e){return e},this.getterFn=function(){return n.value},this.setterFn=function(e){if(e=n._setter(e),!(null===e||void 0===e||n.validateType(e)&&n.validator(e)))throw new TypeError("Invalid `"+e+"` value for `"+n.name+"` property for `"+n.scope.is+"`.");var t=n.value;t!==e&&(n.value=e,n.initialized&&n.changed(e,t))}}return de(e,[{key:"observe",value:function(e){return(o(e)||a(e))&&this._.push(e),this}},{key:"unobserve",value:function(e){var t=this._.indexOf(e);return t!==-1&&this._.splice(t,1),this}},{key:"changed",value:function(e,t){this.defaultSet=!1;for(var n=0,r=this._.length;n<r;n++){var i=this._[n];a(i)?this.scope[i].call(this.scope,this,e,t):i.call(this.scope,this,e,t)}}},{key:"accepts",value:function(e){return this.ctrs.indexOf(e)!==-1}},{key:"named",value:function(e){return this.name=e,this.attrRequested===!0&&(this.attrName=this.name),this}},{key:"default",value:function(e){return this.defaultValue=s(e)?Object.freeze(e):e,this}},{key:"attribute",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return a(e)?(this.attrRequested=!1,this.attrName=e):(this.attrRequested=!!e,this.attrName=this.name),this}},{key:"dispatch",value:function(e){return this.eventName=e,this}},{key:"getter",value:function(e){var t=this;return o(e)&&(this.getterFn=function(){return e(t.value)}),this}},{key:"setter",value:function(e){return o(e)&&(this._setter=e),this}},{key:"validate",value:function(e){return o(e)&&(this.validator=e),this}},{key:"validateType",value:function(e){var t=0,n=this.ctrs;if(0===n.length)return!0;for(;t<n.length;){if(e instanceof n[t]||e.constructor&&e.constructor===n[t])return!0;t++}return!1}},{key:"init",value:function(e){this.scope=e,Pt(e,this.name,{get:this.getterFn.bind(this),set:this.setterFn.bind(this),configurable:!0}),u(this.defaultValue)||(e[this.name]=this.defaultValue,this.defaultSet=!0),this.initialized=!0}}]),e}();Pt(O,"ANY",{get:function(){return O()}}),Pt(O,"STRING",{get:function(){return O(String)}}),Pt(O,"BOOLEAN",{get:function(){return O(Boolean)}}),Pt(O,"NUMBER",{get:function(){return O(Number)}});var zt=function(e){return function(e){function t(e){le(this,t);var n=ye(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=k(n,"properties");for(var i in r)r[i]instanceof Ut||(r[i]=O(r[i]));Pt(n,"properties",{value:r});var o=n.constructor.observedAttributes||[],a=function(e){var t=r[e];t.named(e).observe(function(e,t,r){return n.propertyChangedCallback(e.name,r,t)}).init(n);var i=t.attrName,a=t.eventName;i||o.indexOf(e)===-1||(t.attribute(),i=e),(i||a)&&t.observe(function(e,r,o){i&&x(n,i,n[t.name]),a&&E(n,a,{component:n,property:e.name,newValue:r,oldValue:o})})};for(var s in r)a(s);return n}return ve(t,e),de(t,[{key:"connectedCallback",value:function(){pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"connectedCallback",this).call(this);var e=this.properties;for(var n in e){var r=e[n],i=r.attrName,o=r.name;(u(this[o])||r.defaultSet)&&(this.hasAttribute(i||o)?this[o]=S(r,this.getAttribute(i||o)):u(this.node[o])||(this[o]=this.node[o])),i&&x(this,i,this[o])}}},{key:"attributeChangedCallback",value:function(e,n,r){pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"attributeChangedCallback",this).call(this,e,n,r);var i=this.properties;for(var o in i){var a=i[o];if(a.attrName===e)return void(this[a.name]=S(a,r))}}},{key:"propertyChangedCallback",value:function(){}},{key:"observeProperty",value:function(e,t){return this.properties[e].observe(t)}},{key:"unobserveProperty",value:function(e,t){this.properties[e].unobserve(t)}}]),t}(e)},Ht=Element.prototype,Jt=Ht.matches||Ht.mozMatchesSelector||Ht.msMatchesSelector||Ht.oMatchesSelector||Ht.webkitMatchesSelector,Wt=function(e){return function(e){function t(e){le(this,t);var n=ye(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=k(n,"events");for(var i in r){var s=a(r[i])?n[r[i]]:r[i];if(!o(s))throw new TypeError("Invalid callback for event.");var u=i.trim().split(" "),c=u.shift(),f=u.join(" ");r[i]={name:c,selector:f,callback:P.call(n,f,s)}}return Pt(n,"events",{value:r}),n}return ve(t,e),de(t,[{key:"connectedCallback",value:function(){pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"connectedCallback",this).call(this);var e=this.events;for(var n in e)this.addEventListener(e[n].name,e[n].callback)}},{key:"disconnectedCallback",value:function(){var e=this.events;for(var n in e)this.removeEventListener(e[n].name,e[n].callback);pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"disconnectedCallback",this).call(this)}},{key:"delegate",value:function(e,t,n){var r=P.call(this,t,n);return this.addEventListener(e,r)}},{key:"trigger",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return E(this,e,t,n,r)}}]),t}(e)},Kt=/\:host(\(([^({)]+(\([^)]*\))?)+\))?/g,Vt=document,Xt=function(e){return function(e){function t(e){le(this,t);var n=ye(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),r=w(n,"css").filter(function(e){return a(e)}).join("\n");return r&&Pt(n,"css",{value:r}),n}return ve(t,e),de(t,[{key:"connectedCallback",value:function(){if(pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"connectedCallback",this).call(this),a(this.css))if(this.shadowRoot){if(!this[Dt]){var e=this[Dt]=R(this);e.textContent=this.css,this.shadowRoot.appendChild(e)}}else if(!this.constructor[Dt]){var n=this.constructor[Dt]=R(this);C(this.node).head.appendChild(n),T(n,this.css,this.is)}this.classList.add(this.is)}}]),t}(e)},Gt=function(e){return function(e){function t(){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ve(t,e),de(t,[{key:"connectedCallback",value:function(){pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"connectedCallback",this).call(this),f(this.template)||this.render()}},{key:"propertyChangedCallback",value:function(e,n,r){pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"propertyChangedCallback",this).call(this,e,n,r),f(this.template)||this.render()}},{key:"render",value:function(e){if(e=e||this.template,o(e))return e.call(this);var t=this.shadowRoot||this;u(this.__innerHTML)&&(this.__innerHTML=t.innerHTML),t.innerHTML=""+this.__innerHTML+e}}]),t}(e)},$t=function(){function e(t){le(this,e),t=t||function(){function e(){le(this,e)}return e}(),this.superclass=t}return de(e,[{key:"with",value:function(){var e=[].slice.call(arguments,0);return _(e,function(e,t){return t(e)},this.superclass)}}]),e}(),Qt=function(e){return new $t(e)},Yt={ComponentMixin:Bt,PropertiesMixin:zt,EventsMixin:Wt,StyleMixin:Xt,TemplateMixin:Gt},Zt=Be.nodesCreated,en=Be.nodesDeleted,tn=_t[lt.default];Be.nodesCreated=function(e){e.forEach(function(e){if(e.nodeType===Node.ELEMENT_NODE){var t=Tt.get(e.getAttribute("is")||e.tagName),n=h(e)||t&&new t(e);n&&p(n)}}),Zt&&Zt(e)},Be.nodesDeleted=function(e){e.forEach(function(e){v(e)}),en&&en(e)},_t[lt.default]=function(e,t,n){var r=e.getAttribute(t);tn&&tn(e,t,n);var i=h(e);if(i){var o=i.constructor.observedAttributes||[];o.indexOf(t)!==-1?(n=f(n)?null:n,y(i,t,r,n)):i.properties&&i.properties.hasOwnProperty(t)&&(i[t]=n)}};var nn=function(e){return function(e){function t(){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ve(t,e),de(t,[{key:"render",value:function(e){var n=this;if(e=e||this.template,o(e)){var r=e.bind(this);e=function(){return N(n.shadowRoot||n.node,r)}}pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"render",this).call(this,e)}}]),t}(e)},rn={attributes:1,classList:1,getAttribute:0,hasAttribute:0,setAttribute:0,removeAttribute:0,addEventListener:0,removeEventListener:0,dispatchEvent:0,style:1,querySelector:0,querySelectorAll:0,shadowRoot:1,attachShadow:0,createShadowRoot:0,innerText:2,innerHTML:2};Yt.IDOMMixin=nn;var on=F(function(){function e(t){le(this,e),this.node=t||document.createElement(this.is)}return e}()),an=function(e){function t(){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ve(t,e),t}(Qt(on).with(Yt.ComponentMixin,Yt.PropertiesMixin,Yt.StyleMixin,Yt.EventsMixin,Yt.TemplateMixin,nn)),sn=function(e){function n(){return le(this,n),ye(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return ve(n,e),de(n,[{key:"render",value:function(){var e=t(this).streams;return function(){return I("div",null,e)}}},{key:"getResponse",value:function(){return t(this).streams}},{key:"setResponse",value:function(e){t(this).streams=e}},{key:"stream",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.getResponse()||{};for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n]);return this.setResponse(e),this.trigger("stream",e)}},{key:"pipe",value:function(e){this.on("stream",function(t){return e(t)})}},{key:"exec",value:function(){return this.stream({})}},{key:"redirect",value:function(e){return this.getOwner().navigate(e)}},{key:"next",value:function(){return Promise.reject()}}]),n}(Pe),un=function(e){function n(){return le(this,n),ye(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return ve(n,e),de(n,[{key:"set",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=this.constructor;if("object"===("undefined"==typeof e?"undefined":fe(e))){n=t||!1;for(var i in e)if(e.hasOwnProperty(i)&&r.properties.indexOf(i)!==-1){var o=Object.getOwnPropertyDescriptor(r.prototype,i);o&&"function"==typeof o.get&&"function"!=typeof o.set||this[i]!==e[i]&&(n||this.setChanges(i,this[i],e[i]),this[i]=e[i])}}else if("string"==typeof e){var a={};a[e]=t,this.set(a,n)}}},{key:"resetChanges",value:function(){t(this).changes={}}},{key:"setChanges",value:function(e,n,r){t(this).changes=t(this).changes||{},t(this).changes[e]={oldValue:n,newValue:r}}},{key:"getChanges",
value:function(){return t(this).changes||{}}},{key:"changed",value:function(){return Object.keys(this.getChanges())}},{key:"hasChanges",value:function(){return!!this.changed().length}},{key:"toJSON",value:function(){var e=this,t=this.constructor,n={};return(t.properties||[]).forEach(function(t){n[t]=e[t]}),n}}],[{key:"properties",get:function(){return[]}}]),n}(Pe);un.ready=Promise.resolve();var cn=function(){function e(t,n){le(this,e);for(var r=arguments.length,i=Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];var a=new(Function.prototype.bind.apply(Error,[null].concat([t],i)));return"undefined"==typeof t?a.message=this.defaultMessage:t instanceof Error&&(n=t,a.message=this.defaultMessage),n&&(a.originalError=n,a.message=a.message+", from "+n.name+": "+n.message+"."),a.name=this.constructor.exceptionName,Object.setPrototypeOf(a,this.constructor.prototype),a}return de(e,[{key:"defaultMessage",get:function(){return"Generic app error"}},{key:"exceptionName",get:function(){return"AppException"}}]),e}(),fn=function(e){function t(){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ve(t,e),de(t,[{key:"defaultMessage",get:function(){return"Generic content error."}},{key:"exceptionName",get:function(){return"ContentException"}}]),t}(cn),ln=function(e){function t(){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ve(t,e),de(t,[{key:"defaultMessage",get:function(){return"Content error"}},{key:"exceptionName",get:function(){return"ContentErrorException"}}]),t}(fn),dn=function(e){function t(){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ve(t,e),de(t,[{key:"defaultMessage",get:function(){return"Content not found"}},{key:"exceptionName",get:function(){return"ContentNotFoundException"}}]),t}(fn),hn=function(e){function t(e){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,void 0,e))}return ve(t,e),de(t,[{key:"defaultMessage",get:function(){return"An error occured opening the database connection."}},{key:"exceptionName",get:function(){return"DBOpeningErrorException"}}]),t}(cn),pn=function(e){function t(e,n){if(le(this,t),n instanceof Error)var r=ye(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,void 0,n));else var r=ye(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,n));return r.database=e,ye(r)}return ve(t,e),de(t,[{key:"defaultMessage",get:function(){return"An error occured syncing the database."}},{key:"exceptionName",get:function(){return"DBSyncFailedException"}}]),t}(cn),vn=function(e){function t(){var e;le(this,t);for(var n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];var o=ye(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(r)));return t.notifications.trigger("created",o),o.ready().then(function(){o.isReady=!0,o.requestedRender&&o.render.apply(o,ge(o.requestedRender))}),o}return ve(t,e),de(t,[{key:"preventInitialization",get:function(){return!0}}]),de(t,[{key:"render",value:function(){for(var e,n=arguments.length,r=Array(n),i=0;i<n;i++)r[i]=arguments[i];return this.isReady?(e=pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"render",this)).call.apply(e,[this].concat(r)):void(this.requestedRender=r)}}]),t}(_e(an).with(we,Ae,ke));vn.notifications=new Se;var yn=function(e){function t(){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ve(t,e),de(t,null,[{key:"supported",value:function(){return Promise.resolve()}},{key:"dependencies",get:function(){return[]}}]),t}(Pe),gn=function(e){return function(e){function n(){return le(this,n),ye(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return ve(n,e),de(n,[{key:"initialize",value:function(){for(var e,r=this,i=arguments.length,o=Array(i),a=0;a<i;a++)o[a]=arguments[a];return(e=pe(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"initialize",this)).call.apply(e,[this].concat(o)).then(function(){return r.beforePluginsInitialization().then(function(){var e=r.plugins,n=Promise.resolve();return t(r).plugins=[],Array.isArray(e)&&e.filter(function(e){return!!e}).forEach(function(e){n=n.then(function(){return r.registerPlugin(e)})}),n}).then(function(){return r.afterPluginsInitialization()})})}},{key:"beforePluginsInitialization",value:function(){return Promise.resolve()}},{key:"afterPluginsInitialization",value:function(){return Promise.resolve()}},{key:"getPluginInstances",value:function(){return t(this).plugins}},{key:"registerPlugin",value:function(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Array.isArray(e))return this.registerPlugin(e[0],e[1]);if(e.prototype instanceof yn){for(var i=t(this).plugins,o=0,a=i.length;o<a;o++)if(i[o]instanceof e)return Promise.resolve();var s=Promise.resolve();return Array.isArray(e.dependencies)&&e.dependencies.forEach(function(e){s=s.then(function(){return n.registerPlugin(e)})}),s.then(function(){return e.supported().catch(function(){return n.onPluginUnsupported(e)}).then(function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(t){var o=new e(n,r);return i.push(o),o.ready().then(function(){return n.onPluginReady(o),Promise.resolve()})}return Promise.resolve()})})}return Promise.resolve()}},{key:"onPluginReady",value:function(){}},{key:"onPluginUnsupported",value:function(e){return console.warn("Unsupported plugin",e),Promise.resolve(!1)}},{key:"plugins",get:function(){return[]}}]),n}(e)},mn="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},_n=J(function(e){!function(t,n){"use strict";e.exports=n()}(mn,function(){"use strict";function e(e){if(!e)return!0;if(o(e)&&0===e.length)return!0;if(!r(e)){for(var t in e)if(l.call(e,t))return!1;return!0}return!1}function t(e){return f.call(e)}function n(e){return"number"==typeof e||"[object Number]"===t(e)}function r(e){return"string"==typeof e||"[object String]"===t(e)}function i(e){return"object"==typeof e&&"[object Object]"===t(e)}function o(e){return"object"==typeof e&&"number"==typeof e.length&&"[object Array]"===t(e)}function a(e){return"boolean"==typeof e||"[object Boolean]"===t(e)}function s(e){var t=parseInt(e);return t.toString()===e?t:e}function u(t,i,o,a){if(n(i)&&(i=[i]),e(i))return t;if(r(i))return u(t,i.split(".").map(s),o,a);var c=i[0];if(1===i.length){var f=t[c];return void 0!==f&&a||(t[c]=o),f}return void 0===t[c]&&(n(i[1])?t[c]=[]:t[c]={}),u(t[c],i.slice(1),o,a)}function c(t,i){if(n(i)&&(i=[i]),!e(t)){if(e(i))return t;if(r(i))return c(t,i.split("."));var a=s(i[0]),u=t[a];if(1===i.length)void 0!==u&&(o(t)?t.splice(a,1):delete t[a]);else if(void 0!==t[a])return c(t[a],i.slice(1));return t}}var f=Object.prototype.toString,l=Object.prototype.hasOwnProperty,d=function(e){return Object.keys(d).reduce(function(t,n){return"function"==typeof d[n]&&(t[n]=d[n].bind(d,e)),t},{})};return d.has=function(t,a){if(e(t))return!1;if(n(a)?a=[a]:r(a)&&(a=a.split(".")),e(a)||0===a.length)return!1;for(var s=0;s<a.length;s++){var u=a[s];if(!i(t)&&!o(t)||!l.call(t,u))return!1;t=t[u]}return!0},d.ensureExists=function(e,t,n){return u(e,t,n,!0)},d.set=function(e,t,n,r){return u(e,t,n,r)},d.insert=function(e,t,n,r){var i=d.get(e,t);r=~~r,o(i)||(i=[],d.set(e,t,i)),i.splice(r,0,n)},d.empty=function(t,s){if(e(s))return t;if(!e(t)){var u,c;if(!(u=d.get(t,s)))return t;if(r(u))return d.set(t,s,"");if(a(u))return d.set(t,s,!1);if(n(u))return d.set(t,s,0);if(o(u))u.length=0;else{if(!i(u))return d.set(t,s,null);for(c in u)l.call(u,c)&&delete u[c]}}},d.push=function(e,t){var n=d.get(e,t);o(n)||(n=[],d.set(e,t,n)),n.push.apply(n,Array.prototype.slice.call(arguments,2))},d.coalesce=function(e,t,n){for(var r,i=0,o=t.length;i<o;i++)if(void 0!==(r=d.get(e,t[i])))return r;return n},d.get=function(t,i,o){if(n(i)&&(i=[i]),e(i))return t;if(e(t))return o;if(r(i))return d.get(t,i.split("."),o);var a=s(i[0]);return 1===i.length?void 0===t[a]?o:t[a]:d.get(t[a],i.slice(1),o)},d.del=function(e,t){return c(e,t)},d})}),bn=function(){function e(){le(this,e),t(this).conf={}}return de(e,[{key:"write",value:function(e,n){if("object"===("undefined"==typeof e?"undefined":fe(e))){for(var r in e)e.hasOwnProperty(r)&&this.write(r,e[r]);return!0}if(W(n)){for(var i in n)n.hasOwnProperty(i)&&this.write(e+"."+i,n[i]);return!0}return _n.set(t(this).conf,e,n),!0}},{key:"defaults",value:function(e,t){if("object"===("undefined"==typeof e?"undefined":fe(e))){for(var n in e)e.hasOwnProperty(n)&&this.defaults(n,e[n]);return!0}if(W(t)){for(var r in t)t.hasOwnProperty(r)&&this.defaults(e+"."+r,t[r]);return!0}return"undefined"!=typeof this.read(e)||this.write(e,t)}},{key:"read",value:function(e){return _n.get(t(this).conf,e,void 0)}},{key:"delete",value:function(e){return _n.del(t(this).conf,e)}}]),e}(),wn=document,kn=function(){function e(){le(this,e)}return de(e,null,[{key:"add",value:function(e,t,n){var r=void 0,i=Promise.resolve();return n=n||t,t?(r=wn.createElement("link"),r.rel="stylesheet",r.setAttribute("href",t),i=new Promise(function(e,t){r.addEventListener("load",function(){e()}),r.addEventListener("error",function(){t()})})):(r=wn.createElement("style"),r.type="text/css",r.textContent=e),n&&(r.id=n),wn.head.appendChild(r),i.then(function(){return Promise.resolve(r)})}},{key:"addByContent",value:function(e,t){return this.add(e,null,t)}},{key:"addByUrl",value:function(e,t){return this.add(null,e,t)}}]),e}(),En=J(function(e,t){!function(t){e.exports=t()}(function(){var e;return function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof H&&H;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var f=n[a]={exports:{}};t[a][0].call(f.exports,function(e){var n=t[a][1][e];return i(n?n:e)},f,f.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof H&&H,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){"use strict";function r(e){return function(){var t=arguments.length;if(t){for(var n=[],r=-1;++r<t;)n[r]=arguments[r];return e.call(this,n)}return e.call(this,[])}}t.exports=r},{}],2:[function(e,t,n){(function(r){function i(){return!("undefined"==typeof window||!window||"undefined"==typeof window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document&&"WebkitAppearance"in document.documentElement.style||"undefined"!=typeof window&&window&&window.console&&(console.firebug||console.exception&&console.table)||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function o(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+n.humanize(this.diff),t){var r="color: "+this.color;e.splice(1,0,r,"color: inherit");var i=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(i++,"%c"===e&&(o=i))}),e.splice(o,0,r)}}function a(){return"object"===("undefined"==typeof console?"undefined":fe(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)}function s(e){try{null==e?n.storage.removeItem("debug"):n.storage.debug=e}catch(e){}}function u(){try{return n.storage.debug}catch(e){}}function c(){try{return window.localStorage}catch(e){}}n=t.exports=e(3),n.log=a,n.formatArgs=o,n.save=s,n.load=u,n.useColors=i,n.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:c(),n.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],n.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},n.enable(u())}).call(this,e(9))},{3:3,9:9}],3:[function(e,t,n){function r(e){var t,r=0;for(t in e)r=(r<<5)-r+e.charCodeAt(t),r|=0;return n.colors[Math.abs(r)%n.colors.length]}function i(e){function t(){if(t.enabled){var e=t,r=+new Date,i=r-(c||r);e.diff=i,e.prev=c,e.curr=r,c=r;for(var o=new Array(arguments.length),a=0;a<o.length;a++)o[a]=arguments[a];o[0]=n.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var s=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(t,r){if("%%"===t)return t;s++;var i=n.formatters[r];if("function"==typeof i){var a=o[s];t=i.call(e,a),o.splice(s,1),s--}return t}),n.formatArgs.call(e,o);var u=t.log||n.log||console.log.bind(console);u.apply(e,o)}}return t.namespace=e,t.enabled=n.enabled(e),t.useColors=n.useColors(),t.color=r(e),"function"==typeof n.init&&n.init(t),t}function o(e){n.save(e);for(var t=(e||"").split(/[\s,]+/),r=t.length,i=0;i<r;i++)t[i]&&(e=t[i].replace(/\*/g,".*?"),"-"===e[0]?n.skips.push(new RegExp("^"+e.substr(1)+"$")):n.names.push(new RegExp("^"+e+"$")))}function a(){n.enable("")}function s(e){var t,r;for(t=0,r=n.skips.length;t<r;t++)if(n.skips[t].test(e))return!1;for(t=0,r=n.names.length;t<r;t++)if(n.names[t].test(e))return!0;return!1}function u(e){return e instanceof Error?e.stack||e.message:e}n=t.exports=i.debug=i.default=i,n.coerce=u,n.disable=a,n.enable=o,n.enabled=s,n.humanize=e(8),n.names=[],n.skips=[],n.formatters={};var c},{8:8}],4:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function o(e){return"number"==typeof e}function a(e){return"object"===("undefined"==typeof e?"undefined":fe(e))&&null!==e}function s(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!o(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,o,u,c;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var f=new Error('Uncaught, unspecified "error" event. ('+t+")");throw f.context=t,f}if(n=this._events[e],s(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),n.apply(this,o)}else if(a(n))for(o=Array.prototype.slice.call(arguments,1),c=n.slice(),r=c.length,u=0;u<r;u++)c[u].apply(this,o);return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(n=s(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function n(){this.removeListener(e,n),r||(r=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var r=!1;return n.listener=t,this.on(e,n),this},r.prototype.removeListener=function(e,t){var n,r,o,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],o=n.length,r=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(n)){for(s=o;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){r=s;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},r.listenerCount=function(e,t){return e.listenerCount(t)}},{}],5:[function(e,t,n){(function(e){"use strict";function n(){f=!0;for(var e,t,n=l.length;n;){for(t=l,l=[],e=-1;++e<n;)t[e]();n=l.length}f=!1}function r(e){1!==l.push(e)||f||i()}var i,o=e.MutationObserver||e.WebKitMutationObserver;if(o){var a=0,s=new o(n),u=e.document.createTextNode("");s.observe(u,{characterData:!0}),i=function(){u.data=a=++a%2}}else if(e.setImmediate||"undefined"==typeof e.MessageChannel)i="document"in e&&"onreadystatechange"in e.document.createElement("script")?function(){var t=e.document.createElement("script");t.onreadystatechange=function(){n(),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},e.document.documentElement.appendChild(t)}:function(){setTimeout(n,0)};else{var c=new e.MessageChannel;c.port1.onmessage=n,i=function(){c.port2.postMessage(0)}}var f,l=[];t.exports=r}).call(this,"undefined"!=typeof mn?mn:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],6:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],7:[function(e,t,n){"use strict";function r(){}function i(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=m,this.queue=[],this.outcome=void 0,e!==r&&u(this,e)}function o(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function a(e,t,n){p(function(){var r;try{r=t(n)}catch(t){return v.reject(e,t)}r===e?v.reject(e,new TypeError("Cannot resolve promise with itself")):v.resolve(e,r)})}function s(e){var t=e&&e.then;if(e&&"object"===("undefined"==typeof e?"undefined":fe(e))&&"function"==typeof t)return function(){t.apply(e,arguments)}}function u(e,t){function n(t){o||(o=!0,v.reject(e,t))}function r(t){o||(o=!0,v.resolve(e,t))}function i(){t(r,n)}var o=!1,a=c(i);"error"===a.status&&n(a.value)}function c(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}function f(e){return e instanceof this?e:v.resolve(new this(r),e)}function l(e){var t=new this(r);return v.reject(t,e)}function d(e){function t(e,t){function r(e){a[t]=e,++s!==i||o||(o=!0,v.resolve(c,a))}n.resolve(e).then(r,function(e){o||(o=!0,v.reject(c,e))})}var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,o=!1;if(!i)return this.resolve([]);for(var a=new Array(i),s=0,u=-1,c=new this(r);++u<i;)t(e[u],u);return c}function h(e){function t(e){n.resolve(e).then(function(e){o||(o=!0,v.resolve(s,e))},function(e){o||(o=!0,v.reject(s,e))})}var n=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var i=e.length,o=!1;if(!i)return this.resolve([]);for(var a=-1,s=new this(r);++a<i;)t(e[a]);return s}var p=e(5),v={},y=["REJECTED"],g=["FULFILLED"],m=["PENDING"];t.exports=i,i.prototype.catch=function(e){return this.then(null,e)},i.prototype.then=function(e,t){if("function"!=typeof e&&this.state===g||"function"!=typeof t&&this.state===y)return this;var n=new this.constructor(r);if(this.state!==m){var i=this.state===g?e:t;a(n,i,this.outcome)}else this.queue.push(new o(n,e,t));return n},o.prototype.callFulfilled=function(e){v.resolve(this.promise,e)},o.prototype.otherCallFulfilled=function(e){a(this.promise,this.onFulfilled,e)},o.prototype.callRejected=function(e){v.reject(this.promise,e)},o.prototype.otherCallRejected=function(e){a(this.promise,this.onRejected,e)},v.resolve=function(e,t){var n=c(s,t);if("error"===n.status)return v.reject(e,n.value);var r=n.value;if(r)u(e,r);else{e.state=g,e.outcome=t;for(var i=-1,o=e.queue.length;++i<o;)e.queue[i].callFulfilled(t)}return e},v.reject=function(e,t){e.state=y,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e},i.resolve=f,i.reject=l,i.all=d,i.race=h},{5:5}],8:[function(e,t,n){function r(e){if(e=String(e),!(e.length>1e4)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]),r=(t[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*l;case"days":case"day":case"d":return n*f;case"hours":case"hour":case"hrs":case"hr":case"h":return n*c;case"minutes":case"minute":case"mins":case"min":case"m":return n*u;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function i(e){return e>=f?Math.round(e/f)+"d":e>=c?Math.round(e/c)+"h":e>=u?Math.round(e/u)+"m":e>=s?Math.round(e/s)+"s":e+"ms"}function o(e){return a(e,f,"day")||a(e,c,"hour")||a(e,u,"minute")||a(e,s,"second")||e+" ms"}function a(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}var s=1e3,u=60*s,c=60*u,f=24*c,l=365.25*f;t.exports=function(e,t){t=t||{};var n="undefined"==typeof e?"undefined":fe(e);if("string"===n&&e.length>0)return r(e);if("number"===n&&isNaN(e)===!1)return t.long?o(e):i(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],9:[function(e,t,n){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(e){if(l===setTimeout)return setTimeout(e,0);if((l===r||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function a(e){if(d===clearTimeout)return clearTimeout(e);if((d===i||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(e);try{return d(e)}catch(t){try{return d.call(null,e)}catch(t){return d.call(this,e)}}}function s(){y&&p&&(y=!1,p.length?v=p.concat(v):g=-1,v.length&&u())}function u(){if(!y){var e=o(s);y=!0;for(var t=v.length;t;){for(p=v,v=[];++g<t;)p&&p[g].run();g=-1,t=v.length}p=null,y=!1,a(e)}}function c(e,t){this.fun=e,this.array=t}function f(){}var l,d,h=t.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:r}catch(e){l=r}try{d="function"==typeof clearTimeout?clearTimeout:i}catch(e){d=i}}();var p,v=[],y=!1,g=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];v.push(new c(e,t)),1!==v.length||y||o(u)},c.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=f,h.addListener=f,h.once=f,h.off=f,h.removeListener=f,h.removeAllListeners=f,h.emit=f,h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],10:[function(e,t,n){(function(){var e={}.hasOwnProperty,n=[].slice;t.exports=function(t,r){var i,o,a,s;o=[],s=[];for(i in r)e.call(r,i)&&(a=r[i],"this"!==i&&(o.push(i),s.push(a)));return Function.apply(null,n.call(o).concat([t])).apply(r.this,s)}}).call(this)},{}],11:[function(t,n,r){!function(t){if("object"===("undefined"==typeof r?"undefined":fe(r)))n.exports=t();else if("function"==typeof e&&e.amd)e(t);else{var i;try{i=window}catch(e){i=self}i.SparkMD5=t()}}(function(e){"use strict";function t(e,t){var n=e[0],r=e[1],i=e[2],o=e[3];n+=(r&i|~r&o)+t[0]-680876936|0,n=(n<<7|n>>>25)+r|0,o+=(n&r|~n&i)+t[1]-389564586|0,o=(o<<12|o>>>20)+n|0,i+=(o&n|~o&r)+t[2]+606105819|0,i=(i<<17|i>>>15)+o|0,r+=(i&o|~i&n)+t[3]-1044525330|0,r=(r<<22|r>>>10)+i|0,n+=(r&i|~r&o)+t[4]-176418897|0,n=(n<<7|n>>>25)+r|0,o+=(n&r|~n&i)+t[5]+1200080426|0,o=(o<<12|o>>>20)+n|0,i+=(o&n|~o&r)+t[6]-1473231341|0,i=(i<<17|i>>>15)+o|0,r+=(i&o|~i&n)+t[7]-45705983|0,r=(r<<22|r>>>10)+i|0,n+=(r&i|~r&o)+t[8]+1770035416|0,n=(n<<7|n>>>25)+r|0,o+=(n&r|~n&i)+t[9]-1958414417|0,o=(o<<12|o>>>20)+n|0,i+=(o&n|~o&r)+t[10]-42063|0,i=(i<<17|i>>>15)+o|0,r+=(i&o|~i&n)+t[11]-1990404162|0,r=(r<<22|r>>>10)+i|0,n+=(r&i|~r&o)+t[12]+1804603682|0,n=(n<<7|n>>>25)+r|0,o+=(n&r|~n&i)+t[13]-40341101|0,o=(o<<12|o>>>20)+n|0,i+=(o&n|~o&r)+t[14]-1502002290|0,i=(i<<17|i>>>15)+o|0,r+=(i&o|~i&n)+t[15]+1236535329|0,r=(r<<22|r>>>10)+i|0,n+=(r&o|i&~o)+t[1]-165796510|0,n=(n<<5|n>>>27)+r|0,o+=(n&i|r&~i)+t[6]-1069501632|0,o=(o<<9|o>>>23)+n|0,i+=(o&r|n&~r)+t[11]+643717713|0,i=(i<<14|i>>>18)+o|0,r+=(i&n|o&~n)+t[0]-373897302|0,r=(r<<20|r>>>12)+i|0,n+=(r&o|i&~o)+t[5]-701558691|0,n=(n<<5|n>>>27)+r|0,o+=(n&i|r&~i)+t[10]+38016083|0,o=(o<<9|o>>>23)+n|0,i+=(o&r|n&~r)+t[15]-660478335|0,i=(i<<14|i>>>18)+o|0,r+=(i&n|o&~n)+t[4]-405537848|0,r=(r<<20|r>>>12)+i|0,n+=(r&o|i&~o)+t[9]+568446438|0,n=(n<<5|n>>>27)+r|0,o+=(n&i|r&~i)+t[14]-1019803690|0,o=(o<<9|o>>>23)+n|0,i+=(o&r|n&~r)+t[3]-187363961|0,i=(i<<14|i>>>18)+o|0,r+=(i&n|o&~n)+t[8]+1163531501|0,r=(r<<20|r>>>12)+i|0,n+=(r&o|i&~o)+t[13]-1444681467|0,n=(n<<5|n>>>27)+r|0,o+=(n&i|r&~i)+t[2]-51403784|0,o=(o<<9|o>>>23)+n|0,i+=(o&r|n&~r)+t[7]+1735328473|0,i=(i<<14|i>>>18)+o|0,r+=(i&n|o&~n)+t[12]-1926607734|0,r=(r<<20|r>>>12)+i|0,n+=(r^i^o)+t[5]-378558|0,n=(n<<4|n>>>28)+r|0,o+=(n^r^i)+t[8]-2022574463|0,o=(o<<11|o>>>21)+n|0,i+=(o^n^r)+t[11]+1839030562|0,i=(i<<16|i>>>16)+o|0,r+=(i^o^n)+t[14]-35309556|0,r=(r<<23|r>>>9)+i|0,n+=(r^i^o)+t[1]-1530992060|0,n=(n<<4|n>>>28)+r|0,o+=(n^r^i)+t[4]+1272893353|0,o=(o<<11|o>>>21)+n|0,i+=(o^n^r)+t[7]-155497632|0,i=(i<<16|i>>>16)+o|0,r+=(i^o^n)+t[10]-1094730640|0,r=(r<<23|r>>>9)+i|0,n+=(r^i^o)+t[13]+681279174|0,n=(n<<4|n>>>28)+r|0,o+=(n^r^i)+t[0]-358537222|0,o=(o<<11|o>>>21)+n|0,i+=(o^n^r)+t[3]-722521979|0,i=(i<<16|i>>>16)+o|0,r+=(i^o^n)+t[6]+76029189|0,r=(r<<23|r>>>9)+i|0,n+=(r^i^o)+t[9]-640364487|0,n=(n<<4|n>>>28)+r|0,o+=(n^r^i)+t[12]-421815835|0,o=(o<<11|o>>>21)+n|0,i+=(o^n^r)+t[15]+530742520|0,i=(i<<16|i>>>16)+o|0,r+=(i^o^n)+t[2]-995338651|0,r=(r<<23|r>>>9)+i|0,n+=(i^(r|~o))+t[0]-198630844|0,n=(n<<6|n>>>26)+r|0,o+=(r^(n|~i))+t[7]+1126891415|0,o=(o<<10|o>>>22)+n|0,i+=(n^(o|~r))+t[14]-1416354905|0,i=(i<<15|i>>>17)+o|0,r+=(o^(i|~n))+t[5]-57434055|0,r=(r<<21|r>>>11)+i|0,n+=(i^(r|~o))+t[12]+1700485571|0,n=(n<<6|n>>>26)+r|0,o+=(r^(n|~i))+t[3]-1894986606|0,o=(o<<10|o>>>22)+n|0,i+=(n^(o|~r))+t[10]-1051523|0,i=(i<<15|i>>>17)+o|0,r+=(o^(i|~n))+t[1]-2054922799|0,r=(r<<21|r>>>11)+i|0,n+=(i^(r|~o))+t[8]+1873313359|0,n=(n<<6|n>>>26)+r|0,o+=(r^(n|~i))+t[15]-30611744|0,o=(o<<10|o>>>22)+n|0,i+=(n^(o|~r))+t[6]-1560198380|0,i=(i<<15|i>>>17)+o|0,r+=(o^(i|~n))+t[13]+1309151649|0,r=(r<<21|r>>>11)+i|0,n+=(i^(r|~o))+t[4]-145523070|0,n=(n<<6|n>>>26)+r|0,o+=(r^(n|~i))+t[11]-1120210379|0,o=(o<<10|o>>>22)+n|0,i+=(n^(o|~r))+t[2]+718787259|0,i=(i<<15|i>>>17)+o|0,r+=(o^(i|~n))+t[9]-343485551|0,r=(r<<21|r>>>11)+i|0,e[0]=n+e[0]|0,e[1]=r+e[1]|0,e[2]=i+e[2]|0,e[3]=o+e[3]|0}function n(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function r(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e[t]+(e[t+1]<<8)+(e[t+2]<<16)+(e[t+3]<<24);return n}function i(e){var r,i,o,a,s,u,c=e.length,f=[1732584193,-271733879,-1732584194,271733878];for(r=64;r<=c;r+=64)t(f,n(e.substring(r-64,r)));for(e=e.substring(r-64),i=e.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r=0;r<i;r+=1)o[r>>2]|=e.charCodeAt(r)<<(r%4<<3);if(o[r>>2]|=128<<(r%4<<3),r>55)for(t(f,o),r=0;r<16;r+=1)o[r]=0;return a=8*c,a=a.toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),u=parseInt(a[1],16)||0,o[14]=s,o[15]=u,t(f,o),f}function o(e){var n,i,o,a,s,u,c=e.length,f=[1732584193,-271733879,-1732584194,271733878];for(n=64;n<=c;n+=64)t(f,r(e.subarray(n-64,n)));for(e=n-64<c?e.subarray(n-64):new Uint8Array(0),i=e.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n=0;n<i;n+=1)o[n>>2]|=e[n]<<(n%4<<3);if(o[n>>2]|=128<<(n%4<<3),n>55)for(t(f,o),n=0;n<16;n+=1)o[n]=0;return a=8*c,a=a.toString(16).match(/(.*?)(.{0,8})$/),s=parseInt(a[2],16),u=parseInt(a[1],16)||0,o[14]=s,o[15]=u,t(f,o),f}function a(e){var t,n="";for(t=0;t<4;t+=1)n+=v[e>>8*t+4&15]+v[e>>8*t&15];return n}function s(e){var t;for(t=0;t<e.length;t+=1)e[t]=a(e[t]);return e.join("")}function u(e){return/[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function c(e,t){var n,r=e.length,i=new ArrayBuffer(r),o=new Uint8Array(i);for(n=0;n<r;n+=1)o[n]=e.charCodeAt(n);return t?o:i}function f(e){return String.fromCharCode.apply(null,new Uint8Array(e))}function l(e,t,n){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(new Uint8Array(e)),r.set(new Uint8Array(t),e.byteLength),n?r:r.buffer}function d(e){var t,n=[],r=e.length;for(t=0;t<r-1;t+=2)n.push(parseInt(e.substr(t,2),16));return String.fromCharCode.apply(String,n)}function h(){this.reset()}var p=function(e,t){return e+t&4294967295},v=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return"5d41402abc4b2a76b9719d911017c592"!==s(i("hello"))&&(p=function(e,t){var n=(65535&e)+(65535&t),r=(e>>16)+(t>>16)+(n>>16);return r<<16|65535&n}),"undefined"==typeof ArrayBuffer||ArrayBuffer.prototype.slice||!function(){function t(e,t){return e=0|e||0,e<0?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(n,r){var i,o,a,s,u=this.byteLength,c=t(n,u),f=u;return r!==e&&(f=t(r,u)),c>f?new ArrayBuffer(0):(i=f-c,o=new ArrayBuffer(i),a=new Uint8Array(o),s=new Uint8Array(this,c,i),a.set(s),o)}}(),h.prototype.append=function(e){return this.appendBinary(u(e)),this},h.prototype.appendBinary=function(e){this._buff+=e,this._length+=e.length;var r,i=this._buff.length;for(r=64;r<=i;r+=64)t(this._hash,n(this._buff.substring(r-64,r)));return this._buff=this._buff.substring(r-64),this},h.prototype.end=function(e){var t,n,r=this._buff,i=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=r.charCodeAt(t)<<(t%4<<3);return this._finish(o,i),n=s(this._hash),e&&(n=d(n)),this.reset(),n},h.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},h.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},h.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},h.prototype._finish=function(e,n){var r,i,o,a=n;if(e[a>>2]|=128<<(a%4<<3),a>55)for(t(this._hash,e),a=0;a<16;a+=1)e[a]=0;r=8*this._length,r=r.toString(16).match(/(.*?)(.{0,8})$/),i=parseInt(r[2],16),o=parseInt(r[1],16)||0,e[14]=i,e[15]=o,t(this._hash,e)},h.hash=function(e,t){return h.hashBinary(u(e),t)},h.hashBinary=function(e,t){var n=i(e),r=s(n);return t?d(r):r},h.ArrayBuffer=function(){this.reset()},h.ArrayBuffer.prototype.append=function(e){var n,i=l(this._buff.buffer,e,!0),o=i.length;for(this._length+=e.byteLength,n=64;n<=o;n+=64)t(this._hash,r(i.subarray(n-64,n)));return this._buff=n-64<o?new Uint8Array(i.buffer.slice(n-64)):new Uint8Array(0),this},h.ArrayBuffer.prototype.end=function(e){var t,n,r=this._buff,i=r.length,o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<i;t+=1)o[t>>2]|=r[t]<<(t%4<<3);return this._finish(o,i),n=s(this._hash),e&&(n=d(n)),
this.reset(),n},h.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.ArrayBuffer.prototype.getState=function(){var e=h.prototype.getState.call(this);return e.buff=f(e.buff),e},h.ArrayBuffer.prototype.setState=function(e){return e.buff=c(e.buff,!0),h.prototype.setState.call(this,e)},h.ArrayBuffer.prototype.destroy=h.prototype.destroy,h.ArrayBuffer.prototype._finish=h.prototype._finish,h.ArrayBuffer.hash=function(e,t){var n=o(new Uint8Array(e)),r=s(n);return t?d(r):r},h})},{}],12:[function(e,t,n){"use strict";function r(e,t,n){var r=n[n.length-1];e===r.element&&(n.pop(),r=n[n.length-1]);var i=r.element,o=r.index;if(Array.isArray(i))i.push(e);else if(o===t.length-2){var a=t.pop();i[a]=e}else t.push(e)}n.stringify=function(e){var t=[];t.push({obj:e});for(var n,r,i,o,a,s,u,c,f,l,d,h="";n=t.pop();)if(r=n.obj,i=n.prefix||"",o=n.val||"",h+=i,o)h+=o;else if("object"!==("undefined"==typeof r?"undefined":fe(r)))h+="undefined"==typeof r?null:JSON.stringify(r);else if(null===r)h+="null";else if(Array.isArray(r)){for(t.push({val:"]"}),a=r.length-1;a>=0;a--)s=0===a?"":",",t.push({obj:r[a],prefix:s});t.push({val:"["})}else{u=[];for(c in r)r.hasOwnProperty(c)&&u.push(c);for(t.push({val:"}"}),a=u.length-1;a>=0;a--)f=u[a],l=r[f],d=a>0?",":"",d+=JSON.stringify(f)+":",t.push({obj:l,prefix:d});t.push({val:"{"})}return h},n.parse=function(e){for(var t,n,i,o,a,s,u,c,f,l=[],d=[],h=0;;)if(t=e[h++],"}"!==t&&"]"!==t&&"undefined"!=typeof t)switch(t){case" ":case"\t":case"\n":case":":case",":break;case"n":h+=3,r(null,l,d);break;case"t":h+=3,r(!0,l,d);break;case"f":h+=4,r(!1,l,d);break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"-":for(n="",h--;;){if(i=e[h++],!/[\d\.\-e\+]/.test(i)){h--;break}n+=i}r(parseFloat(n),l,d);break;case'"':for(o="",a=void 0,s=0;;){if(u=e[h++],'"'===u&&("\\"!==a||s%2!==1))break;o+=u,a=u,"\\"===a?s++:s=0}r(JSON.parse('"'+o+'"'),l,d);break;case"[":c={element:[],index:l.length},l.push(c.element),d.push(c);break;case"{":f={element:{},index:l.length},l.push(f.element),d.push(f);break;default:throw new Error("unexpectedly reached end of input: "+t)}else{if(1===l.length)return l.pop();r(l.pop(),l,d)}}},{}],13:[function(e,t,n){(function(n){"use strict";function r(e){return e&&"object"===("undefined"==typeof e?"undefined":fe(e))&&"default"in e?e.default:e}function i(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer||"undefined"!=typeof Blob&&e instanceof Blob}function o(e){if("function"==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),n=new Uint8Array(t),r=new Uint8Array(e);return n.set(r),t}function a(e){if(e instanceof ArrayBuffer)return o(e);var t=e.size,n=e.type;return"function"==typeof e.slice?e.slice(0,t,n):e.webkitSlice(0,t,n)}function s(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=t.constructor;return"function"==typeof n&&n instanceof n&&Ir.call(n)==Nr}function u(e){var t,n,r;if(!e||"object"!==("undefined"==typeof e?"undefined":fe(e)))return e;if(Array.isArray(e)){for(t=[],n=0,r=e.length;n<r;n++)t[n]=u(e[n]);return t}if(e instanceof Date)return e.toISOString();if(i(e))return a(e);if(!s(e))return e;t={};for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var o=u(e[n]);"undefined"!=typeof o&&(t[n]=o)}return t}function c(e){var t=!1;return jr(function(n){if(t)throw new Error("once called more than once");t=!0,e.apply(this,n)})}function f(e){return jr(function(t){t=u(t);var n=this,r="function"==typeof t[t.length-1]&&t.pop(),i=new Dr(function(r,i){var o;try{var a=c(function(e,t){e?i(e):r(t)});t.push(a),o=e.apply(n,t),o&&"function"==typeof o.then&&r(o)}catch(e){i(e)}});return r&&i.then(function(e){r(null,e)},r),i})}function l(e,t){function n(e,t,n){if(Mr.enabled){for(var r=[e.name,t],i=0;i<n.length-1;i++)r.push(n[i]);Mr.apply(null,r);var o=n[n.length-1];n[n.length-1]=function(n,r){var i=[e.name,t];i=i.concat(n?["error",n]:["success",r]),Mr.apply(null,i),o(n,r)}}}return f(jr(function(r){if(this._closed)return Dr.reject(new Error("database is closed"));if(this._destroyed)return Dr.reject(new Error("database is destroyed"));var i=this;return n(i,e,r),this.taskqueue.isReady?t.apply(this,r):new Dr(function(t,n){i.taskqueue.addTask(function(o){o?n(o):t(i[e].apply(i,r))})})}))}function d(e){return"$"+e}function h(e){return e.substring(1)}function p(){this._store={}}function v(e){if(this._store=new p,e&&Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.add(e[t])}function y(){if("undefined"==typeof Symbol||"undefined"==typeof Map||"undefined"==typeof Set)return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&"get"in e&&Map[Symbol.species]===Map}function g(e,t){for(var n={},r=0,i=t.length;r<i;r++){var o=t[r];o in e&&(n[o]=e[o])}return n}function m(e){return e}function _(e){return[{ok:e}]}function b(e,t,n){function r(){var e=[];d.forEach(function(t){t.docs.forEach(function(n){e.push({id:t.id,docs:[n]})})}),n(null,{results:e})}function i(){++l===f&&r()}function o(e,t,n){d[e]={id:t,docs:n},i()}function a(){if(!(p>=h.length)){var e=Math.min(p+zr,h.length),t=h.slice(p,e);s(t,p),p+=t.length}}function s(n,r){n.forEach(function(n,i){var s=r+i,u=c.get(n),f=g(u[0],["atts_since","attachments"]);f.open_revs=u.map(function(e){return e.rev}),f.open_revs=f.open_revs.filter(m);var l=m;0===f.open_revs.length&&(delete f.open_revs,l=_),["revs","attachments","binary","ajax","latest"].forEach(function(e){e in t&&(f[e]=t[e])}),e.get(n,f,function(e,t){var r;r=e?[{error:e}]:l(t),o(s,n,r),a()})})}var u=t.docs,c=new Fr;u.forEach(function(e){c.has(e.id)?c.get(e.id).push(e):c.set(e.id,[e])});var f=c.size,l=0,d=new Array(f),h=[];c.forEach(function(e,t){h.push(t)});var p=0;a()}function w(){return"undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage&&"undefined"!=typeof chrome.storage.local}function k(){return Ur}function E(e){w()?chrome.storage.onChanged.addListener(function(t){null!=t.db_name&&e.emit(t.dbName.newValue)}):k()&&("undefined"!=typeof addEventListener?addEventListener("storage",function(t){e.emit(t.key)}):window.attachEvent("storage",function(t){e.emit(t.key)}))}function O(){Pr.EventEmitter.call(this),this._listeners={},E(this)}function S(e){if("undefined"!==console&&e in console){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function x(e,t){var n=6e5;e=parseInt(e,10)||0,t=parseInt(t,10),t!==t||t<=e?t=(e||1)<<1:t+=1,t>n&&(e=n>>1,t=n);var r=Math.random(),i=t-e;return~~(i*r+e)}function j(e){var t=0;return e||(t=2e3),x(e,t)}function A(e,t){S("info","The above "+e+" is totally normal. "+t)}function P(e,t,n){Error.call(this,n),this.status=e,this.name=t,this.message=n,this.error=!0}function q(e,t){function n(t){for(var n in e)"function"!=typeof e[n]&&(this[n]=e[n]);void 0!==t&&(this.reason=t)}return n.prototype=P.prototype,new n(t)}function T(e){if("object"!==("undefined"==typeof e?"undefined":fe(e))){var t=e;e=Yr,e.data=t}return"error"in e&&"conflict"===e.error&&(e.name="conflict",e.status=409),"name"in e||(e.name=e.error||"unknown"),"status"in e||(e.status=500),"message"in e||(e.message=e.message||e.reason),e}function C(e,t,n){try{return!e(t,n)}catch(e){var r="Filter function threw: "+e.toString();return q(ni,r)}}function R(e){var t={},n=e.filter&&"function"==typeof e.filter;return t.query=e.query_params,function(r){r.doc||(r.doc={});var i=n&&C(e.filter,r.doc,t);if("object"===("undefined"==typeof i?"undefined":fe(i)))return i;if(i)return!1;if(e.include_docs){if(!e.attachments)for(var o in r.doc._attachments)r.doc._attachments.hasOwnProperty(o)&&(r.doc._attachments[o].stub=!0)}else delete r.doc;return!0}}function L(e){for(var t=[],n=0,r=e.length;n<r;n++)t=t.concat(e[n]);return t}function D(){}function I(e){var t;if(e?"string"!=typeof e?t=q(Gr):/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=q(Qr)):t=q($r),t)throw t}function N(e,t){return"listenerCount"in e?e.listenerCount(t):Pr.EventEmitter.listenerCount(e,t)}function M(e){if(!e)return null;var t=e.split("/");return 2===t.length?t:1===t.length?[e,e]:null}function B(e){var t=M(e);return t?t.join("/"):null}function F(e){for(var t=di.exec(e),n={},r=14;r--;){var i=ci[r],o=t[r]||"",a=["user","password"].indexOf(i)!==-1;n[i]=a?decodeURIComponent(o):o}return n[fi]={},n[ci[12]].replace(li,function(e,t,r){t&&(n[fi][t]=r)}),n}function U(e,t,n){return new Dr(function(r,i){e.get(t,function(o,a){if(o){if(404!==o.status)return i(o);a={}}var s=a._rev,u=n(a);return u?(u._id=t,u._rev=s,void r(z(e,u,n))):r({updated:!1,rev:s})})})}function z(e,t,n){return e.put(t).then(function(e){return{updated:!0,rev:e.rev}},function(r){if(409!==r.status)throw r;return U(e,t._id,n)})}function H(e){return 0|Math.random()*e}function J(e,t){t=t||hi.length;var n="",r=-1;if(e){for(;++r<e;)n+=hi[H(t)];return n}for(;++r<36;)switch(r){case 8:case 13:case 18:case 23:n+="-";break;case 19:n+=hi[3&H(16)|8];break;default:n+=hi[H(16)]}return n}function W(e){for(var t,n,r,i,o=e.rev_tree.slice();i=o.pop();){var a=i.ids,s=a[2],u=i.pos;if(s.length)for(var c=0,f=s.length;c<f;c++)o.push({pos:u+1,ids:s[c]});else{var l=!!a[1].deleted,d=a[0];t&&!(r!==l?r:n!==u?n<u:t<d)||(t=d,n=u,r=l)}}return n+"-"+t}function K(e,t){for(var n,r=e.slice();n=r.pop();)for(var i=n.pos,o=n.ids,a=o[2],s=t(0===a.length,i,o[0],n.ctx,o[1]),u=0,c=a.length;u<c;u++)r.push({pos:i+1,ids:a[u],ctx:s})}function V(e,t){return e.pos-t.pos}function X(e){var t=[];K(e,function(e,n,r,i,o){e&&t.push({rev:n+"-"+r,pos:n,opts:o})}),t.sort(V).reverse();for(var n=0,r=t.length;n<r;n++)delete t[n].pos;return t}function G(e){for(var t=W(e),n=X(e.rev_tree),r=[],i=0,o=n.length;i<o;i++){var a=n[i];a.rev===t||a.opts.deleted||r.push(a.rev)}return r}function $(e){var t=[];return K(e.rev_tree,function(e,n,r,i,o){"available"!==o.status||e||(t.push(n+"-"+r),o.status="missing")}),t}function Q(e){for(var t,n=[],r=e.slice();t=r.pop();){var i=t.pos,o=t.ids,a=o[0],s=o[1],u=o[2],c=0===u.length,f=t.history?t.history.slice():[];f.push({id:a,opts:s}),c&&n.push({pos:i+1-f.length,ids:f});for(var l=0,d=u.length;l<d;l++)r.push({pos:i+1,ids:u[l],history:f})}return n.reverse()}function Y(e,t){return e.pos-t.pos}function Z(e,t,n){for(var r,i=0,o=e.length;i<o;)r=i+o>>>1,n(e[r],t)<0?i=r+1:o=r;return i}function ee(e,t,n){var r=Z(e,t,n);e.splice(r,0,t)}function te(e,t){for(var n,r,i=t,o=e.length;i<o;i++){var a=e[i],s=[a.id,a.opts,[]];r?(r[2].push(s),r=s):n=r=s}return n}function ne(e,t){return e[0]<t[0]?-1:1}function re(e,t){for(var n=[{tree1:e,tree2:t}],r=!1;n.length>0;){var i=n.pop(),o=i.tree1,a=i.tree2;(o[1].status||a[1].status)&&(o[1].status="available"===o[1].status||"available"===a[1].status?"available":"missing");for(var s=0;s<a[2].length;s++)if(o[2][0]){for(var u=!1,c=0;c<o[2].length;c++)o[2][c][0]===a[2][s][0]&&(n.push({tree1:o[2][c],tree2:a[2][s]}),u=!0);u||(r="new_branch",ee(o[2],a[2][s],ne))}else r="new_leaf",o[2][0]=a[2][s]}return{conflicts:r,tree:e}}function ie(e,t,n){var r,i=[],o=!1,a=!1;if(!e.length)return{tree:[t],conflicts:"new_leaf"};for(var s=0,u=e.length;s<u;s++){var c=e[s];if(c.pos===t.pos&&c.ids[0]===t.ids[0])r=re(c.ids,t.ids),i.push({pos:c.pos,ids:r.tree}),o=o||r.conflicts,a=!0;else if(n!==!0){var f=c.pos<t.pos?c:t,l=c.pos<t.pos?t:c,d=l.pos-f.pos,h=[],p=[];for(p.push({ids:f.ids,diff:d,parent:null,parentIdx:null});p.length>0;){var v=p.pop();if(0!==v.diff)for(var y=v.ids[2],g=0,m=y.length;g<m;g++)p.push({ids:y[g],diff:v.diff-1,parent:v.ids,parentIdx:g});else v.ids[0]===l.ids[0]&&h.push(v)}var _=h[0];_?(r=re(_.ids,l.ids),_.parent[2][_.parentIdx]=r.tree,i.push({pos:f.pos,ids:f.ids}),o=o||r.conflicts,a=!0):i.push(c)}else i.push(c)}return a||i.push(t),i.sort(Y),{tree:i,conflicts:o||"internal_node"}}function oe(e,t){for(var n,r,i=Q(e),o=0,a=i.length;o<a;o++){var s,u=i[o],c=u.ids;if(c.length>t){n||(n={});var f=c.length-t;s={pos:u.pos+f,ids:te(c,f)};for(var l=0;l<f;l++){var d=u.pos+l+"-"+c[l].id;n[d]=!0}}else s={pos:u.pos,ids:te(c,0)};r=r?ie(r,s,!0).tree:[s]}return n&&K(r,function(e,t,r){delete n[t+"-"+r]}),{tree:r,revs:n?Object.keys(n):[]}}function ae(e,t,n){var r=ie(e,t),i=oe(r.tree,n);return{tree:i.tree,stemmedRevs:i.revs,conflicts:r.conflicts}}function se(e,t){for(var n,r=e.slice(),i=t.split("-"),o=parseInt(i[0],10),a=i[1];n=r.pop();){if(n.pos===o&&n.ids[0]===a)return!0;for(var s=n.ids[2],u=0,c=s.length;u<c;u++)r.push({pos:n.pos+1,ids:s[u]})}return!1}function ue(e){return e.ids}function ce(e,t){t||(t=W(e));for(var n,r=t.substring(t.indexOf("-")+1),i=e.rev_tree.map(ue);n=i.pop();){if(n[0]===r)return!!n[1].deleted;i=i.concat(n[2])}}function le(e){return/^_local/.test(e)}function de(e,t){for(var n,r=t.rev_tree.slice();n=r.pop();){var i=n.pos,o=n.ids,a=o[0],s=o[1],u=o[2],c=0===u.length,f=n.history?n.history.slice():[];if(f.push({id:a,pos:i,opts:s}),c)for(var l=0,d=f.length;l<d;l++){var h=f[l],p=h.pos+"-"+h.id;if(p===e)return i+"-"+a}for(var v=0,y=u.length;v<y;v++)r.push({pos:i+1,ids:u[v],history:f})}throw new Error("Unable to resolve latest revision for id "+t.id+", rev "+e)}function he(e){return Cr('"use strict";\nreturn '+e+";",{})}function pe(e){var t=["return function(doc) {",'  "use strict";',"  var emitted = false;","  var emit = function (a, b) {","    emitted = true;","  };","  var view = "+e+";","  view(doc);","  if (emitted) {","    return true;","  }","};"].join("\n");return Cr(t,{})}function ve(e,t){try{e.emit("change",t)}catch(e){S("error",'Error in .on("change", function):',e)}}function ye(e,t,n){function r(){i.cancel()}Pr.EventEmitter.call(this);var i=this;this.db=e,t=t?u(t):{};var o=t.complete=c(function(t,n){t?N(i,"error")>0&&i.emit("error",t):i.emit("complete",n),i.removeAllListeners(),e.removeListener("destroyed",r)});n&&(i.on("complete",function(e){n(null,e)}),i.on("error",n)),e.once("destroyed",r),t.onChange=function(e){i.isCancelled||ve(i,e)};var a=new Dr(function(e,n){t.complete=function(t,r){t?n(t):e(r)}});i.once("cancel",function(){e.removeListener("destroyed",r),t.complete(null,{status:"cancelled"})}),this.then=a.then.bind(a),this.catch=a.catch.bind(a),this.then(function(e){o(null,e)},o),e.taskqueue.isReady?i.doChanges(t):e.taskqueue.addTask(function(e){e?t.complete(e):i.isCancelled?i.emit("cancel"):i.doChanges(t)})}function ge(e,t,n){var r=[{rev:e._rev}];"all_docs"===n.style&&(r=X(t.rev_tree).map(function(e){return{rev:e.rev}}));var i={id:t.id,changes:r,doc:e};return ce(t,e._rev)&&(i.deleted=!0),n.conflicts&&(i.doc._conflicts=G(t),i.doc._conflicts.length||delete i.doc._conflicts),i}function me(e,t){return e<t?-1:e>t?1:0}function _e(e){return function(t,n){t||n[0]&&n[0].error?e(t||n[0]):e(null,n.length?n[0]:n)}}function be(e){for(var t=0;t<e.length;t++){var n=e[t];if(n._deleted)delete n._attachments;else if(n._attachments)for(var r=Object.keys(n._attachments),i=0;i<r.length;i++){var o=r[i];n._attachments[o]=g(n._attachments[o],["data","digest","content_type","length","revpos","stub"])}}}function we(e,t){var n=me(e._id,t._id);if(0!==n)return n;var r=e._revisions?e._revisions.start:0,i=t._revisions?t._revisions.start:0;return me(r,i)}function ke(e){var t={},n=[];return K(e,function(e,r,i,o){var a=r+"-"+i;return e&&(t[a]=0),void 0!==o&&n.push({from:o,to:a}),a}),n.reverse(),n.forEach(function(e){void 0===t[e.from]?t[e.from]=1+t[e.to]:t[e.from]=Math.min(t[e.from],1+t[e.to])}),t}function Ee(e,t,n){var r="limit"in t?t.keys.slice(t.skip,t.limit+t.skip):t.skip>0?t.keys.slice(t.skip):t.keys;if(t.descending&&r.reverse(),!r.length)return e._allDocs({limit:0},n);var i={offset:t.skip};return Dr.all(r.map(function(n){var r=Jr({key:n,deleted:"ok"},t);return["limit","skip","keys"].forEach(function(e){delete r[e]}),new Dr(function(t,o){e._allDocs(r,function(e,r){return e?o(e):(i.total_rows=r.total_rows,void t(r.rows[0]||{key:n,error:"not_found"}))})})})).then(function(e){return i.rows=e,i})}function Oe(e){var t=e._compactionQueue[0],n=t.opts,r=t.callback;e.get("_local/compaction").catch(function(){return!1}).then(function(t){t&&t.last_seq&&(n.last_seq=t.last_seq),e._compact(n,function(t,n){t?r(t):r(null,n),Tr(function(){e._compactionQueue.shift(),e._compactionQueue.length&&Oe(e)})})})}function Se(e){return"_"===e.charAt(0)&&e+" is not a valid attachment name, attachment names cannot start with '_'"}function xe(){Pr.EventEmitter.call(this)}function je(){this.isReady=!1,this.failed=!1,this.queue=[]}function Ae(e,t){var n=e.match(/([a-z\-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+"://"+n[2]:n[2],adapter:n[1]};var r=qe.adapters,i=qe.preferredAdapters,o=qe.prefix,a=t.adapter;if(!a)for(var s=0;s<i.length;++s){a=i[s];{if(!("idb"===a&&"websql"in r&&k()&&localStorage["_pouch__websqldb_"+o+e]))break;S("log",'PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.')}}var u=r[a],c=!(u&&"use_prefix"in u)||u.use_prefix;return{name:c?o+e:e,adapter:a}}function Pe(e){function t(){e.removeListener("closed",r),e.constructor.emit("destroyed",e.name)}function n(){e.removeListener("destroyed",t),e.removeListener("closed",r),e.emit("destroyed")}function r(){e.removeListener("destroyed",t),i.delete(e.name)}var i=e.constructor._destructionListeners;e.once("destroyed",t),e.once("closed",r),i.has(e.name)||i.set(e.name,[]),i.get(e.name).push(n)}function qe(e,t){if(!(this instanceof qe))return new qe(e,t);var n=this;if(t=t||{},e&&"object"===("undefined"==typeof e?"undefined":fe(e))&&(t=e,e=t.name,delete t.name),this.__opts=t=u(t),n.auto_compaction=t.auto_compaction,n.prefix=qe.prefix,"string"!=typeof e)throw new Error("Missing/invalid DB name");var r=(t.prefix||"")+e,i=Ae(r,t);if(t.name=i.name,t.adapter=t.adapter||i.adapter,n.name=e,n._adapter=t.adapter,Ar("pouchdb:adapter")("Picked adapter: "+t.adapter),!qe.adapters[t.adapter]||!qe.adapters[t.adapter].valid())throw new Error("Invalid Adapter: "+t.adapter);xe.call(n),n.taskqueue=new je,n.adapter=t.adapter,qe.adapters[t.adapter].call(n,t,function(e){return e?n.taskqueue.fail(e):(Pe(n),n.emit("created",n),qe.emit("created",n.name),void n.taskqueue.ready(n))})}function Te(e){Object.keys(Pr.EventEmitter.prototype).forEach(function(t){"function"==typeof Pr.EventEmitter.prototype[t]&&(e[t]=pi[t].bind(pi))});var t=e._destructionListeners=new Fr;e.on("destroyed",function(e){t.get(e).forEach(function(e){e()}),t.delete(e)})}function Ce(e){return e.reduce(function(e,t){return e[t]=!0,e},{})}function Re(e){if(!/^\d+\-./.test(e))return q(ai);var t=e.indexOf("-"),n=e.substring(0,t),r=e.substring(t+1);return{prefix:parseInt(n,10),id:r}}function Le(e,t){for(var n=e.start-e.ids.length+1,r=e.ids,i=[r[0],t,[]],o=1,a=r.length;o<a;o++)i=[r[o],{status:"missing"},[i]];return[{pos:n,ids:i}]}function De(e,t){var n,r,i,o={status:"available"};if(e._deleted&&(o.deleted=!0),t)if(e._id||(e._id=J()),r=J(32,16).toLowerCase(),e._rev){if(i=Re(e._rev),i.error)return i;e._rev_tree=[{pos:i.prefix,ids:[i.id,{status:"missing"},[[r,o,[]]]]}],n=i.prefix+1}else e._rev_tree=[{pos:1,ids:[r,o,[]]}],n=1;else if(e._revisions&&(e._rev_tree=Le(e._revisions,o),n=e._revisions.start,r=e._revisions.ids[0]),!e._rev_tree){if(i=Re(e._rev),i.error)return i;n=i.prefix,r=i.id,e._rev_tree=[{pos:n,ids:[r,o,[]]}]}I(e._id),e._rev=n+"-"+r;var a={metadata:{},data:{}};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){var u="_"===s[0];if(u&&!gi[s]){var c=q(ti,s);throw c.message=ti.message+": "+s,c}u&&!mi[s]?a.metadata[s.slice(1)]=e[s]:a.data[s]=e[s]}return a}function Ie(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if("TypeError"!==o.name)throw o;for(var n="undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof MSBlobBuilder?MSBlobBuilder:"undefined"!=typeof MozBlobBuilder?MozBlobBuilder:WebKitBlobBuilder,r=new n,i=0;i<e.length;i+=1)r.append(e[i]);return r.getBlob(t.type)}}function Ne(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),i=0;i<t;i++)r[i]=e.charCodeAt(i);return n}function Me(e,t){return Ie([Ne(e)],{type:t})}function Be(e,t){return Me(_i(e),t)}function Fe(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,i=0;i<r;i++)t+=String.fromCharCode(n[i]);return t}function Ue(e,t){if("undefined"==typeof FileReader)return t(Fe((new FileReaderSync).readAsArrayBuffer(e)));var n=new FileReader,r="function"==typeof n.readAsBinaryString;n.onloadend=function(e){var n=e.target.result||"";return r?t(n):void t(Fe(n))},r?n.readAsBinaryString(e):n.readAsArrayBuffer(e)}function ze(e,t){Ue(e,function(e){t(e)})}function He(e,t){ze(e,function(e){t(bi(e))})}function Je(e,t){if("undefined"==typeof FileReader)return t((new FileReaderSync).readAsArrayBuffer(e));var n=new FileReader;n.onloadend=function(e){var n=e.target.result||new ArrayBuffer(0);t(n)},n.readAsArrayBuffer(e)}function We(e){return bi(e)}function Ke(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.slice(t,n)}function Ve(e,t,n,r,i){(n>0||r<t.size)&&(t=Ke(t,n,r)),Je(t,function(t){e.append(t),i()})}function Xe(e,t,n,r,i){(n>0||r<t.length)&&(t=t.substring(n,r)),e.appendBinary(t),i()}function Ge(e,t){function n(){wi(i)}function r(){var e=f.end(!0),n=We(e);t(n),f.destroy()}function i(){var t=c*s,i=t+s;c++,c<u?l(f,e,t,i,n):l(f,e,t,i,r)}var o="string"==typeof e,a=o?e.length:e.size,s=Math.min(ki,a),u=Math.ceil(a/s),c=0,f=o?new Rr:new Rr.ArrayBuffer,l=o?Xe:Ve;i()}function $e(e){return Rr.hash(e)}function Qe(e){try{return _i(e)}catch(e){var t=q(Zr,"Attachment is not a valid base64 string");return{error:t}}}function Ye(e,t,n){var r=Qe(e.data);return r.error?n(r.error):(e.length=r.length,"blob"===t?e.data=Me(r,e.content_type):"base64"===t?e.data=bi(r):e.data=r,void Ge(r,function(t){e.digest="md5-"+t,n()}))}function Ze(e,t,n){Ge(e.data,function(r){e.digest="md5-"+r,e.length=e.data.size||e.data.length||0,"binary"===t?ze(e.data,function(t){e.data=t,n()}):"base64"===t?He(e.data,function(t){e.data=t,n()}):n()})}function et(e,t,n){return e.stub?n():void("string"==typeof e.data?Ye(e,t,n):Ze(e,t,n))}function tt(e,t,n){function r(){o++,e.length===o&&(i?n(i):n())}if(!e.length)return n();var i,o=0;e.forEach(function(e){function n(e){i=e,a++,a===o.length&&r()}var o=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],a=0;if(!o.length)return r();for(var s in e.data._attachments)e.data._attachments.hasOwnProperty(s)&&et(e.data._attachments[s],t,n)})}function nt(e,t,n,r,i,o,a,s){if(se(t.rev_tree,n.metadata.rev))return r[i]=n,o();var u=t.winningRev||W(t),c="deleted"in t?t.deleted:ce(t,u),f="deleted"in n.metadata?n.metadata.deleted:ce(n.metadata),l=/^1-/.test(n.metadata.rev);if(c&&!f&&s&&l){var d=n.data;d._rev=u,d._id=n.metadata.id,n=De(d,s)}var h=ae(t.rev_tree,n.metadata.rev_tree[0],e),p=s&&(c&&f&&"new_leaf"!==h.conflicts||!c&&"new_leaf"!==h.conflicts||c&&!f&&"new_branch"===h.conflicts);if(p){var v=q(Xr);return r[i]=v,o()}var y=n.metadata.rev;n.metadata.rev_tree=h.tree,n.stemmedRevs=h.stemmedRevs||[],t.rev_map&&(n.metadata.rev_map=t.rev_map);var g,m=W(n.metadata),_=ce(n.metadata,m),b=c===_?0:c<_?-1:1;g=y===m?_:ce(n.metadata,y),a(n,m,_,g,!0,b,i,o)}function rt(e){return"missing"===e.metadata.rev_tree[0].ids[1].status}function it(e,t,n,r,i,o,a,s,u){function c(e,t,n){var r=W(e.metadata),i=ce(e.metadata,r);if("was_delete"in s&&i)return o[t]=q(Vr,"deleted"),n();var u=l&&rt(e);if(u){var c=q(Xr);return o[t]=c,n()}var f=i?0:1;a(e,r,i,i,!1,f,t,n)}function f(){++h===p&&u&&u()}e=e||1e3;var l=s.new_edits,d=new Fr,h=0,p=t.length;t.forEach(function(e,t){if(e._id&&le(e._id)){var r=e._deleted?"_removeLocal":"_putLocal";return void n[r](e,{ctx:i},function(e,n){o[t]=e||n,f()})}var a=e.metadata.id;d.has(a)?(p--,d.get(a).push([e,t])):d.set(a,[[e,t]])}),d.forEach(function(t,n){function i(){++u<t.length?s():f()}function s(){var s=t[u],f=s[0],d=s[1];if(r.has(n))nt(e,r.get(n),f,o,d,i,a,l);else{var h=ae([],f.metadata.rev_tree[0],e);f.metadata.rev_tree=h.tree,f.stemmedRevs=h.stemmedRevs||[],c(f,d,i)}}var u=0;s()})}function ot(e){try{return JSON.parse(e)}catch(t){return Lr.parse(e)}}function at(e){try{return JSON.stringify(e)}catch(t){return Lr.stringify(e)}}function st(e){return function(t){var n="unknown_error";t.target&&t.target.error&&(n=t.target.error.name||t.target.error.message),e(q(ii,n,t.type))}}function ut(e,t,n){return{data:at(e),winningRev:t,deletedOrLocal:n?"1":"0",seq:e.seq,id:e.id}}function ct(e){if(!e)return null;var t=ot(e.data);return t.winningRev=e.winningRev,t.deleted="1"===e.deletedOrLocal,t.seq=e.seq,t}function ft(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(":");return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function lt(e,t,n,r){n?r(e?"string"!=typeof e?e:Be(e,t):Ie([""],{type:t})):e?"string"!=typeof e?Ue(e,function(e){r(bi(e))}):r(e):r("")}function dt(e,t,n,r){function i(){++s===a.length&&r&&r()}function o(e,t){var r=e._attachments[t],o=r.digest,a=n.objectStore(xi).get(o);a.onsuccess=function(e){r.body=e.target.result.body,i()}}var a=Object.keys(e._attachments||{});if(!a.length)return r&&r();var s=0;a.forEach(function(n){t.attachments&&t.include_docs?o(e,n):(e._attachments[n].stub=!0,i())})}function ht(e,t){return Dr.all(e.map(function(e){if(e.doc&&e.doc._attachments){var n=Object.keys(e.doc._attachments);return Dr.all(n.map(function(n){var r=e.doc._attachments[n];if("body"in r){var i=r.body,o=r.content_type;return new Dr(function(a){lt(i,o,t,function(t){e.doc._attachments[n]=Jr(g(r,["digest","content_type"]),{data:t}),a()})})}}))}}))}function pt(e,t,n){function r(){c--,c||i()}function i(){o.length&&o.forEach(function(e){var t=u.index("digestSeq").count(IDBKeyRange.bound(e+"::",e+"::",!1,!1));t.onsuccess=function(t){var n=t.target.result;n||s.delete(e)}})}var o=[],a=n.objectStore(Si),s=n.objectStore(xi),u=n.objectStore(ji),c=e.length;e.forEach(function(e){var n=a.index("_doc_id_rev"),i=t+"::"+e;n.getKey(i).onsuccess=function(e){var t=e.target.result;if("number"!=typeof t)return r();a.delete(t);var n=u.index("seq").openCursor(IDBKeyRange.only(t));n.onsuccess=function(e){var t=e.target.result;if(t){var n=t.value.digestSeq.split("::")[0];o.push(n),u.delete(t.primaryKey),t.continue()}else r()}}})}function vt(e,t,n){try{return{txn:e.transaction(t,n)}}catch(e){return{error:e}}}function yt(e,t,n,r,i,o){function a(){var e=[Oi,Si,xi,Pi,ji,Ai],t=vt(i,e,"readwrite");return t.error?o(t.error):(_=t.txn,_.onabort=st(o),_.ontimeout=st(o),_.oncomplete=l,b=_.objectStore(Oi),w=_.objectStore(Si),k=_.objectStore(xi),E=_.objectStore(ji),O=_.objectStore(Ai),O.get(Ai).onsuccess=function(e){x=e.target.result,c()},void h(function(e){return e?(I=!0,o(e)):void f()}))}function s(){C=!0,c()}function u(){it(e.revs_limit,j,r,D,_,L,p,n,s)}function c(){x&&C&&(x.docCount+=R,O.put(x))}function f(){function e(){++n===j.length&&u()}function t(t){var n=ct(t.target.result);n&&D.set(n.id,n),e()}if(j.length)for(var n=0,r=0,i=j.length;r<i;r++){var o=j[r];if(o._id&&le(o._id))e();else{var a=b.get(o.metadata.id);a.onsuccess=t}}}function l(){I||(Ti.notify(r._meta.name),o(null,L))}function d(e,t){var n=k.get(e);n.onsuccess=function(n){if(n.target.result)t();else{var r=q(si,"unknown stub attachment with digest "+e);r.status=412,t(r)}}}function h(e){function t(){++i===n.length&&e(r)}var n=[];if(j.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(t){var r=e.data._attachments[t];r.stub&&n.push(r.digest)})}),!n.length)return e();var r,i=0;n.forEach(function(e){d(e,function(e){e&&!r&&(r=e),t()})})}function p(e,t,n,r,i,o,a,s){e.metadata.winningRev=t,e.metadata.deleted=n;var u=e.data;u._id=e.metadata.id,u._rev=e.metadata.rev,r&&(u._deleted=!0);var f=u._attachments&&Object.keys(u._attachments).length;return f?y(e,t,n,i,a,s):(R+=o,c(),void v(e,t,n,i,a,s))}function v(e,t,n,i,o,a){function s(o){var a=e.stemmedRevs||[];i&&r.auto_compaction&&(a=a.concat($(e.metadata))),a&&a.length&&pt(a,e.metadata.id,_),l.seq=o.target.result;var s=ut(l,t,n),u=b.put(s);u.onsuccess=c}function u(e){e.preventDefault(),e.stopPropagation();var t=w.index("_doc_id_rev"),n=t.getKey(f._doc_id_rev);n.onsuccess=function(e){var t=w.put(f,e.target.result);t.onsuccess=s}}function c(){L[o]={ok:!0,id:l.id,rev:l.rev},D.set(e.metadata.id,e.metadata),g(e,l.seq,a)}var f=e.data,l=e.metadata;f._doc_id_rev=l.id+"::"+l.rev,delete f._id,delete f._rev;var d=w.put(f);d.onsuccess=s,d.onerror=u}function y(e,t,n,r,i,o){function a(){c===f.length&&v(e,t,n,r,i,o)}function s(){c++,a()}var u=e.data,c=0,f=Object.keys(u._attachments);f.forEach(function(n){var r=e.data._attachments[n];if(r.stub)c++,a();else{var i=r.data;delete r.data,r.revpos=parseInt(t,10);var o=r.digest;m(o,i,s)}})}function g(e,t,n){function r(){++o===a.length&&n()}function i(n){var i=e.data._attachments[n].digest,o=E.put({seq:t,digestSeq:i+"::"+t});o.onsuccess=r,o.onerror=function(e){e.preventDefault(),e.stopPropagation(),r()}}var o=0,a=Object.keys(e.data._attachments||{});if(!a.length)return n();for(var s=0;s<a.length;s++)i(a[s])}function m(e,t,n){var r=k.count(e);r.onsuccess=function(r){var i=r.target.result;if(i)return n();var o={digest:e,body:t},a=k.put(o);a.onsuccess=n}}for(var _,b,w,k,E,O,S,x,j=t.docs,A=0,P=j.length;A<P;A++){var T=j[A];T._id&&le(T._id)||(T=j[A]=De(T,n.new_edits),T.error&&!S&&(S=T))}if(S)return o(S);var C=!1,R=0,L=new Array(j.length),D=new Fr,I=!1,N=r._meta.blobSupport?"blob":"base64";tt(j,N,function(e){return e?o(e):void a()})}function gt(e,t,n,r,i){function o(e){f=e.target.result,c&&i(c,f,l)}function a(e){c=e.target.result,f&&i(c,f,l)}function s(){if(!c.length)return i();var n,s=c[c.length-1];if(t&&t.upper)try{n=IDBKeyRange.bound(s,t.upper,!0,t.upperOpen)}catch(e){if("DataError"===e.name&&0===e.code)return i()}else n=IDBKeyRange.lowerBound(s,!0);t=n,c=null,f=null,e.getAll(t,r).onsuccess=o,e.getAllKeys(t,r).onsuccess=a}function u(e){var t=e.target.result;return t?void i([t.key],[t.value],t):i()}var c,f,l,d="function"==typeof e.getAll&&"function"==typeof e.getAllKeys&&r>1&&!n;d?(l={continue:s},e.getAll(t,r).onsuccess=o,e.getAllKeys(t,r).onsuccess=a):n?e.openCursor(t,"prev").onsuccess=u:e.openCursor(t).onsuccess=u}function mt(e,t,n){function r(e){var t=e.target.result;t?(i.push(t.value),t.continue()):n({target:{result:i}})}if("function"==typeof e.getAll)return void(e.getAll(t).onsuccess=n);var i=[];e.openCursor(t).onsuccess=r}function _t(e,t,n,r,i){try{if(e&&t)return i?IDBKeyRange.bound(t,e,!n,!1):IDBKeyRange.bound(e,t,!1,!n);if(e)return i?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return i?IDBKeyRange.lowerBound(t,!n):IDBKeyRange.upperBound(t,!n);if(r)return IDBKeyRange.only(r)}catch(e){return{error:e}}return null}function bt(e,t,n){function r(t,n,r){var i=t.id+"::"+r;S.get(i).onsuccess=function(r){if(n.doc=ft(r.target.result),e.conflicts){var i=G(t);i.length&&(n.doc._conflicts=i)}dt(n.doc,e,b)}}function i(t,n){var i={id:n.id,key:n.id,value:{rev:t}},o=n.deleted;"ok"===e.deleted?(x.push(i),o?(i.value.deleted=!0,i.doc=null):e.include_docs&&r(n,i,t)):!o&&h--<=0&&(x.push(i),e.include_docs&&r(n,i,t))}function o(e){for(var t=0,n=e.length;t<n&&x.length!==p;t++){var r=e[t],o=ct(r),a=o.winningRev;i(a,o)}}function a(e,t,n){n&&(o(t),x.length<p&&n.continue())}function s(t){var n=t.target.result;e.descending&&(n=n.reverse()),o(n)}function u(){n(null,{total_rows:w,offset:e.skip,rows:x})}function c(){e.attachments?ht(x,e.binary).then(u):u()}var f="startkey"in e&&e.startkey,l="endkey"in e&&e.endkey,d="key"in e&&e.key,h=e.skip||0,p="number"==typeof e.limit?e.limit:-1,v=e.inclusive_end!==!1,y=_t(f,l,v,d,e.descending),g=y&&y.error;if(g&&("DataError"!==g.name||0!==g.code))return n(q(ii,g.name,g.message));var m=[Oi,Si,Ai];e.attachments&&m.push(xi);var _=vt(t,m,"readonly");if(_.error)return n(_.error);var b=_.txn;b.oncomplete=c,b.onabort=st(n);var w,k=b.objectStore(Oi),E=b.objectStore(Si),O=b.objectStore(Ai),S=E.index("_doc_id_rev"),x=[];return O.get(Ai).onsuccess=function(e){w=e.target.result.docCount},g||0===p?void 0:p===-1?mt(k,y,s):void gt(k,y,e.descending,p+h,a)}function wt(e){return new Dr(function(t){var n=Ie([""]),r=e.objectStore(qi).put(n,"key");r.onsuccess=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||parseInt(e[1],10)>=43)},e.onabort=function(e){e.preventDefault(),e.stopPropagation(),t(!1)}}).catch(function(){
return!1})}function kt(e,t){var n=e.objectStore(Oi).index("deletedOrLocal");n.count(IDBKeyRange.only("0")).onsuccess=function(e){t(e.target.result)}}function Et(e,t,n,r){try{e(t,n)}catch(e){r.emit("error",e)}}function Ot(){!Ci&&Ri.length&&(Ci=!0,Ri.shift()())}function St(e,t,n){Ri.push(function(){e(function(e,r){Et(t,e,r,n),Ci=!1,Tr(function(){Ot(n)})})}),Ot()}function xt(e,t,n,r){function i(t,n,r){function i(t,n){var r=e.processChange(n,t,e);d=r.seq=t.seq;var i=w(r);return"object"===("undefined"==typeof i?"undefined":fe(i))?e.complete(i):void(i&&(b++,p&&_.push(r),e.attachments&&e.include_docs?dt(n,e,v,function(){ht([r],e.binary).then(function(){e.onChange(r)})}):e.onChange(r)))}function o(){for(var e=0,t=s.length;e<t&&b!==h;e++){var n=s[e];if(n){var o=u[e];i(o,n)}}b!==h&&r.continue()}if(r&&t.length){var s=new Array(t.length),u=new Array(t.length),c=0;n.forEach(function(e,n){var r=ft(e),i=t[n];a(r,i,function(e,r){u[n]=e,s[n]=r,++c===t.length&&o()})})}}function o(e,t,n,r){if(n.seq!==t)return r();if(n.winningRev===e._rev)return r(n,e);var i=e._id+"::"+n.winningRev,o=m.get(i);o.onsuccess=function(e){r(n,ft(e.target.result))}}function a(e,t,n){if(l&&!l.has(e._id))return n();var r=k.get(e._id);return r?o(e,t,r,n):void(g.get(e._id).onsuccess=function(i){r=ct(i.target.result),k.set(e._id,r),o(e,t,r,n)})}function s(){e.complete(null,{results:_,last_seq:d})}function c(){!e.continuous&&e.attachments?ht(_).then(s):s()}if(e=u(e),e.continuous){var f=n+":"+J();return Ti.addListener(n,f,t,e),Ti.notify(n),{cancel:function(){Ti.removeListener(n,f)}}}var l=e.doc_ids&&new Br(e.doc_ids);e.since=e.since||0;var d=e.since,h="limit"in e?e.limit:-1;0===h&&(h=1);var p;p="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var v,y,g,m,_=[],b=0,w=R(e),k=new Fr,E=[Oi,Si];e.attachments&&E.push(xi);var O=vt(r,E,"readonly");if(O.error)return e.complete(O.error);v=O.txn,v.onabort=st(e.complete),v.oncomplete=c,y=v.objectStore(Si),g=v.objectStore(Oi),m=y.index("_doc_id_rev");var S=e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,!0):null;gt(y,S,e.descending,h,i)}function jt(e,t){var n=this;St(function(t){At(n,e,t)},t,n.constructor)}function At(e,t,n){function r(e){var t=e.createObjectStore(Oi,{keyPath:"id"});e.createObjectStore(Si,{autoIncrement:!0}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0}),e.createObjectStore(xi,{keyPath:"digest"}),e.createObjectStore(Ai,{keyPath:"id",autoIncrement:!1}),e.createObjectStore(qi),t.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),e.createObjectStore(Pi,{keyPath:"_id"});var n=e.createObjectStore(ji,{autoIncrement:!0});n.createIndex("seq","seq"),n.createIndex("digestSeq","digestSeq",{unique:!0})}function i(e,t){var n=e.objectStore(Oi);n.createIndex("deletedOrLocal","deletedOrLocal",{unique:!1}),n.openCursor().onsuccess=function(e){var r=e.target.result;if(r){var i=r.value,o=ce(i);i.deletedOrLocal=o?"1":"0",n.put(i),r.continue()}else t()}}function o(e){e.createObjectStore(Pi,{keyPath:"_id"}).createIndex("_doc_id_rev","_doc_id_rev",{unique:!0})}function a(e,t){var n=e.objectStore(Pi),r=e.objectStore(Oi),i=e.objectStore(Si),o=r.openCursor();o.onsuccess=function(e){var o=e.target.result;if(o){var a=o.value,s=a.id,u=le(s),c=W(a);if(u){var f=s+"::"+c,l=s+"::",d=s+"::~",h=i.index("_doc_id_rev"),p=IDBKeyRange.bound(l,d,!1,!1),v=h.openCursor(p);v.onsuccess=function(e){if(v=e.target.result){var t=v.value;t._doc_id_rev===f&&n.put(t),i.delete(v.primaryKey),v.continue()}else r.delete(o.primaryKey),o.continue()}}else o.continue()}else t&&t()}}function s(e){var t=e.createObjectStore(ji,{autoIncrement:!0});t.createIndex("seq","seq"),t.createIndex("digestSeq","digestSeq",{unique:!0})}function u(e,t){var n=e.objectStore(Si),r=e.objectStore(xi),i=e.objectStore(ji),o=r.count();o.onsuccess=function(e){var r=e.target.result;return r?void(n.openCursor().onsuccess=function(e){var n=e.target.result;if(!n)return t();for(var r=n.value,o=n.primaryKey,a=Object.keys(r._attachments||{}),s={},u=0;u<a.length;u++){var c=r._attachments[a[u]];s[c.digest]=!0}var f=Object.keys(s);for(u=0;u<f.length;u++){var l=f[u];i.put({seq:o,digestSeq:l+"::"+o})}n.continue()}):t()}}function c(e){function t(e){return e.data?ct(e):(e.deleted="1"===e.deletedOrLocal,e)}var n=e.objectStore(Si),r=e.objectStore(Oi),i=r.openCursor();i.onsuccess=function(e){function i(){var e=s.id+"::",t=s.id+"::",r=n.index("_doc_id_rev").openCursor(IDBKeyRange.bound(e,t)),i=0;r.onsuccess=function(e){var t=e.target.result;if(!t)return s.seq=i,o();var n=t.primaryKey;n>i&&(i=n),t.continue()}}function o(){var e=ut(s,s.winningRev,s.deleted),t=r.put(e);t.onsuccess=function(){a.continue()}}var a=e.target.result;if(a){var s=t(a.value);return s.winningRev=s.winningRev||W(s),s.seq?o():void i()}}}var l=t.name,d=null;e._meta=null,e.type=function(){return"idb"},e._id=f(function(t){t(null,e._meta.instanceId)}),e._bulkDocs=function(n,r,i){yt(t,n,r,e,d,i)},e._get=function(e,t,n){function r(){n(a,{doc:i,metadata:o,ctx:s})}var i,o,a,s=t.ctx;if(!s){var u=vt(d,[Oi,Si,xi],"readonly");if(u.error)return n(u.error);s=u.txn}s.objectStore(Oi).get(e).onsuccess=function(e){if(o=ct(e.target.result),!o)return a=q(Vr,"missing"),r();var n;if(t.rev)n=t.latest?de(t.rev,o):t.rev;else{n=o.winningRev;var u=ce(o);if(u)return a=q(Vr,"deleted"),r()}var c=s.objectStore(Si),f=o.id+"::"+n;c.index("_doc_id_rev").get(f).onsuccess=function(e){return i=e.target.result,i&&(i=ft(i)),i?void r():(a=q(Vr,"missing"),r())}}},e._getAttachment=function(e,t,n,r,i){var o;if(r.ctx)o=r.ctx;else{var a=vt(d,[Oi,Si,xi],"readonly");if(a.error)return i(a.error);o=a.txn}var s=n.digest,u=n.content_type;o.objectStore(xi).get(s).onsuccess=function(e){var t=e.target.result.body;lt(t,u,r.binary,function(e){i(null,e)})}},e._info=function(t){var n,r,i=vt(d,[Ai,Si],"readonly");if(i.error)return t(i.error);var o=i.txn;o.objectStore(Ai).get(Ai).onsuccess=function(e){r=e.target.result.docCount},o.objectStore(Si).openCursor(null,"prev").onsuccess=function(e){var t=e.target.result;n=t?t.key:0},o.oncomplete=function(){t(null,{doc_count:r,update_seq:n,idb_attachment_format:e._meta.blobSupport?"binary":"base64"})}},e._allDocs=function(e,t){bt(e,d,t)},e._changes=function(t){xt(t,e,l,d)},e._close=function(e){d.close(),Li.delete(l),e()},e._getRevisionTree=function(e,t){var n=vt(d,[Oi],"readonly");if(n.error)return t(n.error);var r=n.txn,i=r.objectStore(Oi).get(e);i.onsuccess=function(e){var n=ct(e.target.result);n?t(null,n.rev_tree):t(q(Vr))}},e._doCompaction=function(e,t,n){var r=[Oi,Si,xi,ji],i=vt(d,r,"readwrite");if(i.error)return n(i.error);var o=i.txn,a=o.objectStore(Oi);a.get(e).onsuccess=function(n){var r=ct(n.target.result);K(r.rev_tree,function(e,n,r,i,o){var a=n+"-"+r;t.indexOf(a)!==-1&&(o.status="missing")}),pt(t,e,o);var i=r.winningRev,a=r.deleted;o.objectStore(Oi).put(ut(r,i,a))},o.onabort=st(n),o.oncomplete=function(){n()}},e._getLocal=function(e,t){var n=vt(d,[Pi],"readonly");if(n.error)return t(n.error);var r=n.txn,i=r.objectStore(Pi).get(e);i.onerror=st(t),i.onsuccess=function(e){var n=e.target.result;n?(delete n._doc_id_rev,t(null,n)):t(q(Vr))}},e._putLocal=function(e,t,n){"function"==typeof t&&(n=t,t={}),delete e._revisions;var r=e._rev,i=e._id;r?e._rev="0-"+(parseInt(r.split("-")[1],10)+1):e._rev="0-1";var o,a=t.ctx;if(!a){var s=vt(d,[Pi],"readwrite");if(s.error)return n(s.error);a=s.txn,a.onerror=st(n),a.oncomplete=function(){o&&n(null,o)}}var u,c=a.objectStore(Pi);r?(u=c.get(i),u.onsuccess=function(i){var a=i.target.result;if(a&&a._rev===r){var s=c.put(e);s.onsuccess=function(){o={ok:!0,id:e._id,rev:e._rev},t.ctx&&n(null,o)}}else n(q(Xr))}):(u=c.add(e),u.onerror=function(e){n(q(Xr)),e.preventDefault(),e.stopPropagation()},u.onsuccess=function(){o={ok:!0,id:e._id,rev:e._rev},t.ctx&&n(null,o)})},e._removeLocal=function(e,t,n){"function"==typeof t&&(n=t,t={});var r=t.ctx;if(!r){var i=vt(d,[Pi],"readwrite");if(i.error)return n(i.error);r=i.txn,r.oncomplete=function(){o&&n(null,o)}}var o,a=e._id,s=r.objectStore(Pi),u=s.get(a);u.onerror=st(n),u.onsuccess=function(r){var i=r.target.result;i&&i._rev===e._rev?(s.delete(a),o={ok:!0,id:a,rev:"0-0"},t.ctx&&n(null,o)):n(q(Vr))}},e._destroy=function(e,t){Ti.removeAllListeners(l);var n=Di.get(l);n&&n.result&&(n.result.close(),Li.delete(l));var r=indexedDB.deleteDatabase(l);r.onsuccess=function(){Di.delete(l),k()&&l in localStorage&&delete localStorage[l],t(null,{ok:!0})},r.onerror=st(t)};var h=Li.get(l);if(h)return d=h.idb,e._meta=h.global,Tr(function(){n(null,e)});var p;p=t.storage?Pt(l,t.storage):indexedDB.open(l,Ei),Di.set(l,p),p.onupgradeneeded=function(e){function t(){var e=l[d-1];d++,e&&e(f,t)}var n=e.target.result;if(e.oldVersion<1)return r(n);var f=e.currentTarget.transaction;e.oldVersion<3&&o(n),e.oldVersion<4&&s(n);var l=[i,a,u,c],d=e.oldVersion;t()},p.onsuccess=function(t){function r(){"undefined"!=typeof s&&f&&(e._meta={name:l,instanceId:u,blobSupport:s},Li.set(l,{idb:d,global:e._meta}),n(null,e))}function i(){if("undefined"!=typeof a&&"undefined"!=typeof o){var e=l+"_id";e in o?u=o[e]:o[e]=u=J(),o.docCount=a,c.objectStore(Ai).put(o)}}d=t.target.result,d.onversionchange=function(){d.close(),Li.delete(l)},d.onabort=function(e){S("error","Database has a global failure",e.target.error),d.close(),Li.delete(l)};var o,a,s,u,c=d.transaction([Ai,qi,Oi],"readwrite"),f=!1;c.objectStore(Ai).get(Ai).onsuccess=function(e){o=e.target.result||{id:Ai},i()},kt(c,function(e){a=e,i()}),yi||(yi=wt(c)),yi.then(function(e){s=e,r()}),c.oncomplete=function(){f=!0,r()}},p.onerror=function(){var e="Failed to open indexedDB, are you in private browsing mode?";S("error",e),n(q(ii,e))}}function Pt(e,t){try{return indexedDB.open(e,{version:Ei,storage:t})}catch(t){return indexedDB.open(e,Ei)}}function qt(e){return decodeURIComponent(escape(e))}function Tt(e){return e<65?e-48:e-55}function Ct(e,t,n){for(var r="";t<n;)r+=String.fromCharCode(Tt(e.charCodeAt(t++))<<4|Tt(e.charCodeAt(t++)));return r}function Rt(e,t,n){for(var r="";t<n;)r+=String.fromCharCode(Tt(e.charCodeAt(t+2))<<12|Tt(e.charCodeAt(t+3))<<8|Tt(e.charCodeAt(t))<<4|Tt(e.charCodeAt(t+1))),t+=4;return r}function Lt(e,t){return"UTF-8"===t?qt(Ct(e,0,e.length)):Rt(e,0,e.length)}function Dt(e){return"'"+e+"'"}function It(e){return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"")}function Nt(e){return e.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,"")}function Mt(e){return delete e._id,delete e._rev,JSON.stringify(e)}function Bt(e,t,n){return e=JSON.parse(e),e._id=t,e._rev=n,e}function Ft(e){for(var t="(";e--;)t+="?",e&&(t+=",");return t+")"}function Ut(e,t,n,r,i){return"SELECT "+e+" FROM "+("string"==typeof t?t:t.join(" JOIN "))+(n?" ON "+n:"")+(r?" WHERE "+("string"==typeof r?r:r.join(" AND ")):"")+(i?" ORDER BY "+i:"")}function zt(e,t,n){function r(){++o===e.length&&i()}function i(){if(a.length){var e="SELECT DISTINCT digest AS digest FROM "+Hi+" WHERE seq IN "+Ft(a.length);n.executeSql(e,a,function(e,t){for(var n=[],r=0;r<t.rows.length;r++)n.push(t.rows.item(r).digest);if(n.length){var i="DELETE FROM "+Hi+" WHERE seq IN ("+a.map(function(){return"?"}).join(",")+")";e.executeSql(i,a,function(e){var t="SELECT digest FROM "+Hi+" WHERE digest IN ("+n.map(function(){return"?"}).join(",")+")";e.executeSql(t,n,function(e,t){for(var r=new Br,i=0;i<t.rows.length;i++)r.add(t.rows.item(i).digest);n.forEach(function(t){r.has(t)||(e.executeSql("DELETE FROM "+Hi+" WHERE digest=?",[t]),e.executeSql("DELETE FROM "+Fi+" WHERE digest=?",[t]))})})})}})}}if(e.length){var o=0,a=[];e.forEach(function(e){var i="SELECT seq FROM "+Bi+" WHERE doc_id=? AND rev=?";n.executeSql(i,[t,e],function(e,t){if(!t.rows.length)return r();var n=t.rows.item(0).seq;a.push(n),e.executeSql("DELETE FROM "+Bi+" WHERE seq=?",[n],r)})})}}function Ht(e){return function(t){S("error","WebSQL threw an error",t);var n=t&&t.constructor.toString().match(/function ([^\(]+)/),r=n&&n[1]||t.type,i=t.target||t.message;e(q(oi,i,r))}}function Jt(e){if("size"in e)return 1e6*e.size;var t="undefined"!=typeof navigator&&/Android/.test(navigator.userAgent);return t?5e6:1}function Wt(e,t,n,r,i,o,a){function s(){return _?a(_):(o.notify(r._name),void a(null,b))}function u(e,t){var n="SELECT count(*) as cnt FROM "+Fi+" WHERE digest=?";m.executeSql(n,[e],function(n,r){if(0===r.rows.item(0).cnt){var i=q(si,"unknown stub attachment with digest "+e);t(i)}else t()})}function c(e){function t(){++i===n.length&&e(r)}var n=[];if(y.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(t){var r=e.data._attachments[t];r.stub&&n.push(r.digest)})}),!n.length)return e();var r,i=0;n.forEach(function(e){u(e,function(e){e&&!r&&(r=e),t()})})}function f(e,t,n,i,o,a,s,u){function c(){function t(e,t){function r(){return++o===a.length&&t(),!1}function i(t){var i="INSERT INTO "+Hi+" (digest, seq) VALUES (?,?)",o=[n._attachments[t].digest,e];m.executeSql(i,o,r,r)}var o=0,a=Object.keys(n._attachments||{});if(!a.length)return t();for(var s=0;s<a.length;s++)i(a[s])}var n=e.data,r=i?1:0,o=n._id,a=n._rev,s=Mt(n),u="INSERT INTO "+Bi+" (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);",c=[o,a,s,r];m.executeSql(u,c,function(e,n){var r=n.insertId;t(r,function(){d(e,r)})},function(){var e=Ut("seq",Bi,null,"doc_id=? AND rev=?");return m.executeSql(e,[o,a],function(e,n){var i=n.rows.item(0).seq,u="UPDATE "+Bi+" SET json=?, deleted=? WHERE doc_id=? AND rev=?;",c=[s,r,o,a];e.executeSql(u,c,function(e){t(i,function(){d(e,i)})})}),!1})}function f(e){p||(e?(p=e,u(p)):v===y.length&&c())}function l(e){v++,f(e)}function d(n,i){var a=e.metadata.id,c=e.stemmedRevs||[];o&&r.auto_compaction&&(c=$(e.metadata).concat(c)),c.length&&zt(c,a,n),e.metadata.seq=i;var f=e.metadata.rev;delete e.metadata.rev;var l=o?"UPDATE "+Mi+" SET json=?, max_seq=?, winningseq=(SELECT seq FROM "+Bi+" WHERE doc_id="+Mi+".id AND rev=?) WHERE id=?":"INSERT INTO "+Mi+" (id, winningseq, max_seq, json) VALUES (?,?,?,?);",d=at(e.metadata),h=o?[d,i,t,a]:[a,i,i,d];n.executeSql(l,h,function(){b[s]={ok:!0,id:e.metadata.id,rev:f},w.set(a,e.metadata),u()})}var p=null,v=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev;var y=Object.keys(e.data._attachments||{});i&&(e.data._deleted=!0),y.forEach(function(n){var r=e.data._attachments[n];if(r.stub)v++,f();else{var i=r.data;delete r.data,r.revpos=parseInt(t,10);var o=r.digest;h(o,i,l)}}),y.length||c()}function l(){it(e.revs_limit,y,r,w,m,b,f,n)}function d(e){function t(){++n===y.length&&e()}if(!y.length)return e();var n=0;y.forEach(function(e){if(e._id&&le(e._id))return t();var n=e.metadata.id;m.executeSql("SELECT json FROM "+Mi+" WHERE id = ?",[n],function(e,r){if(r.rows.length){var i=ot(r.rows.item(0).json);w.set(n,i)}t()})})}function h(e,t,n){var r="SELECT digest FROM "+Fi+" WHERE digest=?";m.executeSql(r,[e],function(i,o){return o.rows.length?n():(r="INSERT INTO "+Fi+" (digest, body, escaped) VALUES (?,?,1)",void i.executeSql(r,[e,It(t)],function(){n()},function(){return n(),!1}))})}var p=n.new_edits,v=t.docs,y=v.map(function(e){if(e._id&&le(e._id))return e;var t=De(e,p);return t}),g=y.filter(function(e){return e.error});if(g.length)return a(g[0]);var m,_,b=new Array(y.length),w=new Fr;tt(y,"binary",function(e){return e?a(e):void i.transaction(function(e){m=e,c(function(e){e?_=e:d(l)})},Ht(a),s)})}function Kt(e){return e.websql(e.name,e.version,e.description,e.size)}function Vt(e){try{return{db:Kt(e)}}catch(e){return{error:e}}}function Xt(e){var t=Ji.get(e.name);return t||(t=Vt(e),Ji.set(e.name,t)),t}function Gt(e,t,n,r,i){function o(){++u===s.length&&i&&i()}function a(e,i){var a=e._attachments[i],s={binary:t.binary,ctx:r};n._getAttachment(e._id,i,a,s,function(t,n){e._attachments[i]=Jr(g(a,["digest","content_type"]),{data:n}),o()})}var s=Object.keys(e._attachments||{});if(!s.length)return i&&i();var u=0;s.forEach(function(n){t.attachments&&t.include_docs?a(e,n):(e._attachments[n].stub=!0,o())})}function $t(e,t){function n(){k()&&(window.localStorage["_pouch__websqldb_"+b._name]=!0),t(null,b)}function r(e,t){e.executeSql(Gi),e.executeSql("ALTER TABLE "+Bi+" ADD COLUMN deleted TINYINT(1) DEFAULT 0",[],function(){e.executeSql(Vi),e.executeSql("ALTER TABLE "+Mi+" ADD COLUMN local TINYINT(1) DEFAULT 0",[],function(){e.executeSql("CREATE INDEX IF NOT EXISTS 'doc-store-local-idx' ON "+Mi+" (local, id)");var n="SELECT "+Mi+".winningseq AS seq, "+Mi+".json AS metadata FROM "+Bi+" JOIN "+Mi+" ON "+Bi+".seq = "+Mi+".winningseq";e.executeSql(n,[],function(e,n){for(var r=[],i=[],o=0;o<n.rows.length;o++){var a=n.rows.item(o),s=a.seq,u=JSON.parse(a.metadata);ce(u)&&r.push(s),le(u.id)&&i.push(u.id)}e.executeSql("UPDATE "+Mi+"SET local = 1 WHERE id IN "+Ft(i.length),i,function(){e.executeSql("UPDATE "+Bi+" SET deleted = 1 WHERE seq IN "+Ft(r.length),r,t)})})})})}function i(e,t){var n="CREATE TABLE IF NOT EXISTS "+Ui+" (id UNIQUE, rev, json)";e.executeSql(n,[],function(){var n="SELECT "+Mi+".id AS id, "+Bi+".json AS data FROM "+Bi+" JOIN "+Mi+" ON "+Bi+".seq = "+Mi+".winningseq WHERE local = 1";e.executeSql(n,[],function(e,n){function r(){if(!i.length)return t(e);var n=i.shift(),o=JSON.parse(n.data)._rev;e.executeSql("INSERT INTO "+Ui+" (id, rev, json) VALUES (?,?,?)",[n.id,o,n.data],function(e){e.executeSql("DELETE FROM "+Mi+" WHERE id=?",[n.id],function(e){e.executeSql("DELETE FROM "+Bi+" WHERE seq=?",[n.seq],function(){r()})})})}for(var i=[],o=0;o<n.rows.length;o++)i.push(n.rows.item(o));r()})})}function o(e,t){function n(n){function r(){if(!n.length)return t(e);var i=n.shift(),o=Lt(i.hex,_),a=o.lastIndexOf("::"),s=o.substring(0,a),u=o.substring(a+2),c="UPDATE "+Bi+" SET doc_id=?, rev=? WHERE doc_id_rev=?";e.executeSql(c,[s,u,o],function(){r()})}r()}var r="ALTER TABLE "+Bi+" ADD COLUMN doc_id";e.executeSql(r,[],function(e){var t="ALTER TABLE "+Bi+" ADD COLUMN rev";e.executeSql(t,[],function(e){e.executeSql(Xi,[],function(e){var t="SELECT hex(doc_id_rev) as hex FROM "+Bi;e.executeSql(t,[],function(e,t){for(var r=[],i=0;i<t.rows.length;i++)r.push(t.rows.item(i));n(r)})})})})}function a(e,t){function n(e){var n="SELECT COUNT(*) AS cnt FROM "+Fi;e.executeSql(n,[],function(e,n){function r(){var n=Ut(Zi+", "+Mi+".id AS id",[Mi,Bi],Yi,null,Mi+".id ");n+=" LIMIT "+a+" OFFSET "+o,o+=a,e.executeSql(n,[],function(e,n){function i(e,t){var n=o[e]=o[e]||[];n.indexOf(t)===-1&&n.push(t)}if(!n.rows.length)return t(e);for(var o={},a=0;a<n.rows.length;a++)for(var s=n.rows.item(a),u=Bt(s.data,s.id,s.rev),c=Object.keys(u._attachments||{}),f=0;f<c.length;f++){var l=u._attachments[c[f]];i(l.digest,s.seq)}var d=[];if(Object.keys(o).forEach(function(e){var t=o[e];t.forEach(function(t){d.push([e,t])})}),!d.length)return r();var h=0;d.forEach(function(t){var n="INSERT INTO "+Hi+" (digest, seq) VALUES (?,?)";e.executeSql(n,t,function(){++h===d.length&&r()})})})}var i=n.rows.item(0).cnt;if(!i)return t(e);var o=0,a=10;r()})}var r="CREATE TABLE IF NOT EXISTS "+Hi+" (digest, seq INTEGER)";e.executeSql(r,[],function(e){e.executeSql(Qi,[],function(e){e.executeSql($i,[],n)})})}function s(e,t){var n="ALTER TABLE "+Fi+" ADD COLUMN escaped TINYINT(1) DEFAULT 0";e.executeSql(n,[],t)}function c(e,t){var n="ALTER TABLE "+Mi+" ADD COLUMN max_seq INTEGER";e.executeSql(n,[],function(e){var n="UPDATE "+Mi+" SET max_seq=(SELECT MAX(seq) FROM "+Bi+" WHERE doc_id=id)";e.executeSql(n,[],function(e){var n="CREATE UNIQUE INDEX IF NOT EXISTS 'doc-max-seq-idx' ON "+Mi+" (max_seq)";e.executeSql(n,[],t)})})}function l(e,t){e.executeSql('SELECT HEX("a") AS hex',[],function(e,n){var r=n.rows.item(0).hex;_=2===r.length?"UTF-8":"UTF-16",t()})}function d(){for(;O.length>0;){var e=O.pop();e(null,w)}}function h(e,t){if(0===t){var n="CREATE TABLE IF NOT EXISTS "+zi+" (dbid, db_version INTEGER)",u="CREATE TABLE IF NOT EXISTS "+Fi+" (digest UNIQUE, escaped TINYINT(1), body BLOB)",f="CREATE TABLE IF NOT EXISTS "+Hi+" (digest, seq INTEGER)",l="CREATE TABLE IF NOT EXISTS "+Mi+" (id unique, json, winningseq, max_seq INTEGER UNIQUE)",h="CREATE TABLE IF NOT EXISTS "+Bi+" (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)",p="CREATE TABLE IF NOT EXISTS "+Ui+" (id UNIQUE, rev, json)";e.executeSql(u),e.executeSql(p),e.executeSql(f,[],function(){e.executeSql($i),e.executeSql(Qi)}),e.executeSql(l,[],function(){e.executeSql(Gi),e.executeSql(h,[],function(){e.executeSql(Vi),e.executeSql(Xi),e.executeSql(n,[],function(){var t="INSERT INTO "+zi+" (db_version, dbid) VALUES (?,?)";w=J();var n=[Ni,w];e.executeSql(t,n,function(){d()})})})})}else{var v=function(){var n=t<Ni;n&&e.executeSql("UPDATE "+zi+" SET db_version = "+Ni);var r="SELECT dbid FROM "+zi;e.executeSql(r,[],function(e,t){w=t.rows.item(0).dbid,d()})},y=[r,i,o,a,s,c,v],g=t,m=function e(t){y[g-1](t,e),g++};m(e)}}function p(){j.transaction(function(e){l(e,function(){v(e)})},Ht(t),n)}function v(e){var t="SELECT sql FROM sqlite_master WHERE tbl_name = "+zi;e.executeSql(t,[],function(e,t){t.rows.length?/db_version/.test(t.rows.item(0).sql)?e.executeSql("SELECT db_version FROM "+zi,[],function(e,t){var n=t.rows.item(0).db_version;h(e,n)}):e.executeSql("ALTER TABLE "+zi+" ADD COLUMN db_version INTEGER",[],function(){h(e,1)}):h(e,0)})}function y(e,t){var n="SELECT MAX(seq) AS seq FROM "+Bi;e.executeSql(n,[],function(e,n){var r=n.rows.item(0).seq||0;t(r)})}function g(e,t){var n=Ut("COUNT("+Mi+".id) AS 'num'",[Mi,Bi],Yi,Bi+".deleted=0");e.executeSql(n,[],function(e,n){t(n.rows.item(0).num)})}function m(e,t,n,r,i){var o=Ut(Zi,[Mi,Bi],Yi,Mi+".id=?"),a=[t];e.executeSql(o,a,function(e,t){if(!t.rows.length){var o=q(Vr,"missing");return i(o)}var a=t.rows.item(0),s=ot(a.metadata);r(de(n,s))})}var _,b=this,w=null,E=Jt(e),O=[];b._name=e.name;var S=Jr({},e,{version:Ki,description:e.name,size:E}),x=Xt(S);if(x.error)return Ht(t)(x.error);var j=x.db;"function"!=typeof j.readTransaction&&(j.readTransaction=j.transaction),p(),b.type=function(){return"websql"},b._id=f(function(e){e(null,w)}),b._info=function(e){var t,n;j.readTransaction(function(e){y(e,function(e){t=e}),g(e,function(e){n=e})},Ht(e),function(){e(null,{doc_count:n,update_seq:t,websql_encoding:_})})},b._bulkDocs=function(t,n,r){Wt(e,t,n,b,j,Wi,r)},b._get=function(e,t,n){function r(e){n(e,{doc:i,metadata:o,ctx:a})}var i,o,a=t.ctx;if(!a)return j.readTransaction(function(r){b._get(e,Jr({ctx:r},t),n)});var s,u;if(t.rev){if(t.latest)return void m(a,e,t.rev,function(r){t.latest=!1,t.rev=r,b._get(e,t,n)},r);s=Ut(Zi,[Mi,Bi],Mi+".id="+Bi+".doc_id",[Bi+".doc_id=?",Bi+".rev=?"]),u=[e,t.rev]}else s=Ut(Zi,[Mi,Bi],Yi,Mi+".id=?"),u=[e];a.executeSql(s,u,function(e,n){if(!n.rows.length){var a=q(Vr,"missing");return r(a)}var s=n.rows.item(0);if(o=ot(s.metadata),s.deleted&&!t.rev){var u=q(Vr,"deleted");return r(u)}i=Bt(s.data,o.id,s.rev),r()})},b._allDocs=function(e,t){var n,r=[],i="startkey"in e&&e.startkey,o="endkey"in e&&e.endkey,a="key"in e&&e.key,s="descending"in e&&e.descending,u="limit"in e?e.limit:-1,c="skip"in e?e.skip:0,f=e.inclusive_end!==!1,l=[],d=[];if(a!==!1)d.push(Mi+".id = ?"),l.push(a);else if(i!==!1||o!==!1){if(i!==!1&&(d.push(Mi+".id "+(s?"<=":">=")+" ?"),l.push(i)),o!==!1){var h=s?">":"<";f&&(h+="="),d.push(Mi+".id "+h+" ?"),l.push(o)}a!==!1&&(d.push(Mi+".id = ?"),l.push(a))}"ok"!==e.deleted&&d.push(Bi+".deleted = 0"),j.readTransaction(function(t){if(g(t,function(e){n=e}),0!==u){var i=Ut(Zi,[Mi,Bi],Yi,d,Mi+".id "+(s?"DESC":"ASC"));i+=" LIMIT "+u+" OFFSET "+c,t.executeSql(i,l,function(t,n){for(var i=0,o=n.rows.length;i<o;i++){var a=n.rows.item(i),s=ot(a.metadata),u=s.id,c=Bt(a.data,u,a.rev),f=c._rev,l={id:u,key:u,value:{rev:f}};if(e.include_docs){if(l.doc=c,l.doc._rev=f,e.conflicts){var d=G(s);d.length&&(l.doc._conflicts=d)}Gt(l.doc,e,b,t)}if(a.deleted){if("ok"!==e.deleted)continue;l.value.deleted=!0,l.doc=null}r.push(l)}})}},Ht(t),function(){t(null,{total_rows:n,offset:e.skip,rows:r})})},b._changes=function(e){function t(){var t=Mi+".json AS metadata, "+Mi+".max_seq AS maxSeq, "+Bi+".json AS winningDoc, "+Bi+".rev AS winningRev ",n=Mi+" JOIN "+Bi,u=Mi+".id="+Bi+".doc_id AND "+Mi+".winningseq="+Bi+".seq",c=["maxSeq > ?"],f=[e.since];e.doc_ids&&(c.push(Mi+".id IN "+Ft(e.doc_ids.length)),f=f.concat(e.doc_ids));var l="maxSeq "+(r?"DESC":"ASC"),d=Ut(t,n,u,c,l),h=R(e);e.view||e.filter||(d+=" LIMIT "+i);var p=e.since||0;j.readTransaction(function(t){t.executeSql(d,f,function(t,n){function r(t){return function(){e.onChange(t)}}for(var u=0,c=n.rows.length;u<c;u++){var f=n.rows.item(u),l=ot(f.metadata);p=f.maxSeq;var d=Bt(f.winningDoc,l.id,f.winningRev),v=e.processChange(d,l,e);v.seq=f.maxSeq;var y=h(v);if("object"===("undefined"==typeof y?"undefined":fe(y)))return e.complete(y);if(y&&(s++,o&&a.push(v),e.attachments&&e.include_docs?Gt(d,e,b,t,r(v)):r(v)()),s===i)break}})},Ht(e.complete),function(){e.continuous||e.complete(null,{results:a,last_seq:p})})}if(e=u(e),e.continuous){var n=b._name+":"+J();return Wi.addListener(b._name,n,b,e),Wi.notify(b._name),{cancel:function(){Wi.removeListener(b._name,n)}}}var r=e.descending;e.since=e.since&&!r?e.since:0;var i="limit"in e?e.limit:-1;0===i&&(i=1);var o;o="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var a=[],s=0;t()},b._close=function(e){e()},b._getAttachment=function(e,t,n,r,i){var o,a=r.ctx,s=n.digest,u=n.content_type,c="SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM "+Fi+" WHERE digest=?";a.executeSql(c,[s],function(e,t){var n=t.rows.item(0),a=n.escaped?Nt(n.body):Lt(n.body,_);o=r.binary?Me(a,u):bi(a),i(null,o)})},b._getRevisionTree=function(e,t){j.readTransaction(function(n){var r="SELECT json AS metadata FROM "+Mi+" WHERE id = ?";n.executeSql(r,[e],function(e,n){if(n.rows.length){var r=ot(n.rows.item(0).metadata);t(null,r.rev_tree)}else t(q(Vr))})})},b._doCompaction=function(e,t,n){return t.length?void j.transaction(function(n){var r="SELECT json AS metadata FROM "+Mi+" WHERE id = ?";n.executeSql(r,[e],function(n,r){var i=ot(r.rows.item(0).metadata);K(i.rev_tree,function(e,n,r,i,o){var a=n+"-"+r;t.indexOf(a)!==-1&&(o.status="missing")});var o="UPDATE "+Mi+" SET json = ? WHERE id = ?";n.executeSql(o,[at(i),e])}),zt(t,e,n)},Ht(n),function(){n()}):n()},b._getLocal=function(e,t){j.readTransaction(function(n){var r="SELECT json, rev FROM "+Ui+" WHERE id=?";n.executeSql(r,[e],function(n,r){if(r.rows.length){var i=r.rows.item(0),o=Bt(i.json,e,i.rev);t(null,o)}else t(q(Vr))})})},b._putLocal=function(e,t,n){function r(e){var r,c;o?(r="UPDATE "+Ui+" SET rev=?, json=? WHERE id=? AND rev=?",c=[i,u,a,o]):(r="INSERT INTO "+Ui+" (id, rev, json) VALUES (?,?,?)",c=[a,i,u]),e.executeSql(r,c,function(e,r){r.rowsAffected?(s={ok:!0,id:a,rev:i},t.ctx&&n(null,s)):n(q(Xr))},function(){return n(q(Xr)),!1})}"function"==typeof t&&(n=t,t={}),delete e._revisions;var i,o=e._rev,a=e._id;i=o?e._rev="0-"+(parseInt(o.split("-")[1],10)+1):e._rev="0-1";var s,u=Mt(e);t.ctx?r(t.ctx):j.transaction(r,Ht(n),function(){s&&n(null,s)})},b._removeLocal=function(e,t,n){function r(r){var o="DELETE FROM "+Ui+" WHERE id=? AND rev=?",a=[e._id,e._rev];r.executeSql(o,a,function(r,o){return o.rowsAffected?(i={ok:!0,id:e._id,rev:"0-0"},void(t.ctx&&n(null,i))):n(q(Vr))})}"function"==typeof t&&(n=t,t={});var i;t.ctx?r(t.ctx):j.transaction(r,Ht(n),function(){i&&n(null,i)})},b._destroy=function(e,t){Wi.removeAllListeners(b._name),j.transaction(function(e){var t=[Mi,Bi,Fi,zi,Ui,Hi];t.forEach(function(t){e.executeSql("DROP TABLE IF EXISTS "+t,[])})},Ht(t),function(){k()&&(delete window.localStorage["_pouch__websqldb_"+b._name],delete window.localStorage[b._name]),t(null,{ok:!0})})}}function Qt(){try{return openDatabase("_pouch_validate_websql",1,"",1),!0}catch(e){return!1}}function Yt(){if("undefined"==typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent))return!0;var e=k(),t="_pouch__websqldb_valid_"+navigator.userAgent;if(e&&localStorage[t])return"1"===localStorage[t];var n=Qt();return e&&(localStorage[t]=n?"1":"0"),n}function Zt(){return"function"==typeof openDatabase&&Yt()}function en(e,t,n,r){return openDatabase(e,t,n,r)}function tn(e,t){var n=Jr({websql:en},e);$t.call(this,n,t)}function nn(){for(var e={},t=new Dr(function(t,n){e.resolve=t,e.reject=n}),n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.promise=t,Dr.resolve().then(function(){return fetch.apply(null,n)}).then(function(t){e.resolve(t)}).catch(function(t){e.reject(t)}),e}function rn(e,t){var n,r,i,o=new Headers,a={method:e.method,credentials:"include",headers:o};return e.json&&(o.set("Accept","application/json"),o.set("Content-Type",e.headers["Content-Type"]||"application/json")),e.body&&e.processData&&"string"!=typeof e.body?a.body=JSON.stringify(e.body):"body"in e?a.body=e.body:a.body=null,Object.keys(e.headers).forEach(function(t){e.headers.hasOwnProperty(t)&&o.set(t,e.headers[t])}),n=nn(e.url,a),e.timeout>0&&(r=setTimeout(function(){n.reject(new Error("Load timeout for resource: "+e.url))},e.timeout)),n.promise.then(function(t){return i={statusCode:t.status},e.timeout>0&&clearTimeout(r),i.statusCode>=200&&i.statusCode<300?e.binary?t.blob():t.text():t.json()}).then(function(e){i.statusCode>=200&&i.statusCode<300?t(null,i,e):(e.status=i.statusCode,t(e))}).catch(function(e){e||(e=new Error("canceled")),t(e)}),{abort:n.reject}}function on(e,t){var n,r,i=!1,o=function(){n.abort(),u()},a=function(){i=!0,n.abort(),u()},s={abort:o},u=function(){clearTimeout(r),s.abort=function(){},n&&(n.onprogress=void 0,n.upload&&(n.upload.onprogress=void 0),n.onreadystatechange=void 0,n=void 0)};n=e.xhr?new e.xhr:new XMLHttpRequest;try{n.open(e.method,e.url)}catch(e){return t(new Error(e.name||"Url is invalid"))}n.withCredentials=!("withCredentials"in e)||e.withCredentials,"GET"===e.method?delete e.headers["Content-Type"]:e.json&&(e.headers.Accept="application/json",e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json",e.body&&e.processData&&"string"!=typeof e.body&&(e.body=JSON.stringify(e.body))),e.binary&&(n.responseType="arraybuffer"),"body"in e||(e.body=null);for(var c in e.headers)e.headers.hasOwnProperty(c)&&n.setRequestHeader(c,e.headers[c]);return e.timeout>0&&(r=setTimeout(a,e.timeout),n.onprogress=function(){clearTimeout(r),4!==n.readyState&&(r=setTimeout(a,e.timeout))},"undefined"!=typeof n.upload&&(n.upload.onprogress=n.onprogress)),n.onreadystatechange=function(){if(4===n.readyState){var r={statusCode:n.status};if(n.status>=200&&n.status<300){var o;o=e.binary?Ie([n.response||""],{type:n.getResponseHeader("Content-Type")}):n.responseText,t(null,r,o)}else{var a={};if(i)a=new Error("ETIMEDOUT"),a.code="ETIMEDOUT";else if("string"==typeof n.response)try{a=JSON.parse(n.response)}catch(e){}a.status=n.status,t(a)}u()}},e.body&&e.body instanceof Blob?Je(e.body,function(e){n.send(e)}):n.send(e.body),s}function an(){try{return new XMLHttpRequest,!0}catch(e){return!1}}function sn(e,t){return to||e.xhr?on(e,t):rn(e,t)}function un(){return""}function cn(e,t){function n(t,n,r){if(!e.binary&&e.json&&"string"==typeof t)try{t=JSON.parse(t)}catch(e){return r(e)}Array.isArray(t)&&(t=t.map(function(e){return e.error||e.missing?T(e):e})),e.binary&&no(t,n),r(null,t,n)}e=u(e);var r={method:"GET",headers:{},json:!0,processData:!0,timeout:1e4,cache:!1};return e=Jr(r,e),e.json&&(e.binary||(e.headers.Accept="application/json"),e.headers["Content-Type"]=e.headers["Content-Type"]||"application/json"),e.binary&&(e.encoding=null,e.json=!1),e.processData||(e.json=!1),sn(e,function(r,i,o){if(r)return t(T(r));var a,s=i.headers&&i.headers["content-type"],u=o||un();if(!e.binary&&(e.json||!e.processData)&&"object"!==("undefined"==typeof u?"undefined":fe(u))&&(/json/.test(s)||/^[\s]*\{/.test(u)&&/\}[\s]*$/.test(u)))try{u=JSON.parse(u.toString())}catch(e){}i.statusCode>=200&&i.statusCode<300?n(u,i,t):(a=T(u),a.status=i.statusCode,t(a))})}function fn(e,t){var n=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"",r=n.indexOf("safari")!==-1&&n.indexOf("chrome")===-1,i=n.indexOf("msie")!==-1,o=n.indexOf("edge")!==-1,a=r||(i||o)&&"GET"===e.method,s=!("cache"in e)||e.cache,u=/^blob:/.test(e.url);if(!u&&(a||!s)){var c=e.url.indexOf("?")!==-1;
e.url+=(c?"&":"?")+"_nonce="+Date.now()}return cn(e,t)}function ln(e,t){return new Dr(function(n,r){function i(){f++,e[l++]().then(a,s)}function o(){++d===h?c?r(c):n():u()}function a(){f--,o()}function s(e){f--,c=c||e,o()}function u(){for(;f<t&&l<h;)i()}var c,f=0,l=0,d=0,h=e.length;u()})}function dn(e){var t=e.doc&&e.doc._attachments;t&&Object.keys(t).forEach(function(e){var n=t[e];n.data=Be(n.data,n.content_type)})}function hn(e){return/^_design/.test(e)?"_design/"+encodeURIComponent(e.slice(8)):/^_local/.test(e)?"_local/"+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function pn(e){return e._attachments&&Object.keys(e._attachments)?Dr.all(Object.keys(e._attachments).map(function(t){var n=e._attachments[t];if(n.data&&"string"!=typeof n.data)return new Dr(function(e){He(n.data,e)}).then(function(e){n.data=e})})):Dr.resolve()}function vn(e){if(!e.prefix)return!1;var t=F(e.prefix).protocol;return"http"===t||"https"===t}function yn(e,t){if(vn(t)){var n=t.name.substr(t.prefix.length);e=t.prefix+encodeURIComponent(n)}var r=F(e);(r.user||r.password)&&(r.auth={username:r.user,password:r.password});var i=r.path.replace(/(^\/|\/$)/g,"").split("/");return r.db=i.pop(),r.db.indexOf("%")===-1&&(r.db=encodeURIComponent(r.db)),r.path=i.join("/"),r}function gn(e,t){return mn(e,e.db+"/"+t)}function mn(e,t){var n=e.path?"/":"";return e.protocol+"://"+e.host+(e.port?":"+e.port:"")+"/"+e.path+n+t}function _n(e){return"?"+Object.keys(e).map(function(t){return t+"="+encodeURIComponent(e[t])}).join("&")}function bn(e,t){function n(e,t,n){var r=e.ajax||{},i=Jr(u(d),r,t),o=u(d.headers||{});return i.headers=Jr(o,r.headers,t.headers||{}),ao(i.method+" "+i.url),s._ajax(i,n)}function r(e,t){return new Dr(function(r,i){n(e,t,function(e,t){return e?i(e):void r(t)})})}function i(e,t){return l(e,jr(function(e){o().then(function(){return t.apply(this,e)}).catch(function(t){var n=e.pop();n(t)})}))}function o(){if(e.skipSetup||e.skip_setup)return Dr.resolve();if(y)return y;var t={method:"GET",url:f};return y=r({},t).catch(function(e){return e&&e.status&&404===e.status?(A(404,"PouchDB is just detecting if the remote exists."),r({},{method:"PUT",url:f})):Dr.reject(e)}).catch(function(e){return!(!e||!e.status||412!==e.status)||Dr.reject(e)}),y.catch(function(){y=null}),y}function a(e){return e.split("/").map(encodeURIComponent).join("/")}var s=this,c=yn(e.name,e),f=gn(c,"");e=u(e);var d=e.ajax||{};if(e.auth||c.auth){var h=e.auth||c.auth,p=h.username+":"+h.password,v=bi(unescape(encodeURIComponent(p)));d.headers=d.headers||{},d.headers.Authorization="Basic "+v}s._ajax=fn;var y;Tr(function(){t(null,s)}),s.type=function(){return"http"},s.id=i("id",function(e){n({},{method:"GET",url:mn(c,"")},function(t,n){var r=n&&n.uuid?n.uuid+c.db:gn(c,"");e(null,r)})}),s.request=i("request",function(e,t){e.url=gn(c,e.url),n({},e,t)}),s.compact=i("compact",function(e,t){"function"==typeof e&&(t=e,e={}),e=u(e),n(e,{url:gn(c,"_compact"),method:"POST"},function(){function n(){s.info(function(r,i){i&&!i.compact_running?t(null,{ok:!0}):setTimeout(n,e.interval||200)})}n()})}),s.bulkGet=l("bulkGet",function(e,t){function r(t){var r={};e.revs&&(r.revs=!0),e.attachments&&(r.attachments=!0),e.latest&&(r.latest=!0),n(e,{url:gn(c,"_bulk_get"+_n(r)),method:"POST",body:{docs:e.docs}},t)}function i(){function n(e){return function(n,r){s[e]=r.results,++a===i&&t(null,{results:L(s)})}}for(var r=io,i=Math.ceil(e.docs.length/r),a=0,s=new Array(i),u=0;u<i;u++){var c=g(e,["revs","attachments","latest"]);c.ajax=d,c.docs=e.docs.slice(u*r,Math.min(e.docs.length,(u+1)*r)),b(o,c,n(u))}}var o=this,a=mn(c,""),s=oo[a];"boolean"!=typeof s?r(function(e,n){e?(oo[a]=!1,A(e.status,"PouchDB is just detecting if the remote supports the _bulk_get API."),i()):(oo[a]=!0,t(null,n))}):s?r(t):i()}),s._info=function(e){o().then(function(){n({},{method:"GET",url:gn(c,"")},function(t,n){return t?e(t):(n.host=gn(c,""),void e(null,n))})}).catch(e)},s.get=i("get",function(e,t,n){function i(e){function n(n){var o=i[n],s=hn(e._id)+"/"+a(n)+"?rev="+e._rev;return r(t,{method:"GET",url:gn(c,s),binary:!0}).then(function(e){return t.binary?e:new Dr(function(t){He(e,t)})}).then(function(e){delete o.stub,delete o.length,o.data=e})}var i=e._attachments,o=i&&Object.keys(i);if(i&&o.length){var s=o.map(function(e){return function(){return n(e)}});return ln(s,5)}}function o(e){return Array.isArray(e)?Dr.all(e.map(function(e){if(e.ok)return i(e.ok)})):i(e)}"function"==typeof t&&(n=t,t={}),t=u(t);var s={};t.revs&&(s.revs=!0),t.revs_info&&(s.revs_info=!0),t.latest&&(s.latest=!0),t.open_revs&&("all"!==t.open_revs&&(t.open_revs=JSON.stringify(t.open_revs)),s.open_revs=t.open_revs),t.rev&&(s.rev=t.rev),t.conflicts&&(s.conflicts=t.conflicts),e=hn(e);var f={method:"GET",url:gn(c,e+_n(s))};r(t,f).then(function(e){return Dr.resolve().then(function(){if(t.attachments)return o(e)}).then(function(){n(null,e)})}).catch(n)}),s.remove=i("remove",function(e,t,r,i){var o;"string"==typeof t?(o={_id:e,_rev:t},"function"==typeof r&&(i=r,r={})):(o=e,"function"==typeof t?(i=t,r={}):(i=r,r=t));var a=o._rev||r.rev;n(r,{method:"DELETE",url:gn(c,hn(o._id))+"?rev="+a},i)}),s.getAttachment=i("getAttachment",function(e,t,r,i){"function"==typeof r&&(i=r,r={});var o=r.rev?"?rev="+r.rev:"",s=gn(c,hn(e))+"/"+a(t)+o;n(r,{method:"GET",url:s,binary:!0},i)}),s.removeAttachment=i("removeAttachment",function(e,t,r,i){var o=gn(c,hn(e)+"/"+a(t))+"?rev="+r;n({},{method:"DELETE",url:o},i)}),s.putAttachment=i("putAttachment",function(e,t,r,i,o,s){"function"==typeof o&&(s=o,o=i,i=r,r=null);var u=hn(e)+"/"+a(t),f=gn(c,u);if(r&&(f+="?rev="+r),"string"==typeof i){var l;try{l=_i(i)}catch(e){return s(q(Zr,"Attachment is not a valid base64 string"))}i=l?Me(l,o):""}var h={headers:{"Content-Type":o},method:"PUT",url:f,processData:!1,body:i,timeout:d.timeout||6e4};n({},h,s)}),s._bulkDocs=function(e,t,r){e.new_edits=t.new_edits,o().then(function(){return Dr.all(e.docs.map(pn))}).then(function(){n(t,{method:"POST",url:gn(c,"_bulk_docs"),timeout:t.timeout,body:e},function(e,t){return e?r(e):(t.forEach(function(e){e.ok=!0}),void r(null,t))})}).catch(r)},s._put=function(e,t,r){o().then(function(){return pn(e)}).then(function(){n(t,{method:"PUT",url:gn(c,hn(e._id)),body:e},function(e,t){return e?r(e):void r(null,t)})}).catch(r)},s.allDocs=i("allDocs",function(e,t){"function"==typeof e&&(t=e,e={}),e=u(e);var n,i={},o="GET";e.conflicts&&(i.conflicts=!0),e.descending&&(i.descending=!0),e.include_docs&&(i.include_docs=!0),e.attachments&&(i.attachments=!0),e.key&&(i.key=JSON.stringify(e.key)),e.start_key&&(e.startkey=e.start_key),e.startkey&&(i.startkey=JSON.stringify(e.startkey)),e.end_key&&(e.endkey=e.end_key),e.endkey&&(i.endkey=JSON.stringify(e.endkey)),"undefined"!=typeof e.inclusive_end&&(i.inclusive_end=!!e.inclusive_end),"undefined"!=typeof e.limit&&(i.limit=e.limit),"undefined"!=typeof e.skip&&(i.skip=e.skip);var a=_n(i);"undefined"!=typeof e.keys&&(o="POST",n={keys:e.keys}),r(e,{method:o,url:gn(c,"_all_docs"+a),body:n}).then(function(n){e.include_docs&&e.attachments&&e.binary&&n.rows.forEach(dn),t(null,n)}).catch(t)}),s._changes=function(e){var t="batch_size"in e?e.batch_size:ro;e=u(e),e.timeout="timeout"in e?e.timeout:"timeout"in d?d.timeout:3e4;var r,i=e.timeout?{timeout:e.timeout-5e3}:{},a="undefined"!=typeof e.limit&&e.limit;r="return_docs"in e?e.return_docs:!("returnDocs"in e)||e.returnDocs;var s=a;if(e.style&&(i.style=e.style),(e.include_docs||e.filter&&"function"==typeof e.filter)&&(i.include_docs=!0),e.attachments&&(i.attachments=!0),e.continuous&&(i.feed="longpoll"),e.conflicts&&(i.conflicts=!0),e.descending&&(i.descending=!0),"heartbeat"in e?e.heartbeat&&(i.heartbeat=e.heartbeat):e.continuous&&(i.heartbeat=1e4),e.filter&&"string"==typeof e.filter&&(i.filter=e.filter),e.view&&"string"==typeof e.view&&(i.filter="_view",i.view=e.view),e.query_params&&"object"===fe(e.query_params))for(var f in e.query_params)e.query_params.hasOwnProperty(f)&&(i[f]=e.query_params[f]);var l,h="GET";e.doc_ids&&(i.filter="_doc_ids",h="POST",l={doc_ids:e.doc_ids});var p,v,y=function(r,u){if(!e.aborted){i.since=r,"object"===fe(i.since)&&(i.since=JSON.stringify(i.since)),e.descending?a&&(i.limit=s):i.limit=!a||s>t?t:s;var f={method:h,url:gn(c,"_changes"+_n(i)),timeout:e.timeout,body:l};v=r,e.aborted||o().then(function(){p=n(e,f,u)}).catch(u)}},g={results:[]},m=function n(i,o){if(!e.aborted){var u=0;if(o&&o.results){u=o.results.length,g.last_seq=o.last_seq;var c={};c.query=e.query_params,o.results=o.results.filter(function(t){s--;var n=R(e)(t);return n&&(e.include_docs&&e.attachments&&e.binary&&dn(t),r&&g.results.push(t),e.onChange(t)),n})}else if(i)return e.aborted=!0,void e.complete(i);o&&o.last_seq&&(v=o.last_seq);var f=a&&s<=0||o&&u<t||e.descending;(!e.continuous||a&&s<=0)&&f?e.complete(null,g):Tr(function(){y(v,n)})}};return y(e.since||0,m),{cancel:function(){e.aborted=!0,p&&p.abort()}}},s.revsDiff=i("revsDiff",function(e,t,r){"function"==typeof t&&(r=t,t={}),n(t,{method:"POST",url:gn(c,"_revs_diff"),body:e},r)}),s._close=function(e){e()},s._destroy=function(e,t){n(e,{url:gn(c,""),method:"DELETE"},function(e,n){return e&&e.status&&404!==e.status?t(e):void t(null,n)})}}function wn(e){this.status=400,this.name="query_parse_error",this.message=e,this.error=!0;try{Error.captureStackTrace(this,wn)}catch(e){}}function kn(e){this.status=404,this.name="not_found",this.message=e,this.error=!0;try{Error.captureStackTrace(this,kn)}catch(e){}}function En(e){this.status=500,this.name="invalid_value",this.message=e,this.error=!0;try{Error.captureStackTrace(this,En)}catch(e){}}function On(e,t){return t&&e.then(function(e){Tr(function(){t(null,e)})},function(e){Tr(function(){t(e)})}),e}function Sn(e){return jr(function(t){var n=t.pop(),r=e.apply(this,t);return"function"==typeof n&&On(r,n),r})}function xn(e,t){return e.then(function(e){return t().then(function(){return e})},function(e){return t().then(function(){throw e})})}function jn(e,t){return function(){var n=arguments,r=this;return e.add(function(){return t.apply(r,n)})}}function An(e){var t=new Br(e),n=new Array(t.size),r=-1;return t.forEach(function(e){n[++r]=e}),n}function Pn(e){var t=new Array(e.size),n=-1;return e.forEach(function(e,r){t[++n]=r}),t}function qn(e){var t="builtin "+e+" function requires map values to be numbers or number arrays";return new En(t)}function Tn(e){for(var t=0,n=0,r=e.length;n<r;n++){var i=e[n];if("number"!=typeof i){if(!Array.isArray(i))throw qn("_sum");t="number"==typeof t?[t]:t;for(var o=0,a=i.length;o<a;o++){var s=i[o];if("number"!=typeof s)throw qn("_sum");"undefined"==typeof t[o]?t.push(s):t[o]+=s}}else"number"==typeof t?t+=i:t[0]+=i}return t}function Cn(e,t){return Cr("return ("+e.replace(/;\s*$/,"")+");",{emit:t,sum:Tn,log:uo,isArray:co,toJSON:fo})}function Rn(e,t,n){for(var r="",i=n-e.length;r.length<i;)r+=t;return r}function Ln(e,t,n){var r=Rn(e,t,n);return r+e}function Dn(e,t){if(e===t)return 0;e=In(e),t=In(t);var n=Wn(e),r=Wn(t);if(n-r!==0)return n-r;switch("undefined"==typeof e?"undefined":fe(e)){case"number":return e-t;case"boolean":return e<t?-1:1;case"string":return Hn(e,t)}return Array.isArray(e)?zn(e,t):Jn(e,t)}function In(e){switch("undefined"==typeof e?"undefined":fe(e)){case"undefined":return null;case"number":return e===1/0||e===-(1/0)||isNaN(e)?null:e;case"object":var t=e;if(Array.isArray(e)){var n=e.length;e=new Array(n);for(var r=0;r<n;r++)e[r]=In(t[r])}else{if(e instanceof Date)return e.toJSON();if(null!==e){e={};for(var i in t)if(t.hasOwnProperty(i)){var o=t[i];"undefined"!=typeof o&&(e[i]=In(o))}}}}return e}function Nn(e){if(null!==e)switch("undefined"==typeof e?"undefined":fe(e)){case"boolean":return e?1:0;case"number":return Kn(e);case"string":return e.replace(/\u0002/g,"").replace(/\u0001/g,"").replace(/\u0000/g,"");case"object":var t=Array.isArray(e),n=t?e:Object.keys(e),r=-1,i=n.length,o="";if(t)for(;++r<i;)o+=Mn(n[r]);else for(;++r<i;){var a=n[r];o+=Mn(a)+Mn(e[a])}return o}return""}function Mn(e){var t="\0";return e=In(e),Wn(e)+po+Nn(e)+t}function Bn(e,t){var n,r=t,i="1"===e[t];if(i)n=0,t++;else{var o="0"===e[t];t++;var a="",s=e.substring(t,t+ho),u=parseInt(s,10)+lo;for(o&&(u=-u),t+=ho;;){var c=e[t];if("\0"===c)break;a+=c,t++}a=a.split("."),n=1===a.length?parseInt(a,10):parseFloat(a[0]+"."+a[1]),o&&(n-=10),0!==u&&(n=parseFloat(n+"e"+u))}return{num:n,length:t-r}}function Fn(e,t){var n=e.pop();if(t.length){var r=t[t.length-1];n===r.element&&(t.pop(),r=t[t.length-1]);var i=r.element,o=r.index;if(Array.isArray(i))i.push(n);else if(o===e.length-2){var a=e.pop();i[a]=n}else e.push(n)}}function Un(e){for(var t=[],n=[],r=0;;){var i=e[r++];if("\0"!==i)switch(i){case"1":t.push(null);break;case"2":t.push("1"===e[r]),r++;break;case"3":var o=Bn(e,r);t.push(o.num),r+=o.length;break;case"4":for(var a="";;){var s=e[r];if("\0"===s)break;a+=s,r++}a=a.replace(/\u0001\u0001/g,"\0").replace(/\u0001\u0002/g,"").replace(/\u0002\u0002/g,""),t.push(a);break;case"5":var u={element:[],index:t.length};t.push(u.element),n.push(u);break;case"6":var c={element:{},index:t.length};t.push(c.element),n.push(c);break;default:throw new Error("bad collationIndex or unexpectedly reached end of input: "+i)}else{if(1===t.length)return t.pop();Fn(t,n)}}}function zn(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=Dn(e[r],t[r]);if(0!==i)return i}return e.length===t.length?0:e.length>t.length?1:-1}function Hn(e,t){return e===t?0:e>t?1:-1}function Jn(e,t){for(var n=Object.keys(e),r=Object.keys(t),i=Math.min(n.length,r.length),o=0;o<i;o++){var a=Dn(n[o],r[o]);if(0!==a)return a;if(a=Dn(e[n[o]],t[r[o]]),0!==a)return a}return n.length===r.length?0:n.length>r.length?1:-1}function Wn(e){var t=["boolean","number","string","object"],n=t.indexOf("undefined"==typeof e?"undefined":fe(e));return~n?null===e?1:Array.isArray(e)?5:n<3?n+2:n+3:Array.isArray(e)?5:void 0}function Kn(e){if(0===e)return"1";var t=e.toExponential().split(/e\+?/),n=parseInt(t[1],10),r=e<0,i=r?"0":"2",o=(r?-n:n)-lo,a=Ln(o.toString(),"0",ho);i+=po+a;var s=Math.abs(parseFloat(t[0]));r&&(s=10-s);var u=s.toFixed(20);return u=u.replace(/\.?0+$/,""),i+=po+u}function Vn(){this.promise=new Dr(function(e){e()})}function Xn(e,t,n,r,i,o){var a,s=n.toString()+(r&&r.toString())+"undefined";if(!i&&(a=e._cachedViews=e._cachedViews||{},a[s]))return a[s];var u=e.info().then(function(u){function c(e){e.views=e.views||{};var n=t;n.indexOf("/")===-1&&(n=t+"/"+t);var r=e.views[n]=e.views[n]||{};if(!r[f])return r[f]=!0,e}var f=u.db_name+"-mrview-"+(i?"temp":$e(s));return U(e,"_local/"+o,c).then(function(){return e.registerDependentDatabase(f).then(function(t){var i=t.db;i.auto_compaction=!0;var o={name:f,db:i,sourceDB:e,adapter:e.adapter,mapFun:n,reduceFun:r};return o.db.get("_local/lastSeq").catch(function(e){if(404!==e.status)throw e}).then(function(e){return o.seq=e?e.seq:0,a&&o.db.once("destroyed",function(){delete a[s]}),o})})})});return a&&(a[s]=u),u}function Gn(e){return e.indexOf("/")===-1?[e,e]:e.split("/")}function $n(e){return 1===e.length&&/^1-/.test(e[0].rev)}function Qn(e,t){try{e.emit("error",t)}catch(e){S("error","The user's map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on('error', function (err) { debugger; });\nPlease double-check your map/reduce function."),S("error",t)}}function Yn(e,t,n,r){function i(e,t,n){try{t(n)}catch(t){Qn(e,t)}}function o(e,t,n,r,i){try{return{output:t(n,r,i)}}catch(t){return Qn(e,t),{error:t}}}function a(e,t){var n=Dn(e.key,t.key);return 0!==n?n:Dn(e.value,t.value)}function s(e,t,n){return n=n||0,"number"==typeof t?e.slice(n,t+n):n>0?e.slice(n):e}function u(e){var t=e.value,n=t&&"object"===("undefined"==typeof t?"undefined":fe(t))&&t._id||e.id;return n}function c(e){e.rows.forEach(function(e){var t=e.doc&&e.doc._attachments;t&&Object.keys(t).forEach(function(e){var n=t[e];t[e].data=Be(n.data,n.content_type)})})}function f(e){return function(t){return e.include_docs&&e.attachments&&e.binary&&c(t),t}}function l(e,t,n,r){var i=t[e];"undefined"!=typeof i&&(r&&(i=encodeURIComponent(JSON.stringify(i))),n.push(e+"="+i))}function d(e){if("undefined"!=typeof e){var t=Number(e);return isNaN(t)||t!==parseInt(e,10)?e:t}}function h(e){return e.group_level=d(e.group_level),e.limit=d(e.limit),e.skip=d(e.skip),e}function p(e){if(e){if("number"!=typeof e)return new wn('Invalid value for integer: "'+e+'"');if(e<0)return new wn('Invalid value for positive integer: "'+e+'"')}}function v(e,t){var n=e.descending?"endkey":"startkey",r=e.descending?"startkey":"endkey";if("undefined"!=typeof e[n]&&"undefined"!=typeof e[r]&&Dn(e[n],e[r])>0)throw new wn("No rows can match your key range, reverse your start_key and end_key or set {descending : true}");if(t.reduce&&e.reduce!==!1){if(e.include_docs)throw new wn("{include_docs:true} is invalid for reduce");if(e.keys&&e.keys.length>1&&!e.group&&!e.group_level)throw new wn("Multi-key fetches for reduce views must use {group: true}")}["group_level","limit","skip"].forEach(function(t){var n=p(e[t]);if(n)throw n})}function y(e,t,n){var r,i=[],o="GET";if(l("reduce",n,i),l("include_docs",n,i),l("attachments",n,i),l("limit",n,i),l("descending",n,i),l("group",n,i),l("group_level",n,i),l("skip",n,i),l("stale",n,i),l("conflicts",n,i),l("startkey",n,i,!0),l("start_key",n,i,!0),l("endkey",n,i,!0),l("end_key",n,i,!0),l("inclusive_end",n,i),l("key",n,i,!0),i=i.join("&"),i=""===i?"":"?"+i,"undefined"!=typeof n.keys){var a=2e3,s="keys="+encodeURIComponent(JSON.stringify(n.keys));s.length+i.length+1<=a?i+=("?"===i[0]?"&":"?")+s:(o="POST","string"==typeof t?r={keys:n.keys}:t.keys=n.keys)}if("string"==typeof t){var u=Gn(t);return e.request({method:o,url:"_design/"+u[0]+"/_view/"+u[1]+i,body:r}).then(f(n))}return r=r||{},Object.keys(t).forEach(function(e){Array.isArray(t[e])?r[e]=t[e]:r[e]=t[e].toString()}),e.request({method:"POST",url:"_temp_view"+i,body:r}).then(f(n))}function g(e,t,n){return new Dr(function(r,i){e._query(t,n,function(e,t){return e?i(e):void r(t)})})}function m(e){return new Dr(function(t,n){e._viewCleanup(function(e,r){return e?n(e):void t(r)})})}function _(e){return function(t){if(404===t.status)return e;throw t}}function b(e,t,n){function r(){return $n(f)?Dr.resolve(s):t.db.get(a).catch(_(s))}function i(e){return e.keys.length?t.db.allDocs({keys:e.keys,include_docs:!0}):Dr.resolve({rows:[]})}function o(e,t){for(var n=[],r=new Br,i=0,o=t.rows.length;i<o;i++){var a=t.rows[i],s=a.doc;if(s&&(n.push(s),r.add(s._id),s._deleted=!c.has(s._id),!s._deleted)){var u=c.get(s._id);"value"in u&&(s.value=u.value)}}var f=Pn(c);return f.forEach(function(e){if(!r.has(e)){var t={_id:e},i=c.get(e);"value"in i&&(t.value=i.value),n.push(t)}}),e.keys=An(f.concat(e.keys)),n.push(e),n}var a="_local/doc_"+e,s={_id:a,keys:[]},u=n.get(e),c=u[0],f=u[1];return r().then(function(e){return i(e).then(function(t){return o(e,t)})})}function w(e,t,n){var r="_local/lastSeq";return e.db.get(r).catch(_({_id:r,seq:0})).then(function(r){var i=Pn(t);return Dr.all(i.map(function(n){return b(n,e,t)})).then(function(t){var i=L(t);return r.seq=n,i.push(r),e.db.bulkDocs({docs:i})})})}function k(e){var t="string"==typeof e?e:e.name,n=vo[t];return n||(n=vo[t]=new Vn),n}function E(e){return jn(k(e),function(){return O(e)})()}function O(e){function n(e,t){var n={id:l._id,key:In(e)};"undefined"!=typeof t&&null!==t&&(n.value=In(t)),f.push(n)}function r(t,n){return function(){return w(e,t,n)}}function o(){return e.sourceDB.changes({conflicts:!0,include_docs:!0,style:"all_docs",since:h,limit:go}).then(s)}function s(e){var t=e.results;if(t.length){var n=u(t);if(p.add(r(n,h)),!(t.length<go))return o()}}function u(t){for(var n=new Fr,r=0,o=t.length;r<o;r++){var s=t[r];if("_"!==s.doc._id[0]){f=[],l=s.doc,l._deleted||i(e.sourceDB,d,l),f.sort(a);var u=c(f);n.set(s.doc._id,[u,s.changes])}h=s.seq}return n}function c(e){for(var t,n=new Fr,r=0,i=e.length;r<i;r++){var o=e[r],a=[o.key,o.id];r>0&&0===Dn(o.key,t)&&a.push(r),n.set(Mn(a),o),t=o.key}return n}var f,l,d=t(e.mapFun,n),h=e.seq||0,p=new Vn;return o().then(function(){return p.finish()}).then(function(){e.seq=h})}function S(e,t,r){0===r.group_level&&delete r.group_level;var i=r.group||r.group_level,a=n(e.reduceFun),u=[],c=isNaN(r.group_level)?Number.POSITIVE_INFINITY:r.group_level;t.forEach(function(e){var t=u[u.length-1],n=i?e.key:null;return i&&Array.isArray(n)&&(n=n.slice(0,c)),t&&0===Dn(t.groupKey,n)?(t.keys.push([e.key,e.id]),void t.values.push(e.value)):void u.push({keys:[[e.key,e.id]],values:[e.value],groupKey:n})}),t=[];for(var f=0,l=u.length;f<l;f++){var d=u[f],h=o(e.sourceDB,a,d.keys,d.values,!1);if(h.error&&h.error instanceof En)throw h.error;t.push({value:h.error?null:h.output,key:d.groupKey})}return{rows:s(t,r.limit,r.skip)}}function x(e,t){return jn(k(e),function(){return j(e,t)})()}function j(e,t){function n(t){return t.include_docs=!0,e.db.allDocs(t).then(function(e){return i=e.total_rows,e.rows.map(function(e){if("value"in e.doc&&"object"===fe(e.doc.value)&&null!==e.doc.value){var t=Object.keys(e.doc.value).sort(),n=["id","key","value"];if(!(t<n||t>n))return e.doc.value}var r=Un(e.doc._id);return{key:r[0],id:r[1],value:"value"in e.doc?e.doc.value:null}})})}function r(n){var r;if(r=o?S(e,n,t):{total_rows:i,offset:a,rows:n},t.include_docs){var s=An(n.map(u));return e.sourceDB.allDocs({keys:s,include_docs:!0,conflicts:t.conflicts,attachments:t.attachments,binary:t.binary}).then(function(e){var t=new Fr;return e.rows.forEach(function(e){t.set(e.id,e.doc)}),n.forEach(function(e){var n=u(e),r=t.get(n);r&&(e.doc=r)}),r})}return r}var i,o=e.reduceFun&&t.reduce!==!1,a=t.skip||0;if("undefined"==typeof t.keys||t.keys.length||(t.limit=0,delete t.keys),"undefined"!=typeof t.keys){var s=t.keys,c=s.map(function(e){var t={startkey:Mn([e]),endkey:Mn([e,{}])};return n(t)});return Dr.all(c).then(L).then(r)}var f={descending:t.descending};if(t.start_key&&(t.startkey=t.start_key),t.end_key&&(t.endkey=t.end_key),"undefined"!=typeof t.startkey&&(f.startkey=Mn(t.descending?[t.startkey,{}]:[t.startkey])),"undefined"!=typeof t.endkey){var l=t.inclusive_end!==!1;t.descending&&(l=!l),f.endkey=Mn(l?[t.endkey,{}]:[t.endkey])}if("undefined"!=typeof t.key){var d=Mn([t.key]),h=Mn([t.key,{}]);f.descending?(f.endkey=d,f.startkey=h):(f.startkey=d,f.endkey=h)}return o||("number"==typeof t.limit&&(f.limit=t.limit),f.skip=a),n(f).then(r)}function A(e){return e.request({method:"POST",url:"_view_cleanup"})}function P(t){return t.get("_local/"+e).then(function(e){var n=new Fr;Object.keys(e.views).forEach(function(e){var t=Gn(e),r="_design/"+t[0],i=t[1],o=n.get(r);o||(o=new Br,n.set(r,o)),o.add(i)});var r={keys:Pn(n),include_docs:!0};return t.allDocs(r).then(function(r){var i={};r.rows.forEach(function(t){var r=t.key.substring(8);n.get(t.key).forEach(function(n){var o=r+"/"+n;e.views[o]||(o=n);var a=Object.keys(e.views[o]),s=t.doc&&t.doc.views&&t.doc.views[n];a.forEach(function(e){i[e]=i[e]||s})})});var o=Object.keys(i).filter(function(e){return!i[e]}),a=o.map(function(e){return jn(k(e),function(){return new t.constructor(e,t.__opts).destroy()})()});return Dr.all(a).then(function(){return{ok:!0}})})},_({ok:!0}))}function q(t,n,i){if("http"===t.type())return y(t,n,i);if("function"==typeof t._query)return g(t,n,i);if("string"!=typeof n)return v(i,n),yo.add(function(){var r=Xn(t,"temp_view/temp_view",n.map,n.reduce,!0,e);return r.then(function(e){return xn(E(e).then(function(){return x(e,i)}),function(){return e.db.destroy()})})}),yo.finish();var o=n,a=Gn(o),s=a[0],u=a[1];return t.get("_design/"+s).then(function(n){var a=n.views&&n.views[u];if(!a)throw new kn("ddoc "+n._id+" has no view named "+u);r(n,u),v(i,a);var s=Xn(t,o,a.map,a.reduce,!1,e);return s.then(function(e){return"ok"===i.stale||"update_after"===i.stale?("update_after"===i.stale&&Tr(function(){E(e)}),x(e,i)):E(e).then(function(){return x(e,i)})})})}function T(e,t,n){var r=this;"function"==typeof t&&(n=t,t={}),t=t?h(t):{},"function"==typeof e&&(e={map:e});var i=Dr.resolve().then(function(){return q(r,e,t)});return On(i,n),i}var C=Sn(function(){var e=this;return"http"===e.type()?A(e):"function"==typeof e._viewCleanup?m(e):P(e)});return{query:T,viewCleanup:C}}function Zn(e,t){if("function"==typeof e&&2===e.length){var n=e;return function(e){return n(e,t)}}return Cn(e.toString(),t)}function er(e){return mo[e]?mo[e]:Cn(e.toString())}function tr(e,t){var n=e.views&&e.views[t];if("string"!=typeof n.map)throw new kn("ddoc "+e._id+" has no string view named "+t+", instead found object of type: "+fe(n.map))}function nr(e,t,n){return bo.query.call(this,e,t,n)}function rr(e){return bo.viewCleanup.call(this,e)}function ir(e){return/^1-/.test(e)}function or(e,t,n){return!e._attachments||!e._attachments[n]||e._attachments[n].digest!==t._attachments[n].digest}function ar(e,t){var n=Object.keys(t._attachments);return Dr.all(n.map(function(n){return e.getAttachment(t._id,n,{rev:t._rev})}))}function sr(e,t,n){var r="http"===t.type()&&"http"!==e.type(),i=Object.keys(n._attachments);return r?e.get(n._id).then(function(r){return Dr.all(i.map(function(i){return or(r,n,i)?t.getAttachment(n._id,i):e.getAttachment(r._id,i)}))}).catch(function(e){if(404!==e.status)throw e;return ar(t,n)}):ar(t,n)}function ur(e){var t=[];return Object.keys(e).forEach(function(n){var r=e[n].missing;r.forEach(function(e){t.push({id:n,rev:e})})}),{docs:t,revs:!0,latest:!0}}function cr(e,t,n,r){function i(){var i=ur(n);if(i.docs.length)return e.bulkGet(i).then(function(n){if(r.cancelled)throw new Error("cancelled");return Dr.all(n.results.map(function(n){return Dr.all(n.docs.map(function(n){var r=n.ok;return n.error&&(d=!1),r&&r._attachments?sr(t,e,r).then(function(e){var t=Object.keys(r._attachments);return e.forEach(function(e,n){var i=r._attachments[t[n]];delete i.stub,delete i.length,i.data=e}),r}):r}))})).then(function(e){l=l.concat(L(e).filter(Boolean))})})}function o(e){return e._attachments&&Object.keys(e._attachments).length>0}function a(e){return e._conflicts&&e._conflicts.length>0}function s(t){return e.allDocs({keys:t,include_docs:!0,conflicts:!0}).then(function(e){if(r.cancelled)throw new Error("cancelled");e.rows.forEach(function(e){e.deleted||!e.doc||!ir(e.value.rev)||o(e.doc)||a(e.doc)||(e.doc._conflicts&&delete e.doc._conflicts,l.push(e.doc),delete n[e.id])})})}function c(){var e=Object.keys(n).filter(function(e){var t=n[e].missing;return 1===t.length&&ir(t[0])});if(e.length>0)return s(e)}function f(){return{ok:d,docs:l}}n=u(n);var l=[],d=!0;return Dr.resolve().then(c).then(i).then(f)}function fr(e,t,n,r,i){return e.get(t).catch(function(n){if(404===n.status)return"http"===e.type()&&A(404,"PouchDB is just checking if a remote checkpoint exists."),{session_id:r,_id:t,history:[],replicator:Eo,version:ko};throw n}).then(function(o){if(!i.cancelled&&o.last_seq!==n)return o.history=(o.history||[]).filter(function(e){return e.session_id!==r}),o.history.unshift({last_seq:n,session_id:r}),o.history=o.history.slice(0,Oo),o.version=ko,o.replicator=Eo,o.session_id=r,o.last_seq=n,e.put(o).catch(function(o){if(409===o.status)return fr(e,t,n,r,i);throw o})})}function lr(e,t,n,r){this.src=e,this.target=t,this.id=n,this.returnValue=r}function dr(e,t){return e.session_id===t.session_id?{last_seq:e.last_seq,history:e.history}:hr(e.history,t.history)}function hr(e,t){var n=e[0],r=e.slice(1),i=t[0],o=t.slice(1);if(!n||0===t.length)return{last_seq:So,history:[]};var a=n.session_id;if(pr(a,t))return{last_seq:n.last_seq,history:e};var s=i.session_id;return pr(s,r)?{last_seq:i.last_seq,history:o}:hr(r,o)}function pr(e,t){var n=t[0],r=t.slice(1);return!(!e||0===t.length)&&(e===n.session_id||pr(e,r))}function vr(e){return"number"==typeof e.status&&4===Math.floor(e.status/100)}function yr(e,t,n,r){if(e.retry===!1)return t.emit("error",n),void t.removeAllListeners();if("function"!=typeof e.back_off_function&&(e.back_off_function=j),t.emit("requestError",n),"active"===t.state||"pending"===t.state){t.emit("paused",n),t.state="stopped";var i=function(){e.current_back_off=jo},o=function(){t.removeListener("active",i)};t.once("paused",o),t.once("active",i)}e.current_back_off=e.current_back_off||jo,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(r,e.current_back_off)}function gr(e){return Object.keys(e).sort(Dn).reduce(function(t,n){return t[n]=e[n],t},{})}function mr(e,t,n){var r=n.doc_ids?n.doc_ids.sort(Dn):"",i=n.filter?n.filter.toString():"",o="",a="";return n.filter&&n.query_params&&(o=JSON.stringify(gr(n.query_params))),n.filter&&"_view"===n.filter&&(a=n.view.toString()),Dr.all([e.id(),t.id()]).then(function(e){var t=e[0]+e[1]+i+a+o+r;return new Dr(function(e){Ge(t,e)})}).then(function(e){return e=e.replace(/\//g,".").replace(/\+/g,"_"),"_local/"+e})}function _r(e,t,n,r,i){function o(){return E?Dr.resolve():mr(e,t,n).then(function(n){k=n,E=new lr(e,t,k,r)})}function a(){if(I=[],0!==w.docs.length){var e=w.docs,o={timeout:n.timeout};return t.bulkDocs({docs:e,new_edits:!1},o).then(function(t){if(r.cancelled)throw p(),new Error("cancelled");var n=Object.create(null);t.forEach(function(e){e.error&&(n[e.id]=e)});var o=Object.keys(n).length;i.doc_write_failures+=o,i.docs_written+=e.length-o,e.forEach(function(e){var t=n[e._id];if(t){if(i.errors.push(t),"unauthorized"!==t.name&&"forbidden"!==t.name)throw t;r.emit("denied",u(t))}else I.push(e)})},function(t){throw i.doc_write_failures+=e.length,t})}}function s(){if(w.error)throw new Error("There was a problem getting docs.");i.last_seq=P=w.seq;var e=u(i);return I.length&&(e.docs=I,r.emit("change",e)),x=!0,E.writeCheckpoint(w.seq,N).then(function(){if(x=!1,r.cancelled)throw p(),new Error("cancelled");w=void 0,m()}).catch(function(e){throw b(e),e})}function c(){var e={};return w.changes.forEach(function(t){"_user/"!==t.id&&(e[t.id]=t.changes.map(function(e){return e.rev}))}),t.revsDiff(e).then(function(e){if(r.cancelled)throw p(),new Error("cancelled");w.diffs=e})}function f(){return cr(e,t,w.diffs,r).then(function(e){w.error=!e.ok,e.docs.forEach(function(e){delete w.diffs[e._id],i.docs_read++,w.docs.push(e)})})}function l(){if(!r.cancelled&&!w){if(0===O.length)return void d(!0);w=O.shift(),c().then(f).then(a).then(s).then(l).catch(function(e){h("batch processing terminated with error",e)})}}function d(e){return 0===S.changes.length?void(0!==O.length||w||((q&&M.live||j)&&(r.state="pending",r.emit("paused")),j&&p())):void((e||j||S.changes.length>=T)&&(O.push(S),S={seq:0,changes:[],docs:[]},"pending"!==r.state&&"stopped"!==r.state||(r.state="active",r.emit("active")),l()))}function h(e,t){A||(t.message||(t.message=e),i.ok=!1,i.status="aborting",O=[],S={seq:0,changes:[],docs:[]},p(t))}function p(o){A||r.cancelled&&(i.status="cancelled",x)||(i.status=i.status||"complete",i.end_time=new Date,i.last_seq=P,A=!0,o?(o.result=i,"unauthorized"===o.name||"forbidden"===o.name?(r.emit("error",o),r.removeAllListeners()):yr(n,r,o,function(){_r(e,t,n,r)})):(r.emit("complete",i),r.removeAllListeners()))}function v(e){if(r.cancelled)return p();var t=R(n)(e);t&&(S.seq=e.seq,S.changes.push(e),d(0===O.length&&M.live))}function y(e){if(L=!1,r.cancelled)return p();if(e.results.length>0)M.since=e.last_seq,m(),d(!0);else{var t=function(){q?(M.live=!0,m()):j=!0,d(!0)};w||0!==e.results.length?t():(x=!0,E.writeCheckpoint(e.last_seq,N).then(function(){x=!1,i.last_seq=P=e.last_seq,t()}).catch(b))}}function g(e){return L=!1,r.cancelled?p():void h("changes rejected",e)}function m(){function t(){o.cancel()}function i(){r.removeListener("cancel",t)}if(!L&&!j&&O.length<C){L=!0,r._changes&&(r.removeListener("cancel",r._abortChanges),r._changes.cancel()),r.once("cancel",t);var o=e.changes(M).on("change",v);o.then(i,i),o.then(y).catch(g),n.retry&&(r._changes=o,r._abortChanges=t)}}function _(){o().then(function(){return r.cancelled?void p():E.getCheckpoint().then(function(e){P=e,M={since:P,limit:T,batch_size:T,style:"all_docs",doc_ids:D,return_docs:!0},n.filter&&("string"!=typeof n.filter?M.include_docs=!0:M.filter=n.filter),"heartbeat"in n&&(M.heartbeat=n.heartbeat),"timeout"in n&&(M.timeout=n.timeout),n.query_params&&(M.query_params=n.query_params),
n.view&&(M.view=n.view),m()})}).catch(function(e){h("getCheckpoint rejected with ",e)})}function b(e){x=!1,h("writeCheckpoint completed with error",e)}var w,k,E,O=[],S={seq:0,changes:[],docs:[]},x=!1,j=!1,A=!1,P=0,q=n.continuous||n.live||!1,T=n.batch_size||100,C=n.batches_limit||10,L=!1,D=n.doc_ids,I=[],N=J();i=i||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var M={};return r.ready(e,t),r.cancelled?void p():(r._addedListeners||(r.once("cancel",p),"function"==typeof n.complete&&(r.once("error",n.complete),r.once("complete",function(e){n.complete(null,e)})),r._addedListeners=!0),void("undefined"==typeof n.since?_():o().then(function(){return x=!0,E.writeCheckpoint(n.since,N)}).then(function(){return x=!1,r.cancelled?void p():(P=n.since,void _())}).catch(b)))}function br(){Pr.EventEmitter.call(this),this.cancelled=!1,this.state="pending";var e=this,t=new Dr(function(t,n){e.once("complete",t),e.once("error",n)});e.then=function(e,n){return t.then(e,n)},e.catch=function(e){return t.catch(e)},e.catch(function(){})}function wr(e,t){var n=t.PouchConstructor;return"string"==typeof e?new n(e,t):e}function kr(e,t,n,r){if("function"==typeof n&&(r=n,n={}),"undefined"==typeof n&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw q(ni,"`doc_ids` filter parameter is not a list.");n.complete=r,n=u(n),n.continuous=n.continuous||n.live,n.retry="retry"in n&&n.retry,n.PouchConstructor=n.PouchConstructor||this;var i=new br(n),o=wr(e,n),a=wr(t,n);return _r(o,a,n,i),i}function Er(e,t,n,r){return"function"==typeof n&&(r=n,n={}),"undefined"==typeof n&&(n={}),n=u(n),n.PouchConstructor=n.PouchConstructor||this,e=wr(e,n),t=wr(t,n),new Or(e,t,n,r)}function Or(e,t,n,r){function i(e){p.emit("change",{direction:"pull",change:e})}function o(e){p.emit("change",{direction:"push",change:e})}function a(e){p.emit("denied",{direction:"push",doc:e})}function s(e){p.emit("denied",{direction:"pull",doc:e})}function u(){p.pushPaused=!0,p.pullPaused&&p.emit("paused")}function c(){p.pullPaused=!0,p.pushPaused&&p.emit("paused")}function f(){p.pushPaused=!1,p.pullPaused&&p.emit("active",{direction:"push"})}function l(){p.pullPaused=!1,p.pushPaused&&p.emit("active",{direction:"pull"})}function d(e){return function(t,n){var r="change"===t&&(n===i||n===o),d="denied"===t&&(n===s||n===a),h="paused"===t&&(n===c||n===u),v="active"===t&&(n===l||n===f);(r||d||h||v)&&(t in g||(g[t]={}),g[t][e]=!0,2===Object.keys(g[t]).length&&p.removeAllListeners(t))}}function h(e,t,n){e.listeners(t).indexOf(n)==-1&&e.on(t,n)}var p=this;this.canceled=!1;var v=n.push?Jr({},n,n.push):n,y=n.pull?Jr({},n,n.pull):n;this.push=kr(e,t,v),this.pull=kr(t,e,y),this.pushPaused=!0,this.pullPaused=!0;var g={};n.live&&(this.push.on("complete",p.pull.cancel.bind(p.pull)),this.pull.on("complete",p.push.cancel.bind(p.push))),this.on("newListener",function(e){"change"===e?(h(p.pull,"change",i),h(p.push,"change",o)):"denied"===e?(h(p.pull,"denied",s),h(p.push,"denied",a)):"active"===e?(h(p.pull,"active",l),h(p.push,"active",f)):"paused"===e&&(h(p.pull,"paused",c),h(p.push,"paused",u))}),this.on("removeListener",function(e){"change"===e?(p.pull.removeListener("change",i),p.push.removeListener("change",o)):"denied"===e?(p.pull.removeListener("denied",s),p.push.removeListener("denied",a)):"active"===e?(p.pull.removeListener("active",l),p.push.removeListener("active",f)):"paused"===e&&(p.pull.removeListener("paused",c),p.push.removeListener("paused",u))}),this.pull.on("removeListener",d("pull")),this.push.on("removeListener",d("push"));var m=Dr.all([this.push,this.pull]).then(function(e){var t={push:e[0],pull:e[1]};return p.emit("complete",t),r&&r(null,t),p.removeAllListeners(),t},function(e){if(p.cancel(),r?r(e):p.emit("error",e),p.removeAllListeners(),r)throw e});this.then=function(e,t){return m.then(e,t)},this.catch=function(e){return m.catch(e)}}function Sr(e){e.replicate=kr,e.sync=Er,Object.defineProperty(e.prototype,"replicate",{get:function(){var e=this;return{from:function(t,n,r){return e.constructor.replicate(t,e,n,r)},to:function(t,n,r){return e.constructor.replicate(e,t,n,r)}}}}),e.prototype.sync=function(e,t,n){return this.constructor.sync(this,e,t,n)}}var xr=r(e(7)),jr=r(e(1)),Ar=r(e(2)),Pr=e(4),qr=r(e(6)),Tr=r(e(5)),Cr=r(e(10)),Rr=r(e(11)),Lr=r(e(12)),Dr="function"==typeof Promise?Promise:xr,Ir=Function.prototype.toString,Nr=Ir.call(Object),Mr=Ar("pouchdb:api");p.prototype.get=function(e){var t=d(e);return this._store[t]},p.prototype.set=function(e,t){var n=d(e);return this._store[n]=t,!0},p.prototype.has=function(e){var t=d(e);return t in this._store},p.prototype.delete=function(e){var t=d(e),n=t in this._store;return delete this._store[t],n},p.prototype.forEach=function(e){for(var t=Object.keys(this._store),n=0,r=t.length;n<r;n++){var i=t[n],o=this._store[i];i=h(i),e(o,i)}},Object.defineProperty(p.prototype,"size",{get:function(){return Object.keys(this._store).length}}),v.prototype.add=function(e){return this._store.set(e,!0)},v.prototype.has=function(e){return this._store.has(e)},v.prototype.forEach=function(e){this._store.forEach(function(t,n){e(n)})},Object.defineProperty(v.prototype,"size",{get:function(){return this._store.size}});var Br,Fr;y()?(Br=Set,Fr=Map):(Br=v,Fr=p);var Ur,zr=6;if(w())Ur=!1;else try{localStorage.setItem("_pouch_check_localstorage",1),Ur=!!localStorage.getItem("_pouch_check_localstorage")}catch(e){Ur=!1}qr(O,Pr.EventEmitter),O.prototype.addListener=function(e,t,n,r){function i(){function e(){a=!1}if(o._listeners[t]){if(a)return void(a="waiting");a=!0;var s=g(r,["style","include_docs","attachments","conflicts","filter","doc_ids","view","since","query_params","binary"]);n.changes(s).on("change",function(e){e.seq>r.since&&!r.cancelled&&(r.since=e.seq,r.onChange(e))}).on("complete",function(){"waiting"===a&&Tr(i),a=!1}).on("error",e)}}if(!this._listeners[t]){var o=this,a=!1;this._listeners[t]=i,this.on(e,i)}},O.prototype.removeListener=function(e,t){t in this._listeners&&(Pr.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},O.prototype.notifyLocalWindows=function(e){w()?chrome.storage.local.set({dbName:e}):k()&&(localStorage[e]="a"===localStorage[e]?"b":"a")},O.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var Hr;Hr="function"==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(null!=r)for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t};var Jr=Hr;qr(P,Error),P.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var Wr,Kr=(new P(401,"unauthorized","Name or password is incorrect."),new P(400,"bad_request","Missing JSON list of 'docs'")),Vr=new P(404,"not_found","missing"),Xr=new P(409,"conflict","Document update conflict"),Gr=new P(400,"bad_request","_id field must contain a string"),$r=new P(412,"missing_id","_id is required for puts"),Qr=new P(400,"bad_request","Only reserved document ids may start with underscore."),Yr=(new P(412,"precondition_failed","Database not open"),new P(500,"unknown_error","Database encountered an unknown error")),Zr=new P(500,"badarg","Some query argument is invalid"),ei=(new P(400,"invalid_request","Request was invalid"),new P(400,"query_parse_error","Some query parameter is invalid")),ti=new P(500,"doc_validation","Bad special document member"),ni=new P(400,"bad_request","Something wrong with the request"),ri=new P(400,"bad_request","Document must be a JSON object"),ii=(new P(404,"not_found","Database not found"),new P(500,"indexed_db_went_bad","unknown")),oi=new P(500,"web_sql_went_bad","unknown"),ai=(new P(500,"levelDB_went_went_bad","unknown"),new P(403,"forbidden","Forbidden by design doc validate_doc_update function"),new P(400,"bad_request","Invalid rev format")),si=(new P(412,"file_exists","The database could not be created, the file already exists."),new P(412,"missing_stub","A pre-existing attachment stub wasn't found")),ui=(new P(413,"invalid_url","Provided URL is invalid"),D.name);Wr=ui?function(e){return e.name}:function(e){return e.toString().match(/^\s*function\s*(\S*)\s*\(/)[1]};var ci=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],fi="queryKey",li=/(?:^|&)([^&=]*)=?([^&]*)/g,di=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,hi="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");qr(ye,Pr.EventEmitter),ye.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit("cancel")},ye.prototype.doChanges=function(e){var t=this,n=e.complete;if(e=u(e),"live"in e&&!("continuous"in e)&&(e.continuous=e.live),e.processChange=ge,"latest"===e.since&&(e.since="now"),e.since||(e.since=0),"now"===e.since)return void this.db.info().then(function(r){return t.isCancelled?void n(null,{status:"cancelled"}):(e.since=r.update_seq,void t.doChanges(e))},n);if(e.view&&!e.filter&&(e.filter="_view"),e.filter&&"string"==typeof e.filter&&("_view"===e.filter?e.view=B(e.view):e.filter=B(e.filter),"http"!==this.db.type()&&!e.doc_ids))return this.filterChanges(e);"descending"in e||(e.descending=!1),e.limit=0===e.limit?1:e.limit,e.complete=n;var r=this.db._changes(e);if(r&&"function"==typeof r.cancel){var i=t.cancel;t.cancel=jr(function(e){r.cancel(),i.apply(this,e)})}},ye.prototype.filterChanges=function(e){var t=this,n=e.complete;if("_view"===e.filter){if(!e.view||"string"!=typeof e.view){var r=q(ni,"`view` filter parameter not found or invalid.");return n(r)}var i=M(e.view);this.db.get("_design/"+i[0],function(r,o){if(t.isCancelled)return n(null,{status:"cancelled"});if(r)return n(T(r));var a=o&&o.views&&o.views[i[1]]&&o.views[i[1]].map;return a?(e.filter=pe(a),void t.doChanges(e)):n(q(Vr,o.views?"missing json key: "+i[1]:"missing json key: views"))})}else{var o=M(e.filter);if(!o)return t.doChanges(e);this.db.get("_design/"+o[0],function(r,i){if(t.isCancelled)return n(null,{status:"cancelled"});if(r)return n(T(r));var a=i&&i.filters&&i.filters[o[1]];return a?(e.filter=he(a),void t.doChanges(e)):n(q(Vr,i&&i.filters?"missing json key: "+o[1]:"missing json key: filters"))})}},qr(xe,Pr.EventEmitter),xe.prototype.post=l("post",function(e,t,n){return"function"==typeof t&&(n=t,t={}),"object"!==("undefined"==typeof e?"undefined":fe(e))||Array.isArray(e)?n(q(ri)):void this.bulkDocs({docs:[e]},t,_e(n))}),xe.prototype.put=l("put",function(e,t,n){return"function"==typeof t&&(n=t,t={}),"object"!==("undefined"==typeof e?"undefined":fe(e))||Array.isArray(e)?n(q(ri)):(I(e._id),le(e._id)&&"function"==typeof this._putLocal?e._deleted?this._removeLocal(e,n):this._putLocal(e,n):void("function"==typeof this._put&&t.new_edits!==!1?this._put(e,t,n):this.bulkDocs({docs:[e]},t,_e(n))))}),xe.prototype.putAttachment=l("putAttachment",function(e,t,n,r,i){function o(e){var n="_rev"in e?parseInt(e._rev,10):0;return e._attachments=e._attachments||{},e._attachments[t]={content_type:i,data:r,revpos:++n},a.put(e)}var a=this;return"function"==typeof i&&(i=r,r=n,n=null),"undefined"==typeof i&&(i=r,r=n,n=null),i||S("warn","Attachment",t,"on document",e,"is missing content_type"),a.get(e).then(function(e){if(e._rev!==n)throw q(Xr);return o(e)},function(t){if(t.reason===Vr.message)return o({_id:e});throw t})}),xe.prototype.removeAttachment=l("removeAttachment",function(e,t,n,r){var i=this;i.get(e,function(e,o){return e?void r(e):o._rev!==n?void r(q(Xr)):o._attachments?(delete o._attachments[t],0===Object.keys(o._attachments).length&&delete o._attachments,void i.put(o,r)):r()})}),xe.prototype.remove=l("remove",function(e,t,n,r){var i;"string"==typeof t?(i={_id:e,_rev:t},"function"==typeof n&&(r=n,n={})):(i=e,"function"==typeof t?(r=t,n={}):(r=n,n=t)),n=n||{},n.was_delete=!0;var o={_id:i._id,_rev:i._rev||n.rev};return o._deleted=!0,le(o._id)&&"function"==typeof this._removeLocal?this._removeLocal(i,r):void this.bulkDocs({docs:[o]},n,_e(r))}),xe.prototype.revsDiff=l("revsDiff",function(e,t,n){function r(e,t){s.has(e)||s.set(e,{missing:[]}),s.get(e).missing.push(t)}function i(t,n){var i=e[t].slice(0);K(n,function(e,n,o,a,s){var u=n+"-"+o,c=i.indexOf(u);c!==-1&&(i.splice(c,1),"available"!==s.status&&r(t,u))}),i.forEach(function(e){r(t,e)})}"function"==typeof t&&(n=t,t={});var o=Object.keys(e);if(!o.length)return n(null,{});var a=0,s=new Fr;o.map(function(t){this._getRevisionTree(t,function(r,u){if(r&&404===r.status&&"missing"===r.message)s.set(t,{missing:e[t]});else{if(r)return n(r);i(t,u)}if(++a===o.length){var c={};return s.forEach(function(e,t){c[t]=e}),n(null,c)}})},this)}),xe.prototype.bulkGet=l("bulkGet",function(e,t){b(this,e,t)}),xe.prototype.compactDocument=l("compactDocument",function(e,t,n){var r=this;this._getRevisionTree(e,function(i,o){if(i)return n(i);var a=ke(o),s=[],u=[];Object.keys(a).forEach(function(e){a[e]>t&&s.push(e)}),K(o,function(e,t,n,r,i){var o=t+"-"+n;"available"===i.status&&s.indexOf(o)!==-1&&u.push(o)}),r._doCompaction(e,u,n)})}),xe.prototype.compact=l("compact",function(e,t){"function"==typeof e&&(t=e,e={});var n=this;e=e||{},n._compactionQueue=n._compactionQueue||[],n._compactionQueue.push({opts:e,callback:t}),1===n._compactionQueue.length&&Oe(n)}),xe.prototype._compact=function(e,t){function n(e){a.push(i.compactDocument(e.id,0))}function r(e){var n=e.last_seq;Dr.all(a).then(function(){return U(i,"_local/compaction",function(e){return(!e.last_seq||e.last_seq<n)&&(e.last_seq=n,e)})}).then(function(){t(null,{ok:!0})}).catch(t)}var i=this,o={return_docs:!1,last_seq:e.last_seq||0},a=[];i.changes(o).on("change",n).on("complete",r).on("error",t)},xe.prototype.get=l("get",function(e,t,n){function r(){var r=[],a=i.length;return a?void i.forEach(function(i){o.get(e,{rev:i,revs:t.revs,latest:t.latest,attachments:t.attachments},function(e,t){if(e)r.push({missing:i});else{for(var o,s=0,u=r.length;s<u;s++)if(r[s].ok&&r[s].ok._rev===t._rev){o=!0;break}o||r.push({ok:t})}a--,a||n(null,r)})}):n(null,r)}if("function"==typeof t&&(n=t,t={}),"string"!=typeof e)return n(q(Gr));if(le(e)&&"function"==typeof this._getLocal)return this._getLocal(e,n);var i=[],o=this;if(!t.open_revs)return this._get(e,t,function(e,r){if(e)return n(e);var i=r.doc,a=r.metadata,s=r.ctx;if(t.conflicts){var u=G(a);u.length&&(i._conflicts=u)}if(ce(a,i._rev)&&(i._deleted=!0),t.revs||t.revs_info){for(var c=i._rev.split("-"),f=parseInt(c[0],10),l=c[1],d=Q(a.rev_tree),h=null,p=0;p<d.length;p++){var v=d[p],y=v.ids.map(function(e){return e.id}).indexOf(l),g=y===f-1;(g||!h&&y!==-1)&&(h=v)}var m=h.ids.map(function(e){return e.id}).indexOf(i._rev.split("-")[1])+1,_=h.ids.length-m;if(h.ids.splice(m,_),h.ids.reverse(),t.revs&&(i._revisions={start:h.pos+h.ids.length-1,ids:h.ids.map(function(e){return e.id})}),t.revs_info){var b=h.pos+h.ids.length;i._revs_info=h.ids.map(function(e){return b--,{rev:b+"-"+e.id,status:e.opts.status}})}}if(t.attachments&&i._attachments){var w=i._attachments,k=Object.keys(w).length;if(0===k)return n(null,i);Object.keys(w).forEach(function(e){this._getAttachment(i._id,e,w[e],{rev:i._rev,binary:t.binary,ctx:s},function(t,r){var o=i._attachments[e];o.data=r,delete o.stub,delete o.length,--k||n(null,i)})},o)}else{if(i._attachments)for(var E in i._attachments)i._attachments.hasOwnProperty(E)&&(i._attachments[E].stub=!0);n(null,i)}});if("all"===t.open_revs)this._getRevisionTree(e,function(e,t){return e?n(e):(i=X(t).map(function(e){return e.rev}),void r())});else{if(!Array.isArray(t.open_revs))return n(q(Yr,"function_clause"));i=t.open_revs;for(var a=0;a<i.length;a++){var s=i[a];if("string"!=typeof s||!/^\d+-/.test(s))return n(q(ai))}r()}}),xe.prototype.getAttachment=l("getAttachment",function(e,t,n,r){var i=this;n instanceof Function&&(r=n,n={}),this._get(e,n,function(o,a){return o?r(o):a.doc._attachments&&a.doc._attachments[t]?(n.ctx=a.ctx,n.binary=!0,i._getAttachment(e,t,a.doc._attachments[t],n,r),void 0):r(q(Vr))})}),xe.prototype.allDocs=l("allDocs",function(e,t){if("function"==typeof e&&(t=e,e={}),e.skip="undefined"!=typeof e.skip?e.skip:0,e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),"keys"in e){if(!Array.isArray(e.keys))return t(new TypeError("options.keys must be an array"));var n=["startkey","endkey","key"].filter(function(t){return t in e})[0];if(n)return void t(q(ei,"Query parameter `"+n+"` is not compatible with multi-get"));if("http"!==this.type())return Ee(this,e,t)}return this._allDocs(e,t)}),xe.prototype.changes=function(e,t){return"function"==typeof e&&(t=e,e={}),new ye(this,e,t)},xe.prototype.close=l("close",function(e){return this._closed=!0,this.emit("closed"),this._close(e)}),xe.prototype.info=l("info",function(e){var t=this;this._info(function(n,r){return n?e(n):(r.db_name=r.db_name||t.name,r.auto_compaction=!(!t.auto_compaction||"http"===t.type()),r.adapter=t.type(),void e(null,r))})}),xe.prototype.id=l("id",function(e){return this._id(e)}),xe.prototype.type=function(){return"function"==typeof this._type?this._type():this.adapter},xe.prototype.bulkDocs=l("bulkDocs",function(e,t,n){if("function"==typeof t&&(n=t,t={}),t=t||{},Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return n(q(Kr));for(var r=0;r<e.docs.length;++r)if("object"!==fe(e.docs[r])||Array.isArray(e.docs[r]))return n(q(ri));var i;if(e.docs.forEach(function(e){e._attachments&&Object.keys(e._attachments).forEach(function(t){i=i||Se(t),e._attachments[t].content_type||S("warn","Attachment",t,"on document",e._id,"is missing content_type")})}),i)return n(q(ni,i));"new_edits"in t||("new_edits"in e?t.new_edits=e.new_edits:t.new_edits=!0);var o=this;t.new_edits||"http"===o.type()||e.docs.sort(we),be(e.docs);var a=e.docs.map(function(e){return e._id});return this._bulkDocs(e,t,function(e,r){if(e)return n(e);if(t.new_edits||(r=r.filter(function(e){return e.error})),"http"!==o.type())for(var i=0,s=r.length;i<s;i++)r[i].id=r[i].id||a[i];n(null,r)})}),xe.prototype.registerDependentDatabase=l("registerDependentDatabase",function(e,t){function n(t){return t.dependentDbs=t.dependentDbs||{},!t.dependentDbs[e]&&(t.dependentDbs[e]=!0,t)}var r=new this.constructor(e,this.__opts);U(this,"_local/_pouch_dependentDbs",n).then(function(){t(null,{db:r})}).catch(t)}),xe.prototype.destroy=l("destroy",function(e,t){function n(){r._destroy(e,function(e,n){return e?t(e):(r._destroyed=!0,r.emit("destroyed"),void t(null,n||{ok:!0}))})}"function"==typeof e&&(t=e,e={});var r=this,i=!("use_prefix"in r)||r.use_prefix;return"http"===r.type()?n():void r.get("_local/_pouch_dependentDbs",function(e,o){if(e)return 404!==e.status?t(e):n();var a=o.dependentDbs,s=r.constructor,u=Object.keys(a).map(function(e){var t=i?e.replace(new RegExp("^"+s.prefix),""):e;return new s(t,r.__opts).destroy()});Dr.all(u).then(n,t)})}),je.prototype.execute=function(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()},je.prototype.fail=function(e){this.failed=e,this.execute()},je.prototype.ready=function(e){this.isReady=!0,this.db=e,this.execute()},je.prototype.addTask=function(e){this.queue.push(e),this.failed&&this.execute()},qr(qe,xe),qe.debug=Ar,qe.adapters={},qe.preferredAdapters=[],qe.prefix="_pouch_";var pi=new Pr.EventEmitter;Te(qe),qe.adapter=function(e,t,n){t.valid()&&(qe.adapters[e]=t,n&&qe.preferredAdapters.push(e))},qe.plugin=function(e){if("function"==typeof e)e(qe);else{if("object"!==("undefined"==typeof e?"undefined":fe(e))||0===Object.keys(e).length)throw new Error('Invalid plugin: got "'+e+'", expected an object or a function');Object.keys(e).forEach(function(t){qe.prototype[t]=e[t]})}return this.__defaults&&(qe.__defaults=Jr({},this.__defaults)),qe},qe.defaults=function(e){function t(e,n){return this instanceof t?(n=n||{},e&&"object"===("undefined"==typeof e?"undefined":fe(e))&&(n=e,e=n.name,delete n.name),n=Jr({},t.__defaults,n),void qe.call(this,e,n)):new t(e,n)}return qr(t,qe),t.preferredAdapters=qe.preferredAdapters.slice(),Object.keys(qe).forEach(function(e){e in t||(t[e]=qe[e])}),t.__defaults=Jr({},this.__defaults,e),t};var vi="6.1.2";qe.version=vi;var yi,gi=Ce(["_id","_rev","_attachments","_deleted","_revisions","_revs_info","_conflicts","_deleted_conflicts","_local_seq","_rev_tree","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats","_removed"]),mi=Ce(["_attachments","_replication_id","_replication_state","_replication_state_time","_replication_state_reason","_replication_stats"]),_i=function(e){return atob(e)},bi=function(e){return btoa(e)},wi=n.setImmediate||n.setTimeout,ki=32768,Ei=5,Oi="document-store",Si="by-sequence",xi="attach-store",ji="attach-seq-store",Ai="meta-store",Pi="local-store",qi="detect-blob-support",Ti=new O,Ci=!1,Ri=[],Li=new Fr,Di=new Fr;jt.valid=function(){var e="undefined"!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform);return!e&&"undefined"!=typeof indexedDB&&"undefined"!=typeof IDBKeyRange};var Ii=function(e){e.adapter("idb",jt,!0)},Ni=7,Mi=Dt("document-store"),Bi=Dt("by-sequence"),Fi=Dt("attach-store"),Ui=Dt("local-store"),zi=Dt("metadata-store"),Hi=Dt("attach-seq-store"),Ji=new Fr,Wi=new O,Ki=1,Vi="CREATE INDEX IF NOT EXISTS 'by-seq-deleted-idx' ON "+Bi+" (seq, deleted)",Xi="CREATE UNIQUE INDEX IF NOT EXISTS 'by-seq-doc-id-rev' ON "+Bi+" (doc_id, rev)",Gi="CREATE INDEX IF NOT EXISTS 'doc-winningseq-idx' ON "+Mi+" (winningseq)",$i="CREATE INDEX IF NOT EXISTS 'attach-seq-seq-idx' ON "+Hi+" (seq)",Qi="CREATE UNIQUE INDEX IF NOT EXISTS 'attach-seq-digest-idx' ON "+Hi+" (digest, seq)",Yi=Bi+".seq = "+Mi+".winningseq",Zi=Bi+".seq AS seq, "+Bi+".deleted AS deleted, "+Bi+".json AS data, "+Bi+".rev AS rev, "+Mi+".json AS metadata";tn.valid=Zt,tn.use_prefix=!0;var eo=function(e){e.adapter("websql",tn,!0)},to=an(),no=function(){},ro=25,io=50,oo={},ao=Ar("pouchdb:http");bn.valid=function(){return!0};var so=function(e){e.adapter("http",bn,!1),e.adapter("https",bn,!1)};qr(wn,Error),qr(kn,Error),qr(En,Error);var uo=S.bind(null,"log"),co=Array.isArray,fo=JSON.parse,lo=-324,ho=3,po="";Vn.prototype.add=function(e){return this.promise=this.promise.catch(function(){}).then(function(){return e()}),this.promise},Vn.prototype.finish=function(){return this.promise};var vo={},yo=new Vn,go=50,mo={_sum:function(e,t){return Tn(t)},_count:function(e,t){return t.length},_stats:function(e,t){function n(e){for(var t=0,n=0,r=e.length;n<r;n++){var i=e[n];t+=i*i}return t}return{sum:Tn(t),min:Math.min.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:n(t)}}},_o="mrviews",bo=Yn(_o,Zn,er,tr),wo={query:nr,viewCleanup:rr},ko=1,Eo="pouchdb",Oo=5,So=0;lr.prototype.writeCheckpoint=function(e,t){var n=this;return this.updateTarget(e,t).then(function(){return n.updateSource(e,t)})},lr.prototype.updateTarget=function(e,t){return fr(this.target,this.id,e,t,this.returnValue)},lr.prototype.updateSource=function(e,t){var n=this;return this.readOnlySource?Dr.resolve(!0):fr(this.src,this.id,e,t,this.returnValue).catch(function(e){if(vr(e))return n.readOnlySource=!0,!0;throw e})};var xo={undefined:function(e,t){return 0===Dn(e.last_seq,t.last_seq)?t.last_seq:0},1:function(e,t){return dr(t,e).last_seq}};lr.prototype.getCheckpoint=function(){var e=this;return e.target.get(e.id).then(function(t){return e.readOnlySource?Dr.resolve(t.last_seq):e.src.get(e.id).then(function(e){if(t.version!==e.version)return So;var n;return n=t.version?t.version.toString():"undefined",n in xo?xo[n](t,e):So},function(n){if(404===n.status&&t.last_seq)return e.src.put({_id:e.id,last_seq:So}).then(function(){return So},function(n){return vr(n)?(e.readOnlySource=!0,t.last_seq):So});throw n})}).catch(function(e){if(404!==e.status)throw e;return So})};var jo=0;qr(br,Pr.EventEmitter),br.prototype.cancel=function(){this.cancelled=!0,this.state="cancelled",this.emit("cancel")},br.prototype.ready=function(e,t){function n(){i.cancel()}function r(){e.removeListener("destroyed",n),t.removeListener("destroyed",n)}var i=this;i._readyCalled||(i._readyCalled=!0,e.once("destroyed",n),t.once("destroyed",n),i.once("complete",r))},qr(Or,Pr.EventEmitter),Or.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},qe.plugin(Ii).plugin(eo).plugin(so).plugin(wo).plugin(Sr),t.exports=qe}).call(this,"undefined"!=typeof mn?mn:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{1:1,10:10,11:11,12:12,2:2,4:4,5:5,6:6,7:7}]},{},[13])(13)})}),On=function(){function e(t){le(this,e),this.prefix=t||"app.flags"}return de(e,[{key:"key",value:function(e){return 0===e.indexOf(this.prefix)?e:this.prefix+"."+e}},{key:"set",value:function(e,t){return e=this.key(e),Promise.resolve(localStorage.setItem(e,t?"1":"0"))}},{key:"check",value:function(e){e=this.key(e);var t=localStorage.getItem(e);return"1"===t?Promise.resolve():Promise.reject()}},{key:"enable",value:function(e){return this.set(e,!0)}},{key:"disable",value:function(e){return this.set(e,!0)}}]),e}(),Sn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};le(this,e);var n=this.defaultOptions;for(var r in t)n.hasOwnProperty(r)&&(n[r]=t[r]);"auto"===n.autoLoad&&window&&window.location&&(n.autoLoad="file:"!==window.location.protocol),"auto"===n.defaultLang&&(n.defaultLang=e.detect()),this.vocabularies={},this.options=n,n.autoLoad&&this.fetch()}return de(e,[{key:"defaultOptions",get:function(){return{defaultLang:"auto",fallbackLang:"en",autoLoad:"auto",path:"locales",filename:"translation",languages:["en","es","de","fr","it"]}}}]),de(e,[{key:"fetch",value:function(){var e=this;return Promise.all(this.options.languages.map(function(t){return e.load(t)}))}},{key:"addResources",value:function(e,t){var n=this.options;t=t||n.defaultLang,this.vocabularies[t]=this.vocabularies[t]||{};for(var r in e)e.hasOwnProperty(r)&&(this.vocabularies[t][r]=e[r]);return this}},{key:"load",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=this.options;n=n||r.filename;var i=r.path+"/"+e+"/"+n+".json";return fetch(i).then(function(e){return e.json()}).then(function(n){return t.addResources(n,e),Promise.resolve(n)})}},{key:"translate",value:function(e){var t=this.options,n=t.defaultLang,r=void 0;if(e&&(this.vocabularies[n]&&this.vocabularies[n]&&(r=K(this.vocabularies[n],e)),!r&&t.fallbackLang&&this.vocabularies[t.fallbackLang]&&(r=K(this.vocabularies[t.fallbackLang],e))),r){for(var i=arguments.length,o=Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];r=V.apply(void 0,[r].concat(o))}return r}}],[{key:"detect",value:function(){if("undefined"!=typeof navigator){var e=navigator.language||navigator.browserLanguage;return e.split("_").shift().split("-").shift().toLowerCase()}return null}}]),e}(),xn=function(){function e(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};le(this,e),t(this).i18n=new Sn(n)}return de(e,[{key:"addResources",value:function(){var e;return(e=t(this).i18n).addResources.apply(e,arguments)}},{key:"translate",value:function(){var e;return(e=t(this).i18n).translate.apply(e,arguments)}}]),e}(),jn=function(){function e(){le(this,e)}return de(e,null,[{key:"add",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"text/javascript";return new Promise(function(r,i){var o=document.createElement("script");o.type=n,e?o.src=e:t&&(o.innerText=t),e?(o.addEventListener("load",function(){r(o)}),o.addEventListener("error",function(){i(o)}),o.addEventListener("abort",function(){i(o)}),document.body.appendChild(o)):(document.body.appendChild(o),r())})}},{key:"addByContent",value:function(e,t){return this.add(null,e,t)}},{key:"addByUrl",value:function(e,t){return this.add(e,null,t)}}]),e}(),An=document.head.querySelector("title")||function(){var e=document.createElement("title");return document.head.appendChild(e),e}(),Pn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};le(this,e),this.options=t,this.reset()}return de(e,[{key:"defaultTitle",get:function(){return this.options.defaultTitle||""}}]),de(e,[{key:"reset",value:function(){this.states=[this.defaultTitle],this.update()}},{key:"build",value:function(){return"inverse"===this.options.direction?this.states.slice(0).reverse().join(" - "):this.states.join(" - ")}},{key:"update",value:function(){var e=void 0;e=this.states&&this.states.length?this.build():this.defaultTitle,An.textContent=e}},{key:"get",value:function(){return An.textContent}},{key:"set",value:function(e){"string"==typeof e&&(e=[e]),this.states=e,this.update()}},{key:"pushState",value:function(e){this.states.push(e),this.update()}},{key:"replaceState",value:function(e,t){"undefined"==typeof t&&(t=this.states.length-1),this.states[t]=e,this.update()}},{key:"removeState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.states=this.states.slice(-e),this.update()}}]),e}(),qn=new RegExp("^(?:[a-z]+:)?//","i"),Tn=new RegExp("^(?:[a-z]+:)?//[^/]*","i"),Cn=/^data:/,Rn=function(){function e(t){le(this,e),this.url=t}return de(e,null,[{key:"join",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.length-1;return t.filter(function(e){return!!e}).map(function(e,t){return 0===t?e.replace(/\/*$/,""):t===r?e.replace(/^\/*/,""):e.replace(/^\/*/,"").replace(/\/*$/,"")}).join("/")}},{key:"isAbsoluteUrl",value:function(e){return qn.test(e)}},{key:"isDataUrl",value:function(e){return Cn.test(e)}},{key:"resolve",value:function(e,t){if("/"===t[0]){if(!this.isAbsoluteUrl(e))throw new Error("base url is not an absolute url");e=e.match(Tn)[0]+"/"}var n=e.split("/"),r=t.split("/").filter(function(e){return""!==e});n.pop();for(var i=0;i<r.length;i++)"."!==r[i]&&(".."===r[i]?n.pop():n.push(r[i]));return n.join("/")}}]),de(e,[{key:"isAbsoluteUrl",value:function(){return e.isAbsoluteUrl(this.url)}},{key:"isDataUrl",value:function(){return e.isDataUrl(this.url)}},{key:"resolve",value:function(t){return e.resolve(this.url,t)}},{key:"join",value:function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.join.apply(e,[this.url].concat(n))}}]),e}(),Ln=function(e){function n(){return le(this,n),ye(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return ve(n,e),de(n,[{key:"getResponse",value:function(){return t(this).response}},{key:"setResponse",value:function(e){t(this).response=e}},{key:"fetch",value:function(){return Promise.resolve()}}]),n}(un),Dn=function(e){function t(){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ve(t,e),de(t,[{key:"beforeFetch",value:function(){return Promise.resolve()}},{key:"afterFetch",value:function(e){return Promise.resolve(e)}},{key:"execFetch",value:function(){return fetch(""+this.endpoint,this.constructor.fetchOptions).then(function(e){return e.json()})}},{key:"fetch",value:function(){for(var e=this,t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=this.constructor;return i.ready.then(function(){return e.beforeFetch.apply(e,n).then(function(){return e.endpoint?e.execFetch.apply(e,n).then(function(t){e.setResponse(t),e.afterFetch(t).then(function(t){return e.set(t),Promise.resolve(t)})}):Promise.reject()})})}}],[{key:"fetchOptions",get:function(){return{}}}]),t}(Ln),In=function(e){function n(){return le(this,n),ye(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return ve(n,e),de(n,[{key:"beforeFetch",value:function(){return Promise.resolve()}},{key:"afterFetch",value:function(e){return Promise.resolve(e)}},{key:"fetch",value:function(){var e=this,t=this.constructor;return t.database?this.beforeFetch.apply(this,arguments).then(function(){return t.database.get(e.getDatabaseId()||e[t.databaseKey]).then(function(t){return e.setResponse(t),e.afterFetch(t).then(function(){
return e.set(t,!0),e.setDatabaseInfo({id:t._id,rev:t._rev}),Promise.resolve(t)})})}):Promise.reject(t.databaseError)}},{key:"setDatabaseInfo",value:function(e){t(this).dbId=e.id,t(this).dbRev=e.rev}},{key:"getDatabaseId",value:function(){return t(this).dbId}},{key:"getDatabaseRev",value:function(){return t(this).dbRev}},{key:"save",value:function(e){var t=this,n=this.constructor;return n.database?Promise.resolve().then(function(){var e=void 0;if(t.getDatabaseId())e=n.database.put(t.toDBData());else{var r=t.toJSON();n.databaseKey&&r[n.databaseKey]?(r._id=r[n.databaseKey],e=n.database.put(r)):e=n.database.post(r)}return e.then(function(e){return t.setDatabaseInfo({id:e.id,rev:e.rev}),Promise.resolve(t)})}).then(function(n){return e?t.push(e):Promise.resolve(n)}).then(function(e){return t.resetChanges(),Promise.resolve(e)}):Promise.reject(n.databaseError)}},{key:"toDBData",value:function(){var e=this.toJSON();return e._id=this.getDatabaseId(),e._rev=this.getDatabaseRev(),e}},{key:"sync",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.constructor;return t.sync(e)}},{key:"pull",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.constructor;return t.pull(e)}},{key:"push",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.constructor;return t.push(e)}},{key:"id",get:function(){return t(this).id},set:function(e){e?t(this).id=this.constructor._id(e):delete t(this).id}}],[{key:"destroy",value:function(){var e=this;return this.database.destroy().then(function(){return delete t(e).db,Promise.resolve()})}},{key:"empty",value:function(){var e=this;return this.database.allDocs().then(function(t){return t&&t.rows?Promise.all(t.rows.filter(function(e){return!e.id.match(/^_design/)}).map(function(t){return e.database.remove(t.id,t.value.rev)})):Promise.resolve()})}},{key:"query",value:function(e,t){var n=this;return this.database?this.database.query(e,t).then(function(e){return e=e.rows.map(function(e){var t=new n;return t.set(e.value,!0),t.setDatabaseInfo({id:e.value._id,rev:e.value._rev}),t}),Promise.resolve(e)}):Promise.reject(this.databaseError)}},{key:"sync",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.database)return Promise.reject(this.databaseError);var n=X(this.databaseSyncOptions,t);return n.url?this.database.sync(n.url,n).catch(function(t){return Promise.reject(new pn(e.database,t))}):new pn(this.database,"Missing database remote url.")}},{key:"push",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.database)return Promise.reject(this.databaseError);var n=X(this.databaseSyncOptions,t);return n.url?this.database.replicate(n.url,n).catch(function(t){Promise.reject(new pn(e.database,t))}):new pn(this.database,"Missing database remote url.")}},{key:"pull",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.database)return Promise.reject(this.databaseError);var n=X(this.databaseSyncOptions,t);if(n.url){var r=new En(n.url);return r.replicate(this.database,n).catch(function(t){Promise.reject(new pn(e.database,t))})}return new pn(this.database,"Missing database remote url.")}},{key:"_id",value:function(e){return e}},{key:"getById",value:function(e){e=this._id(e);var t=new this;return t.set("id",e),t.fetch().then(function(){return Promise.resolve(t)})}},{key:"find",value:function(e){var t=this;if(e&&this.queries&&this.queries[e]){for(var n,r=arguments.length,i=Array(r>1?r-1:0),o=1;o<r;o++)i[o-1]=arguments[o];return this.database.query({map:(n=this.queries[e]).call.apply(n,[this].concat(i))}).then(function(e){return e&&e.rows?Promise.all(e.rows.map(function(e){var n=new t;return n.set({id:e.id}),n.fetch().then(function(){return Promise.resolve(n)})})):Promise.resolve([])})}return this.database.allDocs().then(function(e){return e&&e.rows?Promise.all(e.rows.filter(function(e){return!e.id.match(/^_design/)}).map(function(e){var n=new t;return n.set("id",e.id),n.fetch().then(function(){return Promise.resolve(n)})})):Promise.reject()})}},{key:"getOrCreate",value:function(e){var t=this;return this.getById(e).catch(function(){var n=new t;return n.set("id",e),Promise.resolve(n)})}},{key:"databaseName",get:function(){return""}},{key:"databaseOptions",get:function(){}},{key:"databaseKey",get:function(){return"id"}},{key:"queries",get:function(){return{}}},{key:"database",get:function(){if(t(this).db)return t(this).db;try{return t(this).db=new En(this.databaseName,this.databaseOptions),t(this).db}catch(e){this.databaseError=new hn(e)}return null}}]),n}(Ln),Nn=function(e){function t(){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ve(t,e),de(t,[{key:"fetch",value:function(){for(var e,n=this,r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];return(e=Dn.prototype.fetch).call.apply(e,[this].concat(i)).then(function(){return n.sync()},function(){var e;return(e=pe(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"fetch",n)).call.apply(e,[n].concat(i))})}}]),t}(In),Mn=function(e){function t(){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ve(t,e),de(t,[{key:"hide",value:function(){var e=this;return this.node.classList.remove("navigation--show"),this.node.classList.add("navigation--hide"),new Promise(function(t){var n=window.getComputedStyle(e.node).animationName;if("none"!==n){var r=function n(){e.node.classList.remove("navigation--hide"),e.node.removeEventListener("animationend",n),t()};e.node.addEventListener("animationend",r)}else e.node.classList.remove("navigation--hide"),t()})}},{key:"show",value:function(){var e=this;return this.node.classList.add("navigation--show"),new Promise(function(t){var n=window.getComputedStyle(e.node).animationName;if("none"!==n){var r=function n(){e.node.classList.remove("navigation--show"),e.node.removeEventListener("animationend",n),t()};e.node.addEventListener("animationend",r)}else e.node.classList.remove("navigation--show"),t()})}},{key:"destroy",value:function(){return this.hide(),Promise.resolve()}}]),t}(vn);z("page-view",Mn,{extends:"section"}),Object.setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e};var Bn=function(){function e(t,n){le(this,e);for(var r=arguments.length,i=Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];var a=new(Function.prototype.bind.apply(Error,[null].concat([t],i)));return"undefined"==typeof t?a.message=this.defaultMessage:t instanceof Error&&(n=t,a.message=this.defaultMessage),n&&(a.originalError=n,a.message=a.message+", from "+n.name+": "+n.message+"."),a.name=this.constructor.exceptionName,Object.setPrototypeOf(a,this.constructor.prototype),a}return de(e,[{key:"defaultMessage",get:function(){return"Generic Router error"}},{key:"exceptionName",get:function(){return"RouterException"}}]),e}(),Fn=function(e){function t(){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ve(t,e),de(t,[{key:"defaultMessage",get:function(){return"Out of history navigation."}},{key:"exceptionName",get:function(){return"OutOfHistoryException"}}]),t}(Bn),Un=function(e){function t(){le(this,t);var e=ye(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.reset(),e}return ve(t,e),de(t,[{key:"reset",value:function(){this.index=-1,this.entries=[]}},{key:"go",value:function(e){if(0!==e){var t=this.index+e;if(t<0||t>=this.entries.length)return Promise.reject(new Fn);this.index=t,this.trigger("popstate",this.current)}return Promise.resolve(this.current)}},{key:"back",value:function(){return this.go(-1)}},{key:"forward",value:function(){return this.go(1)}},{key:"indexOfState",value:function(e){e=e||{};for(var t=this.entries.slice(0).reverse(),n=0,r=t.length;n<r;n++)if(t[n].state.timestamp===e.timestamp)return n;return-1}},{key:"pushState",value:function(e,t,n){var r=G(e,t,n,"push");return this.entries=this.entries.slice(0,this.index+1),this.entries.push(r),this.go(1),this.trigger("popstate",r),r}},{key:"replaceState",value:function(e,t,n){var r=G(e,t,n,"replace");return this.entries[this.index]=r,r}},{key:"current",get:function(){return this.entries[this.index]}},{key:"length",get:function(){return this.entries.length}}]),t}(Se.mixin()),zn=function(e){function t(){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ve(t,e),de(t,[{key:"defaultMessage",get:function(){return"Router has not been started yet."}},{key:"exceptionName",get:function(){return"RouterNotStartedException"}}]),t}(Bn),Hn=function(e){function t(){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ve(t,e),de(t,[{key:"defaultMessage",get:function(){return"Router rule has not been found."}},{key:"exceptionName",get:function(){return"RouterNotFoundException"}}]),t}(Bn),Jn=function(e){function t(){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ve(t,e),de(t,[{key:"defaultMessage",get:function(){return"Router state does not exist."}},{key:"exceptionName",get:function(){return"RouterInvalidException"}}]),t}(Bn),Wn=function(e){function t(){return le(this,t),ye(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return ve(t,e),de(t,[{key:"defaultMessage",get:function(){return"Parser for router instance is undefined."}},{key:"exceptionName",get:function(){return"ParserUndefinedException"}}]),t}(Bn),Kn=new RegExp(["(\\\\.)","([\\/.])?(?:(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?|(\\*))"].join("|"),"g"),Vn="undefined"!=typeof window&&"function"==typeof window.addEventListener,Xn=Vn&&window.history,Gn=Vn&&(Xn&&Xn.location||window&&window.location),$n=/^((https?|s?ftps?):\/+)?(.+?)(?=\/|$)/i,Qn=0,Yn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};le(this,e),this.history=new Un,this.started=!1,this.reset(),this.options={};for(var n in this.DEFAULTS)t.hasOwnProperty(n)?this.options[n]=t[n]:this.DEFAULTS.hasOwnProperty(n)&&(this.options[n]=this.DEFAULTS[n]);this.parser=this.options.parser,this.base=this.options.base,this.id=Qn,Qn++}return de(e,[{key:"DEFAULTS",get:function(){return{base:"#",dispatch:!0,bind:!0,parser:e.defaultParser,triggerHashChange:!0}}}],[{key:"EXPRESS_PARSER",get:function(){return oe}},{key:"RIOT_PARSER",get:function(){return $}},{key:"defaultParser",get:function(){return this.EXPRESS_PARSER}}]),de(e,[{key:"reset",value:function(){this.callbacks={},this.routes=[]}},{key:"getPathFromBase",value:function(t){var n=this.base;return n&&"#"===n[0]?(t=t||Gn.href||"",t.split(n)[1]||""):(t=Gn?e.getPathFromRoot(t):t||"",t.replace(n,""))}},{key:"hasPathnameChanged",value:function(e){if("string"!=typeof this.current)return!0;var t=this.current.split("#").shift(),n=e.split("#").shift();return t!==n}},{key:"changeType",value:function(e){return e!==this.current?this.hasPathnameChanged(e)?2:1:0}},{key:"trigger",value:function(e){var t=this,n=this.history&&this.history.current&&this.history.current.url||"",r=this.changeType(n);if(e||r>0&&(this.options.triggerHashChange||2===r)){if(this.current=n,"function"!=typeof this.parser)return Promise.reject(new Wn);var i=Promise.reject();return this.routes.some(function(e){var r=t.parser(t.normalize(n),t.normalize(e));if(null!==r){var o=t.callbacks[e]||[];return o.forEach(function(e){i=i.catch(function(){return e.apply(t,r)})}),!0}return!1}),i.catch(function(){return Promise.reject(new Hn)})}if(1===r&&this.options.bind){this.current=n;var o=new Event("hashchange");window.dispatchEvent(o)}return Promise.resolve()}},{key:"on",value:function(e,t){e=this.normalize(e),e="/"+e,this.routes.push(e),this.callbacks[e]=this.callbacks[e]||[],this.callbacks[e].push(t)}},{key:"navigate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.started?(e=this.normalize(e),n?this.history.replaceState(null,t,e):this.history.pushState(null,t,e),this.trigger(r)):Promise.reject(new zn)}},{key:"refresh",value:function(){if(this.started){var e=this.history&&this.history.current&&this.history.current;return e?this.navigate(e.url,e.title,!0,!0):Promise.reject(new Jn)}return Promise.reject(new zn)}},{key:"back",value:function(){return this.started?this.history.back():Promise.reject(new zn)}},{key:"forward",value:function(){return this.started?this.history.forward():Promise.reject(new zn)}},{key:"start",value:function(){if(!this.started){var e=Promise.resolve();return this.options.bind&&(this.current=this.getPathFromBase(),this.history.pushState(null,document.title,this.current)),this.started=!0,Vn&&(this.debouncedEmit=ae(this,this.trigger,1).bind(this),this.history.on("popstate",this.debouncedEmit),this.options.dispatch&&this.history.length&&(e=this.trigger(!0)),this.options.bind&&ue.call(this),this.options.dispatch=!0),e}return Promise.reject()}},{key:"stop",value:function(){this.started&&(this.history.reset(),this.history.off("popstate",this.debouncedEmit),this.reset(),ce.call(this),this.started=!1)}},{key:"normalize",value:function(e){return e.replace(/^\/|\/$/,"")}},{key:"resolve",value:function(e){e=e.replace(/^\/*/,"");var t="/"!==this.base.slice(-1);return""+this.base+(t?"/":"")+e}},{key:"query",value:function(e){var t={};return e=e||this.current||this.getPathFromBase(),e.replace(/[?&](.+?)=([^&]*)/g,function(e,n,r){t[n]=r}),t}}],[{key:"getPathFromRoot",value:function(e){return e=e||Gn.href,e.replace($n,"")}}]),e}(),Zn=function(e){function n(){return le(this,n),ye(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return ve(n,e),de(n,[{key:"initialize",value:function(e){var t=this;return this.element=e,this.router=new this.constructor.Router(this.routeOptions),this.i18n=new this.constructor.I18N(this.i18nOptions),Promise.all([this.handleComponents(),this.handleNavigation(),pe(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"initialize",this).call(this,e)]).then(function(){return t.registerRoutes(),t.ready().then(function(){return t.start()}).catch(function(e){t.onInitializeError(e)}),Promise.resolve()})}},{key:"onInitializeError",value:function(e){console.error(e),alert("Error occurred on application initialize.")}},{key:"onPluginReady",value:function(e){var t=this;e.routeRules&&this.registerRoutes(e.routeRules);for(var n=this.constructor,r=[];n;)n.locales&&r.indexOf(n.locales)===-1&&r.unshift(n.locales),n=Object.getPrototypeOf(n);r.forEach(function(e){t.registerLocales(e)})}},{key:"start",value:function(){var e=this;return this.router.on("*",function(){e.notFound()}),this.router.start()}},{key:"registerLocales",value:function(e){for(var t in e)this.i18n.addResources(e[t],t)}},{key:"registerRoutes",value:function(e){var t=this,n=this.router.callbacks;e=e||this.routeRules;for(var r in e)e.hasOwnProperty(r)&&!n.hasOwnProperty(r)&&!function(){var n=e[r];if("string"==typeof n)"function"==typeof t[n]&&t.router.on(r,function(){return t.beforeRoute.apply(t,arguments).then(function(e){var r;return(r=t[n]).call.apply(r,[t].concat(ge(e))).then(function(){return t.afterRoute()})})});else{var i=void 0;Array.isArray(n)&&(i=n[1],n=n[0]),n.prototype instanceof sn&&t.router.on(r,function(){for(var e=arguments.length,r=Array(e),o=0;o<e;o++)r[o]=arguments[o];return t.beforeRoute.apply(t,r).then(function(){return t.dispatchController(n).then(function(e){var n=e.ready();return n=i&&"function"==typeof e[i]?n.then(function(){var t;return(t=e[i]).call.apply(t,[e].concat(r))}):n.then(function(){return e.exec.apply(e,r)}),n.then(function(){return t.dispatchView(e)})}).then(function(){return t.afterRoute.apply(t,r)}).catch(function(e){try{if(!t.throwException(e))return Promise.reject(e)}catch(e){return Promise.reject(e)}return Promise.resolve()})})})}}()}},{key:"beforeRoute",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return Promise.resolve(t)}},{key:"afterRoute",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return Promise.resolve(t)}},{key:"backState",value:function(){return this.router.back()}},{key:"forwardState",value:function(){return this.router.forward()}},{key:"handleNavigation",value:function(){var e=this;return this.element.addEventListener("click",function(t){for(var n=t.target;n&&"A"!==n.tagName;)n=n.parentNode;return!n||"A"!==n.tagName||e.handleLink(t,n,e)}),Promise.resolve()}},{key:"handleLink",value:function(e){for(var t=this.getPluginInstances(),n=arguments.length,r=Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var o=0,a=t.length;o<a;o++){var s=t[o];if("function"==typeof s.handleLink&&!s.handleLink.apply(s,[e].concat(r)))return!1}var u=e.target,c="A"===u.tagName?u:u.closest("a");if(c){var f=c.getAttribute("href"),l=c.getAttribute("target");!f||l&&"_self"!==l||Rn.isAbsoluteUrl(f)||(e.preventDefault(),e.stopPropagation(),this.navigate(f))}return!0}},{key:"handleComponents",value:function(){var e=this,t=void 0;return vn.notifications.on("created",function(n){if(n instanceof vn){var r=e._isRendering()?e:t&&t.getOwner();r===e&&(n.setOwner(r),e._addRendering(n.initialize())),t=n}}),this._setRendering(),U(this.element),this._unsetRendering(),this._rendered()}},{key:"dispatchController",value:function(e){for(var n=this,r=t(this).lastControllerRequest||Promise.resolve(),i=arguments.length,o=Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];var s=new(Function.prototype.bind.apply(e,[null].concat([this],o))),u=Promise.resolve(),c=t(this).currentController;return c&&(u=c.destroy()),r=r.then(function(){return u.then(function(){return t(n).currentController=s,s.ready().then(function(){return Promise.resolve(s)}).catch(function(){return Promise.reject(s)})})}),t(this).lastControllerRequest=r,r}},{key:"dispatchView",value:function(e){var t=this;return new Promise(function(n){var r=t.currentPage,i=r?r.destroy():Promise.resolve();i.then(function(){var i=new t.constructor.View;i.setOwner(t),t.currentPage=i,g(t.element,i);var o=Promise.resolve();e&&(e.pipe(function(n){t.render(e.render(n))}),o=t.render(e.render(e.getResponse())));var a=Promise.all([o,t.currentPage.show(!r)]);a.then(function(){r&&m(t.element,r),n()})})})}},{key:"render",value:function(e){return this._setRendering(),N(this.currentPage.node,e),this._unsetRendering(),this._rendered()}},{key:"navigate",value:function(){var e;return(e=this.router).navigate.apply(e,arguments)}},{key:"refresh",value:function(){return this.router.refresh()}},{key:"throwException",value:function(e){if(e&&e instanceof cn){if(!this.handleException(e))throw e;return!0}return!1}},{key:"handleException",value:function(e){return e instanceof dn?(this.notFound(),!0):e instanceof ln&&(this.error(),!0)}},{key:"notFound",value:function(){return Promise.resolve()}},{key:"error",value:function(){return Promise.resolve()}},{key:"_setRendering",value:function(){t(this).rendering=!0,t(this).renderingPromises=[]}},{key:"_unsetRendering",value:function(){t(this).rendering=!1}},{key:"_addRendering",value:function(e){t(this).renderingPromises.push(e)}},{key:"_isRendering",value:function(){return!!t(this).rendering}},{key:"_rendered",value:function(){return Promise.all(t(this).renderingPromises)}},{key:"routeOptions",get:function(){return{dispatch:!0}}},{key:"routeRules",get:function(){return{}}},{key:"i18nOptions",get:function(){return{languages:[]}}}],[{key:"View",get:function(){return Mn}},{key:"Router",get:function(){return Yn}},{key:"I18N",get:function(){return xn}}]),n}(_e(je).with(gn));e.BaseObject=je,e.Controller=sn,e.Factory=Pe,e.Model=un,e.AppException=cn,e.ContentException=fn,e.ContentErrorException=ln,e.ContentNotFoundException=dn,e.DBOpeningErrorException=hn,e.DBSyncFailedException=pn,e.Component=vn,e.Plugin=yn,e.BaseMixin=we,e.CallbackMixin=xe,e.InjectableMixin=ke,e.OwnableMixin=Ae,e.PluggableMixin=gn,e.ConfigureHelper=bn,e.CssHelper=kn,e.FlagsHelper=On,e.I18NHelper=xn,e.internal=t,e.mix=_e,e.ScriptHelper=jn,e.TitleHelper=Pn,e.UrlHelper=Rn,e.FetchModel=Ln,e.AjaxModel=Dn,e.DBModel=In,e.SyncModel=Nn,e.PageViewComponent=Mn,e.App=Zn,Object.defineProperty(e,"__esModule",{value:!0})});

//# sourceMappingURL=synapse.js.map
